(()=>{var e={172:()=>{},912:()=>{},576:()=>{},581:()=>{},554:()=>{},373:()=>{},522:()=>{},248:e=>{var t=function(e){"use strict";var t,i=Object.prototype,n=i.hasOwnProperty,r=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,i){return e[t]=i}}function u(e,t,i,n){var o=t&&t.prototype instanceof g?t:g,s=Object.create(o.prototype),a=new D(n||[]);return r(s,"_invoke",{value:E(e,i,a)}),s}function h(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var c="suspendedStart",m="executing",p="completed",f={};function g(){}function b(){}function w(){}var k={};d(k,s,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(L([])));v&&v!==i&&n.call(v,s)&&(k=v);var C=w.prototype=g.prototype=Object.create(k);function T(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function i(r,o,s,a){var l=h(e[r],e,o);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==typeof u&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,s,a)}),(function(e){i("throw",e,s,a)})):t.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return i("throw",e,s,a)}))}a(l.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function E(e,t,i){var n=c;return function(r,o){if(n===m)throw new Error("Generator is already running");if(n===p){if("throw"===r)throw o;return P()}for(i.method=r,i.arg=o;;){var s=i.delegate;if(s){var a=S(s,i);if(a){if(a===f)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===c)throw n=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=m;var l=h(e,t,i);if("normal"===l.type){if(n=i.done?p:"suspendedYield",l.arg===f)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n=p,i.method="throw",i.arg=l.arg)}}}function S(e,i){var n=i.method,r=e.iterator[n];if(r===t)return i.delegate=null,"throw"===n&&e.iterator.return&&(i.method="return",i.arg=t,S(e,i),"throw"===i.method)||"return"!==n&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=h(r,e.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,f;var s=o.arg;return s?s.done?(i[e.resultName]=s.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,f):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,f)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function L(e){if(e){var i=e[s];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function i(){for(;++r<e.length;)if(n.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=t,i.done=!0,i};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return b.prototype=w,r(C,"constructor",{value:w,configurable:!0}),r(w,"constructor",{value:b,configurable:!0}),b.displayName=d(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,d(e,l,"GeneratorFunction")),e.prototype=Object.create(C),e},e.awrap=function(e){return{__await:e}},T(x.prototype),d(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,i,n,r,o){void 0===o&&(o=Promise);var s=new x(u(t,i,n,r),o);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},T(C),d(C,l,"Generator"),d(C,s,(function(){return this})),d(C,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=L,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function r(n,r){return a.type="throw",a.arg=e,i.next=n,r&&(i.method="next",i.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var l=n.call(s,"catchLoc"),d=n.call(s,"finallyLoc");if(l&&d){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),j(i),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;j(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,i,n){return this.delegate={iterator:L(e),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=t),f}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},511:()=>{"use strict";var e;!function(e){e[e.identifier=0]="identifier",e[e.integerConstant=1]="integerConstant",e[e.floatingPointConstant=2]="floatingPointConstant",e[e.booleanConstant=3]="booleanConstant",e[e.stringConstant=4]="stringConstant",e[e.charConstant=5]="charConstant",e[e.true=6]="true",e[e.false=7]="false",e[e.keywordRename=8]="keywordRename",e[e.keywordDistinct=9]="keywordDistinct",e[e.keywordTo=10]="keywordTo",e[e.keywordAlter=11]="keywordAlter",e[e.keywordCommit=12]="keywordCommit",e[e.keywordAdd=13]="keywordAdd",e[e.keywordDelete=14]="keywordDelete",e[e.keywordSelect=15]="keywordSelect",e[e.keywordInsert=16]="keywordInsert",e[e.keywordInto=17]="keywordInto",e[e.keywordValues=18]="keywordValues",e[e.keywordUpdate=19]="keywordUpdate",e[e.keywordSet=20]="keywordSet",e[e.keywordNo=21]="keywordNo",e[e.keywordUse=22]="keywordUse",e[e.keywordCreate=23]="keywordCreate",e[e.keywordReferences=24]="keywordReferences",e[e.keywordPrimary=25]="keywordPrimary",e[e.keywordForeign=26]="keywordForeign",e[e.keywordTable=27]="keywordTable",e[e.keywordTables=28]="keywordTables",e[e.keywordColumn=29]="keywordColumn",e[e.keywordDrop=30]="keywordDrop",e[e.keywordUnique=31]="keywordUnique",e[e.keywordKey=32]="keywordKey",e[e.keywordIndex=33]="keywordIndex",e[e.keywordConstraint=34]="keywordConstraint",e[e.keywordModify=35]="keywordModify",e[e.keywordCascade=36]="keywordCascade",e[e.keywordRestrict=37]="keywordRestrict",e[e.keywordAction=38]="keywordAction",e[e.keywordAutoincrement=39]="keywordAutoincrement",e[e.keywordFrom=40]="keywordFrom",e[e.keywordWhere=41]="keywordWhere",e[e.keywordGroup=42]="keywordGroup",e[e.keywordBy=43]="keywordBy",e[e.keywordHaving=44]="keywordHaving",e[e.keywordOrder=45]="keywordOrder",e[e.keywordAscending=46]="keywordAscending",e[e.keywordDescending=47]="keywordDescending",e[e.keywordNulls=48]="keywordNulls",e[e.keywordFirst=49]="keywordFirst",e[e.keywordLast=50]="keywordLast",e[e.keywordIs=51]="keywordIs",e[e.keywordNull=52]="keywordNull",e[e.keywordDatabase=53]="keywordDatabase",e[e.keywordOr=54]="keywordOr",e[e.keywordAnd=55]="keywordAnd",e[e.keywordNot=56]="keywordNot",e[e.keywordJoin=57]="keywordJoin",e[e.keywordNatural=58]="keywordNatural",e[e.keywordLeft=59]="keywordLeft",e[e.keywordCross=60]="keywordCross",e[e.keywordInner=61]="keywordInner",e[e.keywordOuter=62]="keywordOuter",e[e.keywordOn=63]="keywordOn",e[e.keywordAs=64]="keywordAs",e[e.keywordLimit=65]="keywordLimit",e[e.keywordOffset=66]="keywordOffset",e[e.keywordIn=67]="keywordIn",e[e.keywordNotIn=68]="keywordNotIn",e[e.keywordLike=69]="keywordLike",e[e.keywordCollate=70]="keywordCollate",e[e.keywordDefault=71]="keywordDefault",e[e.keywordComment=72]="keywordComment",e[e.keywordEngine=73]="keywordEngine",e[e.keywordCharset=74]="keywordCharset",e[e.keywordCharacter=75]="keywordCharacter",e[e.keywordStart=76]="keywordStart",e[e.keywordTransaction=77]="keywordTransaction",e[e.keywordIf=78]="keywordIf",e[e.keywordExists=79]="keywordExists",e[e.keywordLock=80]="keywordLock",e[e.keywordUnlock=81]="keywordUnlock",e[e.keywordWrite=82]="keywordWrite",e[e.keywordRead=83]="keywordRead",e[e.leftBracket=84]="leftBracket",e[e.rightBracket=85]="rightBracket",e[e.leftSquareBracket=86]="leftSquareBracket",e[e.rightSquareBracket=87]="rightSquareBracket",e[e.leftCurlyBracket=88]="leftCurlyBracket",e[e.rightCurlyBracket=89]="rightCurlyBracket",e[e.leftRightSquareBracket=90]="leftRightSquareBracket",e[e.dot=91]="dot",e[e.modulo=92]="modulo",e[e.minus=93]="minus",e[e.plus=94]="plus",e[e.multiplication=95]="multiplication",e[e.division=96]="division",e[e.singleQuote=97]="singleQuote",e[e.doubleQuote=98]="doubleQuote",e[e.identifierQuote=99]="identifierQuote",e[e.lower=100]="lower",e[e.greater=101]="greater",e[e.lowerOrEqual=102]="lowerOrEqual",e[e.greaterOrEqual=103]="greaterOrEqual",e[e.concatenation=104]="concatenation",e[e.equal=105]="equal",e[e.notEqual=106]="notEqual",e[e.semicolon=107]="semicolon",e[e.colon=108]="colon",e[e.comma=109]="comma",e[e.backslash=110]="backslash",e[e.pipe=111]="pipe",e[e.at=112]="at",e[e.hash=113]="hash",e[e.space=114]="space",e[e.tab=115]="tab",e[e.newline=116]="newline",e[e.linefeed=117]="linefeed",e[e.identifierChar=118]="identifierChar",e[e.comment=119]="comment",e[e.endofSourcecode=120]="endofSourcecode",e[e.constantNode=121]="constantNode",e[e.callMethod=122]="callMethod",e[e.unaryOp=123]="unaryOp",e[e.binaryOp=124]="binaryOp",e[e.table=125]="table",e[e.subquery=126]="subquery",e[e.list=127]="list",e[e.column=128]="column",e[e.columnDef=129]="columnDef",e[e.allColumns=130]="allColumns",e[e.isNull=131]="isNull",e[e.isNot=132]="isNot",e[e.isNotNull=133]="isNotNull",e[e.omittedeStatement=134]="omittedeStatement"}(e||(e={}));var t,i={[e.identifier]:"ein Bezeichner",[e.integerConstant]:"eine Integer-Konstante",[e.floatingPointConstant]:"eine Fließkomma-Konstante",[e.booleanConstant]:"eine boolesche Konstante",[e.stringConstant]:"eine Zeichenketten-Konstante",[e.charConstant]:"eine char-Konstante",[e.true]:"true",[e.false]:"false",[e.keywordRename]:"rename",[e.keywordDistinct]:"distinct",[e.keywordTo]:"to",[e.keywordAlter]:"alter",[e.keywordCommit]:"commit",[e.keywordAdd]:"add",[e.keywordDelete]:"delete",[e.keywordSelect]:"select",[e.keywordInsert]:"insert",[e.keywordInto]:"into",[e.keywordValues]:"values",[e.keywordUpdate]:"update",[e.keywordSet]:"set",[e.keywordNo]:"no",[e.keywordUse]:"use",[e.keywordCreate]:"create",[e.keywordReferences]:"references",[e.keywordPrimary]:"primary",[e.keywordForeign]:"foreign",[e.keywordTable]:"table",[e.keywordTables]:"tables",[e.keywordColumn]:"column",[e.keywordDrop]:"drop",[e.keywordUnique]:"unique",[e.keywordKey]:"key",[e.keywordIndex]:"index",[e.keywordConstraint]:"constraint",[e.keywordModify]:"modify",[e.keywordCascade]:"cascade",[e.keywordRestrict]:"restrict",[e.keywordAction]:"action",[e.keywordAutoincrement]:"autoincrement",[e.keywordFrom]:"from",[e.keywordWhere]:"where",[e.keywordGroup]:"group",[e.keywordBy]:"by",[e.keywordHaving]:"having",[e.keywordOrder]:"order",[e.keywordAscending]:"ascending",[e.keywordDescending]:"descending",[e.keywordNulls]:"nulls",[e.keywordFirst]:"first",[e.keywordLast]:"last",[e.keywordIs]:"is",[e.keywordNull]:"null",[e.keywordDatabase]:"database",[e.keywordAnd]:"and",[e.keywordOr]:"or",[e.keywordNot]:"not",[e.keywordJoin]:"join",[e.keywordNatural]:"natural",[e.keywordLeft]:"left",[e.keywordCross]:"cross",[e.keywordInner]:"inner",[e.keywordOuter]:"outer",[e.keywordOn]:"on",[e.keywordAs]:"as",[e.keywordLimit]:"limit",[e.keywordOffset]:"offset",[e.keywordIn]:"in",[e.keywordNotIn]:"not in",[e.keywordLike]:"like",[e.keywordCollate]:"collate",[e.keywordDefault]:"default",[e.keywordComment]:"comment",[e.keywordEngine]:"engine",[e.keywordCharset]:"charset",[e.keywordCharacter]:"character",[e.keywordStart]:"start",[e.keywordTransaction]:"transaction",[e.keywordIf]:"if",[e.keywordExists]:"exists",[e.keywordLock]:"lock",[e.keywordUnlock]:"unlock",[e.keywordWrite]:"write",[e.keywordRead]:"read",[e.leftBracket]:"(",[e.rightBracket]:")",[e.leftSquareBracket]:"[",[e.rightSquareBracket]:"]",[e.leftCurlyBracket]:"{",[e.rightCurlyBracket]:"}",[e.leftRightSquareBracket]:"[]",[e.dot]:".",[e.minus]:"-",[e.modulo]:"%",[e.plus]:"+",[e.multiplication]:"*",[e.division]:"/",[e.singleQuote]:"'",[e.doubleQuote]:'"',[e.identifierQuote]:"`",[e.lower]:"<",[e.greater]:">",[e.equal]:"=",[e.lowerOrEqual]:"<=",[e.greaterOrEqual]:">=",[e.concatenation]:"||",[e.semicolon]:";",[e.colon]:":",[e.comma]:",",[e.backslash]:"\\",[e.at]:"@",[e.hash]:"#",[e.pipe]:"|",[e.space]:"ein Leerzeichen",[e.tab]:"ein Tabulatorzeichen",[e.newline]:"ein Zeilenumbruch",[e.identifierChar]:"eines der Zeichen a..z, A..Z, _",[e.comment]:"ein Kommentar",[e.endofSourcecode]:"das Ende des Programmes"},n={"(":e.leftBracket,")":e.rightBracket,"[":e.leftSquareBracket,"]":e.rightSquareBracket,"{":e.leftCurlyBracket,"}":e.rightCurlyBracket,".":e.dot,",":e.comma,"-":e.minus,"%":e.modulo,"+":e.plus,"*":e.multiplication,"/":e.division,"\\":e.backslash,"@":e.at,"#":e.hash,"|":e.pipe,"'":e.singleQuote,'"':e.doubleQuote,"`":e.identifierQuote,"<":e.lower,">":e.greater,"=":e.equal,"<>":e.notEqual,";":e.semicolon,":":e.colon," ":e.space,"\t":e.tab,"\n":e.newline,"\r":e.linefeed},r={rename:e.keywordRename,distinct:e.keywordDistinct,to:e.keywordTo,alter:e.keywordAlter,commit:e.keywordCommit,add:e.keywordAdd,delete:e.keywordDelete,select:e.keywordSelect,insert:e.keywordInsert,into:e.keywordInto,values:e.keywordValues,update:e.keywordUpdate,set:e.keywordSet,no:e.keywordNo,use:e.keywordUse,create:e.keywordCreate,references:e.keywordReferences,primary:e.keywordPrimary,foreign:e.keywordForeign,table:e.keywordTable,tables:e.keywordTables,column:e.keywordColumn,drop:e.keywordDrop,unique:e.keywordUnique,key:e.keywordKey,index:e.keywordIndex,constraint:e.keywordConstraint,modify:e.keywordModify,cascade:e.keywordCascade,restrict:e.keywordRestrict,action:e.keywordAction,autoincrement:e.keywordAutoincrement,auto_increment:e.keywordAutoincrement,from:e.keywordFrom,where:e.keywordWhere,true:e.true,false:e.false,group:e.keywordGroup,by:e.keywordBy,having:e.keywordHaving,order:e.keywordOrder,asc:e.keywordAscending,desc:e.keywordDescending,nulls:e.keywordNulls,first:e.keywordFirst,last:e.keywordLast,is:e.keywordIs,null:e.keywordNull,database:e.keywordDatabase,or:e.keywordOr,and:e.keywordAnd,not:e.keywordNot,join:e.keywordJoin,natural:e.keywordNatural,left:e.keywordLeft,cross:e.keywordCross,inner:e.keywordInner,outer:e.keywordOuter,on:e.keywordOn,as:e.keywordAs,limit:e.keywordLimit,offset:e.keywordOffset,in:e.keywordIn,"not in":e.keywordNotIn,like:e.keywordLike,collate:e.keywordCollate,default:e.keywordDefault,comment:e.keywordComment,engine:e.keywordEngine,charset:e.keywordCharset,character:e.keywordCharacter,start:e.keywordStart,transaction:e.keywordTransaction,if:e.keywordIf,exists:e.keywordExists,lock:e.keywordLock,unlock:e.keywordUnlock,write:e.keywordWrite,read:e.keywordRead},o={n:"\n",r:"\r",t:"\t",'"':'"',"'":"'","\\":"\\"};!function(e){e[e.number=0]="number",e[e.identifier=1]="identifier",e[e.stringConstant=2]="stringConstant",e[e.characterConstant=3]="characterConstant",e[e.multilineComment=4]="multilineComment",e[e.EndoflineComment=5]="EndoflineComment"}(t||(t={}));var s="►";class a{constructor(){this.spaceTokens=[e.space,e.tab,e.newline],this.correspondingBracket={},this.tokenTypesToMerge=[{first:e.keywordNotIn,second:e.keywordIn,merged:e.keywordNotIn},{first:e.keywordIs,second:e.keywordNot,merged:e.isNot},{first:e.isNot,second:e.keywordNull,merged:e.isNotNull},{first:e.keywordIs,second:e.keywordNull,merged:e.isNull}],this.correspondingBracket[e.leftBracket]=e.rightBracket,this.correspondingBracket[e.leftCurlyBracket]=e.rightCurlyBracket,this.correspondingBracket[e.leftSquareBracket]=e.rightSquareBracket,this.correspondingBracket[e.rightBracket]=e.leftBracket,this.correspondingBracket[e.rightCurlyBracket]=e.leftCurlyBracket,this.correspondingBracket[e.rightSquareBracket]=e.leftSquareBracket}lex(e){if(this.input=e.replace(" "," "),this.tokenList=[],this.errorList=[],this.bracketError=null,this.bracketStack=[],this.pos=0,this.line=1,this.column=1,this.nonSpaceLastTokenType=null,this.nonSpaceLastToken=null,0==e.length)return{tokens:this.tokenList,errors:this.errorList,bracketError:null};for(this.currentChar=e.charAt(0),this.nextChar=e.length>1?e.charAt(1):s;this.currentChar!=s;)this.mainState();if(this.bracketStack.length>0){let e=this.bracketStack.pop(),t=this.correspondingBracket[e];this.setBracketError(i[e]+" "+i[t])}return{tokens:this.tokenList,errors:this.errorList,bracketError:this.bracketError}}checkClosingBracket(e){if(0==this.bracketStack.length){let t=this.correspondingBracket[e];return void this.setBracketError(i[t]+" "+i[e])}let t=this.bracketStack.pop(),n=this.correspondingBracket[t];e!=n&&this.setBracketError(i[t]+" "+i[n])}setBracketError(e){null==this.bracketError&&(this.bracketError=e)}next(){this.pos++,this.currentChar=this.nextChar,this.pos+1<this.input.length?this.nextChar=this.input.charAt(this.pos+1):this.nextChar=s,this.column++}mainState(){let t=this.currentChar,i=n[t];if(null!=i){switch(i){case e.leftSquareBracket:return"]"==this.nextChar?(this.pushToken(e.leftRightSquareBracket,"[]"),this.next(),void this.next()):(this.pushToken(e.leftSquareBracket,"["),this.bracketStack.push(i),void this.next());case e.division:return"*"==this.nextChar?void this.lexMultilineComment():(this.pushToken(e.division,"/"),void this.next());case e.pipe:return"|"==this.nextChar?(this.pushToken(e.concatenation,"||"),this.next(),void this.next()):(this.pushToken(e.pipe,"|"),void this.next());case e.lower:return">"==this.nextChar?(this.pushToken(e.notEqual,"<>"),this.next(),void this.next()):"="==this.nextChar?(this.pushToken(e.lowerOrEqual,"<="),this.next(),void this.next()):(this.pushToken(e.lower,"<"),void this.next());case e.greater:return"="==this.nextChar?(this.pushToken(e.greaterOrEqual,">="),this.next(),void this.next()):(this.pushToken(e.greater,">"),void this.next());case e.rightSquareBracket:this.checkClosingBracket(i);break;case e.leftBracket:this.bracketStack.push(i);break;case e.rightBracket:this.checkClosingBracket(i);break;case e.leftCurlyBracket:this.bracketStack.push(i);break;case e.rightCurlyBracket:this.checkClosingBracket(i);break;case e.minus:return!this.isDigit(this.nextChar,10)||[e.identifier,e.integerConstant,e.floatingPointConstant,e.rightBracket].indexOf(this.nonSpaceLastTokenType)>=0?"-"==this.nextChar?void this.lexEndofLineComment("--"):(this.pushToken(e.minus,"-"),void this.next()):void this.lexNumber();case e.hash:if(null==this.nonSpaceLastToken||this.nonSpaceLastToken.position.line<this.line)return void this.lexEndofLineComment("#");this.pushToken(e.hash,"#"),this.next();break;case e.singleQuote:return void this.lexStringConstant("'");case e.doubleQuote:return void this.lexStringConstant('"');case e.newline:return this.pushToken(e.newline,"\n"),this.line++,this.column=0,void this.next();case e.space:case e.tab:return void this.lexSpace();case e.linefeed:return void this.next();case e.at:return void this.lexAnnotation();case e.identifierQuote:return void this.lexQuotedIdentifier()}return this.pushToken(i,t),void this.next()}this.isDigit(t,10)?this.lexNumber():this.lexIdentifierOrKeyword()}lexQuotedIdentifier(){let t=this.line,i=this.column,n="";for(this.next();"`"!=this.currentChar&&this.currentChar!=s;)n+=this.currentChar,this.next();this.currentChar==s?this.pushError("Innerhalb eines in `` eingeschlossenen Bezeichners wurde das Ende der Datei erreicht.",n.length+1,"error",t,i):(this.next(),this.pushToken(e.identifier,n,t,i))}pushToken(e,t,i=this.line,n=this.column,r=(""+t).length){let o={tt:e,value:t,position:{column:n,line:i,length:r}};for(let o of this.tokenTypesToMerge)if(e==o.second&&this.nonSpaceLastTokenType==o.first){let e=n-this.nonSpaceLastToken.position.column+r;return this.nonSpaceLastToken.tt=o.merged,this.nonSpaceLastToken.position={column:this.nonSpaceLastToken.position.column,line:i,length:e},this.nonSpaceLastToken.value=this.nonSpaceLastToken.value+" "+t,void(this.nonSpaceLastTokenType=o.merged)}this.spaceTokens.indexOf(e)>=0||(this.nonSpaceLastTokenType=e,this.nonSpaceLastToken=o),this.tokenList.push(o)}pushError(e,t,i="error",n=this.line,r=this.column){this.errorList.push({text:e,position:{line:n,column:r,length:t},level:i})}isDigit(e,t){var i=e.charCodeAt(0);return 10==t?i>=48&&i<=57:2==t?i>=48&&i<=49:8==t?i>=48&&i<=55:16==t?i>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70:void 0}lexSpace(){let t=this.column,i=this.line,n=this.pos;for(;" "==this.currentChar||"\t"==this.currentChar;)this.next();let r=this.pos;this.pushToken(e.space,this.input.substring(n,r),i,t)}lexCharacterConstant(){let t=this.column,i=this.line;this.next();let n=this.currentChar;if("\\"==n){let e=o[this.nextChar];null==e?(this.pushError("Die Escape-Sequenz \\"+this.nextChar+" gibt es nicht.",2),"'"!=this.nextChar&&(n=this.nextChar,this.next())):(n=e,this.next())}this.next(),"'"!=this.currentChar?this.pushError("Das Ende der char-Konstante wird erwartet (').",1):this.next(),this.pushToken(e.charConstant,n,i,t)}lexStringConstant(t){let i=this.line,n=this.column,r="";for(this.next();;){let e=this.currentChar;if("\\"==e){let t=o[this.nextChar];null==t?this.pushError("Die Escape-Sequenz \\"+this.nextChar+" gibt es nicht.",2):(e=t,this.next())}else if(e==t){if(this.next(),this.currentChar!=t)break;r+=t}else if("\n"==e||e==s){this.pushError("Innerhalb einer String-Konstante wurde das Zeilenende erreicht.",r.length+1,"error",i,n);break}r+=e,this.next()}"'"==t?this.pushToken(e.stringConstant,r,i,n,r.length+2):(this.pushToken(e.identifier,r,i,n,r.length+2),this.tokenList[this.tokenList.length-1].isDoubleQuotedIdentifier=!0)}lexMultilineComment(){let t=this.line,i=this.column,n=!1,r="/*";for(this.next(),this.next();;){let e=this.currentChar;if("*"==e&&"/"==this.nextChar){this.next(),this.next(),r+="*/";break}if(e==s){this.pushError("Innerhalb eines Mehrzeilenkommentars (/*... */) wurde das Dateiende erreicht.",1);break}"\n"==e?(this.line++,this.column=0,n=!0,r+=e):n&&" "==e||(r+=e,n=!1),this.next()}this.pushToken(e.comment,r,t,i)}lexEndofLineComment(t){let i=this.line,n=this.column,r=t;for(let e=0;e<t.length;e++)this.next();for(;;){let e=this.currentChar;if("\n"==e)break;if(e==s)break;r+=e,this.next()}this.pushToken(e.comment,r,i,n)}lexNumber(){let t=this.line,i=this.column,n=1;"-"==this.currentChar&&(n=-1,this.next());let r=this.pos,o=this.currentChar;this.next();let s=10;for("0"==o&&["b","x","0","1","2","3","4","5","6","7"].indexOf(this.currentChar)>=0&&("x"==this.currentChar?(s=16,this.next()):"b"==this.currentChar?(s=2,this.next()):s=8,r=this.pos);this.isDigit(this.currentChar,s);)this.next();let a=e.integerConstant;if("."==this.currentChar){for(a=e.floatingPointConstant,this.next();this.isDigit(this.currentChar,10);)this.next();10!=s&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-r,"error",this.line,this.column-(this.pos-r))}let l=this.input.substring(r,this.pos);r=this.pos;let d=0,u=!1;if("e"==this.currentChar){u=!0,this.next();let e=this.pos;for("-"==this.currentChar&&this.next();this.isDigit(this.currentChar,10);)this.next();10!=s&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-r,"error",this.line,this.column-(this.pos-r));let t=this.input.substring(e,this.pos);d=Number.parseInt(t)}"d"!=this.currentChar&&"f"!=this.currentChar||(e.floatingPointConstant,this.next(),10!=s&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-r,"error",this.line,this.column-(this.pos-r)));let h=a==e.integerConstant?Number.parseInt(l,s):Number.parseFloat(l);h*=n,0!=d&&(h*=Math.pow(10,d)),this.pushToken(a,h,t,i)}lexAnnotation(){let t=this.line,i=this.column-1,r=this.pos,o=this.currentChar;for(this.next();null==n[o]&&!this.isSpace(o)&&o!=s;)this.next(),o=this.currentChar;let a=this.pos,l=this.input.substring(r,a);this.pushToken(e.at,l,t,i,l.length+1)}lexIdentifierOrKeyword(){let t=this.line,i=this.column,o=this.pos,a=this.currentChar;for(;null==n[a]&&!this.isSpace(a)&&a!=s;)this.next(),a=this.currentChar;let l=this.pos,d=this.input.substring(o,l),u=r[d.toLowerCase()];if(null==u||"number"!=typeof u)this.pushToken(e.identifier,d,t,i);else switch(u){case e.true:this.pushToken(e.booleanConstant,!0,t,i);break;case e.false:this.pushToken(e.booleanConstant,!1,t,i);break;default:this.pushToken(u,d,t,i)}}isSpace(e){return" "==e||"\n"==e}}class l{constructor(){this.autoFormatTriggerCharacters=["\n"],this.displayName="Java-Autoformat"}init(){monaco.languages.registerDocumentFormattingEditProvider("myJava",this),monaco.languages.registerOnTypeFormattingEditProvider("myJava",this)}provideOnTypeFormattingEdits(e,t,i,n,r){let o=this.format(e);return Promise.resolve(o)}deleteOverlappingRanges(e){for(let t=0;t<e.length-1;t++){let i=e[t],n=e[t+1];if(!(i.range.endLineNumber<n.range.startLineNumber)&&i.range.endLineNumber==n.range.startLineNumber)if(i.range.endColumn>=n.range.startColumn)e.splice(t+1,1);else if(0==i.range.endColumn&&i.text.length>0&&1==n.range.startColumn&&n.range.endColumn>n.range.startColumn&&""==n.text){let r=i.text.length-(n.range.endColumn-n.range.startColumn);r>0?(i.text=i.text.substr(0,r),e.splice(t+1,1)):r<0?(n.range.endColumn=n.range.startColumn-r,e.splice(t,1),t--):(e.splice(t,2),t--)}}}provideDocumentFormattingEdits(e,t,i){let n=this.format(e);return Promise.resolve(n)}format(t){let i=[],n=t.getValue(monaco.editor.EndOfLinePreference.LF),r=(new a).lex(n).tokens;if(null==r)return[];let o=null,s=0,l=[],d=[],u=!1,h=0,c=0;for(let t=0;t<r.length;t++){let n=r[t];switch(h--,n.tt){case e.leftCurlyBracket:if(u&&(u=!1,d.push(s+2),s++),s++,l.push(n.position.line),null!=o){let t=o.tt;t!=e.rightBracket&&t!=e.identifier&&t!=e.leftRightSquareBracket||this.replaceBetween(o,n,i," ")}if(t<r.length-1){let n=r[t+1];n.tt!=e.newline&&n.tt!=e.space&&this.insertSpaces(i,n.position.line,n.position.column,1)}break;case e.rightCurlyBracket:d[d.length-1]==s&&(d.pop(),s--,this.deleteSpaces(i,n.position.line,1,3)),s--;let a=l.pop();if(null!=a&&a!=n.position.line)null!=o&&o.position.line==n.position.line&&this.replace(i,n.position,n.position,"\n"+" ".repeat(3*s));else if(t>0){let o=r[t-1];o.tt!=e.space&&o.tt!=e.newline&&this.insertSpaces(i,n.position.line,n.position.column,1)}break;case e.leftBracket:if(c++,t<r.length-2){let n=r[t+1],o=r[t+2];n.tt==e.space&&o.tt!=e.newline&&(this.deleteSpaces(i,n.position.line,n.position.column,n.position.length),t++,o.tt==e.rightBracket&&(t++,c--))}if(t>1){let n=r[t-1],o=r[t-2];n.tt!=e.space||o.tt==e.newline||this.isBinaryOperator(o.tt)||1==n.position.length&&this.deleteSpaces(i,n.position.line,n.position.column,1)}break;case e.rightBracket:if(c--,t>1){let n=r[t-1],o=r[t-2];n.tt==e.space&&o.tt!=e.newline&&this.deleteSpaces(i,n.position.line,n.position.column,n.position.length)}break;case e.newline:if(h=2,t<r.length-2){let a=this.isBinaryOperator(null==o?void 0:o.tt),l=this.isBinaryOperator(this.getNextNonSpaceToken(t,r).tt),d=r[t+1],u=r[t+2],h=0;if(d.tt==e.newline)break;let m=0;if(d.tt==e.space){if(u.tt==e.newline)break;h=d.position.length,t++,u.tt==e.rightCurlyBracket&&(m=-1)}d.tt==e.rightCurlyBracket&&(m=-1),(l||a)&&(m=1);let p=s+m;c>0&&p++,p<0&&(p=0);let f=3*p;f>h?this.insertSpaces(i,n.position.line+1,0,f-h):f<h&&this.deleteSpaces(i,n.position.line+1,0,h-f)}break;case e.space:t<r.length-1&&r[t+1].tt!=e.comment&&t>0&&r[t-1].tt!=e.newline&&n.position.length>1&&this.deleteSpaces(i,n.position.line,n.position.column,n.position.length-1);break;case e.comma:case e.semicolon:if(t>1){let n=r[t-1],o=r[t-2];n.tt==e.newline||o.tt==e.newline||this.isBinaryOperator(o.tt)||n.tt==e.space&&1==n.position.length&&this.deleteSpaces(i,n.position.line,n.position.column,1)}if(t<r.length-1){let n=r[t+1];n.tt!=e.comment&&n.tt!=e.space&&n.tt!=e.newline&&this.insertSpaces(i,n.position.line,n.position.column,1)}break;case e.rightSquareBracket:null!=o&&o.tt==e.leftSquareBracket&&this.replaceBetween(o,n,i,"")}if(this.isBinaryOperator(n.tt)){let s=n.tt==e.lower&&this.lowerBelongsToGenericExpression(t,r),a=n.tt==e.greater&&this.greaterBelongsToGenericExpression(t,r);if(h<=0&&null!=o&&[e.leftBracket,e.comma].indexOf(o.tt)<0){if(t>0){let o=r[t-1],l=s||a?0:1;o.tt==e.space?o.position.length!=l&&this.insertSpaces(i,o.position.line,o.position.column,l-o.position.length):1==l&&this.insertSpaces(i,n.position.line,n.position.column,1)}if(t<r.length-1){let n=r[t+1],o=s?0:1;n.tt==e.space?(a&&t<r.length-2&&r[t+2].tt==e.leftBracket&&(o=0),n.position.length!=o&&this.insertSpaces(i,n.position.line,n.position.column,o-n.position.length)):(a&&n.tt==e.leftBracket&&(o=0),1==o&&this.insertSpaces(i,n.position.line,n.position.column,1))}}}n.tt!=e.space&&n.tt!=e.newline&&(o=n)}return this.deleteOverlappingRanges(i),i}getNextNonSpaceToken(t,i){if(t==i.length-1)return i[t];let n=t+1;for(;n<i.length-1&&i[n].tt==e.space;)n++;return i[n]}lowerBelongsToGenericExpression(t,i){let n=t+1;for(;n<i.length;){let t=i[n].tt;if(t==e.greater)return!0;if([e.space,e.comma,e.identifier].indexOf(t)<0)return!1;n++}return!1}greaterBelongsToGenericExpression(t,i){let n=t-1;for(;n>=0;){let t=i[n].tt;if(t==e.lower)return!0;if([e.space,e.comma,e.identifier].indexOf(t)<0)return!1;n--}return!1}isBinaryOperator(t){return null!=t&&t>=e.modulo&&t<=e.equal}replaceBetween(e,t,i,n){let r={line:e.position.line,column:e.position.column+e.position.length},o={line:t.position.line,column:t.position.column};r.line==o.line&&o.column-r.column==n.length||this.replace(i,r,o,n)}deleteSpaces(e,t,i,n){e.push({range:{startColumn:i,startLineNumber:t,endColumn:i+n+(0==i?1:0),endLineNumber:t},text:""})}insertSpaces(e,t,i,n){n<0?this.deleteSpaces(e,t,i,-n):e.push({range:{startColumn:i,startLineNumber:t,endColumn:i,endLineNumber:t},text:" ".repeat(n)})}replace(e,t,i,n){e.push({range:{startColumn:t.column,startLineNumber:t.line,endColumn:i.column,endLineNumber:i.line},text:n})}}class d{constructor(){this.themes=[],this.initThemes()}switchTheme(e){for(let t of this.themes)if(t.name==e){this.internalSwitchTheme(t);break}}internalSwitchTheme(e){monaco.editor.setTheme(e.monacoTheme);let t=document.documentElement;for(const i of Object.keys(e.cssColors)){const n=e.cssColors[i];t.style.setProperty(i,n)}}initThemes(){this.themes.push({name:"dark",monacoTheme:"myCustomThemeDark",cssColors:{"--backgroundDark":"#1e1e1e","--backgroundLight":"#252526","--backgroundHeading":"#37373d","--backgroundSelected":"#2a2d2e","--fontColorNormal":"#c2cccc","--fontColorLight":"#e7e7e7","--slider":"#414141","--loginButtonBackgrond":"#59a15d","--loginButtonFontColor":"#000000","--loginMessageColor":"rgb(122, 48, 48)","--loginButtonHover":"#63a867","--loginButtonActive":"#94ffd1","--scrollbar":"#1e1e1e","--scrollbar-thumb":"#3e3e3e","--scrollbar-thumb-hover":"#5e5e5e","--scrollbar-thumb-active":"#7e7e7e","--submenu-hover":"#094771","--submenu-color":"#ffffff","--menuitemsdivider":"#616162","--file-hover":"hsla(0, 0%, 38%, 0.125)","--file-active":"#094771","--file-active-hover":"rgba(9, 71, 113, 0.827)","--file-errorcount":"red","--inplace-editor":"blue","--contextmenu-background":"#3c3c3c","--contextmenu-color":"rgb(212,212,212)","--contextmenu-hover-background":"#094771","--contextmenu-hover-color":"#ffffff","--error-filename":"#2a709e","--error-line-ative":"#094771","--error-line-hover":"rgba(96, 96, 96, 0.125)","--error-position":"#c0802d","--linecolumn":"#14c714","--reveal-error":"rgba(253, 101, 101, 0.745)","--reveal-method":"#2b2b7d2f","--reveal-errorline-background":"red","--reveal-error-whole-line":"rgba(255, 0, 0, 0.555)","--reveal-programpointer":"rgba(111, 214, 27, 0.337)","--reveal-syntaxelement":"rgb(85,85,85)","--margin-breakpoint":"rgba(255, 0, 0, 0.623)","--speedcontrol-bar":"#9d9d9d","--speedcontrol-grip":"#588555","--speedcontrol-grip-hover":"#89d185","--speedcontrol-display-background":"#383838","--speedcontrol-display-border":"#9d9d9d","--editorTooltip-background":"#252526","--editorTooltip-border":"#454545","--renameInput-color":"#ffffff","--bottomdiv-tabheading-hover":"white","--bottomdiv-tabheading-active":"rgb(97,97,255)","--noErrorMessage":"rgb(37, 211, 37)","--console-top-borderbottom":"#c4c4c4","--console-top-background":"#1e1e1e","--consoleEntry-withBorder":"#303030","--consoleEntryValue":"white","--consoleEntryIdentifier":"rgb(156, 156, 235)","--consoleEntryNoValue":"gray","--consoleEntryCaption":"white","--error-Caption":"rgb(166, 165, 176)","--console-error":"rgb(155, 51, 51)","--deIdentifier":"rgb(156, 156, 235)","--deValue":"white","--helper-background-color":"#383838","--helper-border-color":"#d4d4d4","--arrowBoxButtonOuter-background":"#59a15d","--arrowBoxButtonOuter-border":"#3d3d3d","--arrowBoxButtonOuter-color":"black","--arrowBoxButtonOuter-button-hover":"#63a867","--arrowBox-after":"rgba(136, 183, 213, 0)","--arrowBox-before":"rgba(194, 225, 245, 0)","--defaultOutputColor":"#ffffff","--runInputColor":"#ffffff","--runBackgroundColor":"rgba(255, 255, 255, 0.2)","--table-even":"#222","--table-heading":"#202060"}});let e="#8080ff";this.themes.push({name:"light",monacoTheme:"myCustomThemeLight",cssColors:{"--backgroundDark":"white","--backgroundLight":"#f3f3f3","--backgroundHeading":"#dcdcdc","--backgroundSelected":"#e8e8e8","--fontColorNormal":"#000","--fontColorLight":"#303030","--slider":"#b0b0b0","--loginButtonBackgrond":"#59a15d","--loginButtonFontColor":"#000000","--loginMessageColor":"rgb(122, 48, 48)","--loginButtonHover":"#63a867","--loginButtonActive":"#94ffd1","--scrollbar":"#e3e3e3","--scrollbar-thumb":"#bababa","--scrollbar-thumb-hover":"#8e8e8e","--scrollbar-thumb-active":"#616161","--submenu-hover":e,"--submenu-color":"#ffffff","--menuitemsdivider":"#cfcfcf","--file-hover":"#e8e8e8","--file-active":e,"--file-active-hover":"#a0a0ff","--file-errorcount":"red","--inplace-editor":"white","--contextmenu-background":"white","--contextmenu-color":"#756161","--contextmenu-hover-background":e,"--contextmenu-hover-color":"#a0a0ff","--error-filename":"#ff0000","--error-line-ative":"#ffa0a0","--error-line-hover":"#ffc0c0","--error-position":"#804040","--linecolumn":"#14c714","--reveal-error":"rgba(253, 101, 101, 0.745)","--reveal-method":"#babaec80","--reveal-errorline-background":"red","--reveal-error-whole-line":"rgba(255, 0, 0, 0.555)","--reveal-programpointer":"rgba(111, 214, 27, 0.337)","--reveal-syntaxelement":"#c0c0c0","--margin-breakpoint":"rgba(255, 0, 0, 0.623)","--speedcontrol-bar":"#9d9d9d","--speedcontrol-grip":"#588555","--speedcontrol-grip-hover":"#89d185","--speedcontrol-display-background":"#e0e0e0","--speedcontrol-display-border":"#9d9d9d","--editorTooltip-background":"#e0e0e0","--editorTooltip-border":"#9d9d9d","--renameInput-color":"#000000","--bottomdiv-tabheading-hover":"#424242","--bottomdiv-tabheading-active":"#424242","--noErrorMessage":"rgb(17, 180, 17)","--console-top-borderbottom":"#c4c4c4","--console-top-background":"white","--consoleEntry-withBorder":"#303030","--consoleEntryValue":"#0000a0","--consoleEntryIdentifier":"black","--consoleEntryNoValue":"gray","--consoleEntryCaption":"#756161","--error-Caption":"rgb(166, 165, 176)","--console-error":"rgb(155, 21, 21)","--deIdentifier":"black","--deValue":"#0000a0","--helper-background-color":"#f3f3f3","--helper-border-color":"#606060","--arrowBoxButtonOuter-background":"#59a15d","--arrowBoxButtonOuter-border":"#3d3d3d","--arrowBoxButtonOuter-color":"black","--arrowBoxButtonOuter-button-hover":"#63a867","--arrowBox-after":"rgba(136, 183, 213, 0)","--arrowBox-before":"rgba(194, 225, 245, 0)","--defaultOutputColor":"#303030","--runInputColor":"#000000","--runBackgroundColor":"rgba(0, 0, 0, 0.2)","--table-even":"#d1d2e4","--table-heading":"#c3f2b9"}})}}class u{}class h extends u{constructor(e,t,i,n,r){super(),this.name=e,this.parameterDescriptions=t,this.checkFunction=i,this.outputFunction=n,this.binaryResultTypes=new Map,this.unaryOperators=[],this.canCastToList=r.slice(0);let o=this.canCastToList.indexOf(e);o>=0&&this.canCastToList.splice(o,1)}static fromConstantType(t){switch(t){case e.stringConstant:return this.baseTypeMap.get("text");case e.integerConstant:return this.baseTypeMap.get("integer");case e.floatingPointConstant:return this.baseTypeMap.get("float");case e.charConstant:return this.baseTypeMap.get("text");case e.booleanConstant:return this.baseTypeMap.get("boolean");case e.keywordNull:return this.baseTypeMap.get("null")}}getBaseTypeName(){return this.name}toString(){return this.name}static getBaseType(e){return null!=e&&"char"==e.toLocaleLowerCase()&&(e="varchar"),this.baseTypeMap.get(e.toLocaleLowerCase())}static addBaseTypes(e){h.baseTypes=h.baseTypes.concat(e),e.forEach((e=>h.baseTypeMap.set(e.name,e)))}addBinaryOperation(e,t,i,n=!0){Array.isArray(e)||(e=[e]),e.forEach((e=>{let r=this.binaryResultTypes.get(e);null==r&&(r=new Map,this.binaryResultTypes.set(e,r)),r.set(t,i),n&&t!=this&&t.addBinaryOperation(e,this,i,!1)}))}canCastTo(e){let t=e instanceof h?e:e.baseType;return this.canCastToList.indexOf(t.name)>=0||this.name==t.name}getBinaryResultType(e,t){let i=this.binaryResultTypes.get(e);if(null==i)return null;let n=t instanceof h?t:t.baseType;return i.get(n)}getUnaryResultType(t){return[e.isNull,e.isNotNull].indexOf(t)>=0?F:this.unaryOperators.indexOf(t)>=0?this:void 0}getBinaryResult(t,i,n){switch(t){case e.concatenation:case e.plus:return null!=i&&null!=n?i+n:null!=i?i:n;case e.minus:return null!=i&&null!=n?i-n:null!=i?i:n;case e.multiplication:case e.division:case e.keywordAnd:return null!=i&&null!=n?i*n:null!=i?i:n;case e.keywordOr:return null!=i&&null!=n?Math.max(i,n):null!=i?i:n;case e.lower:return null!=i&&null!=n?i<n:null==i;case e.greater:return null!=i&&null!=n?i>=n:null==i;case e.lowerOrEqual:return null!=i&&null!=n?i<=n:null==i;case e.greaterOrEqual:return null!=i&&null!=n?i>=n:null==i;case e.equal:return i==n;case e.notEqual:return i!=n}}}h.baseTypes=[],h.baseTypeMap=new Map;let c=[1,10,100,1e3,1e5,1e5,1e6,1e7,1e8,1e9];class m extends u{constructor(e,t){super(),this.baseType=e,this.parameterValues=t;let i=t.join(", ");this.name=e.name+"("+i+")"}toString(){return this.name}getBaseTypeName(){return this.baseType.name}canCastTo(e){let t=e instanceof h?e:e.baseType;return this.baseType.canCastToList.indexOf(t.name)>=0||this.baseType.name==t.name}getBinaryResultType(t,i){let n=this.baseType.binaryResultTypes.get(t);if(null==n)return null;let r=i instanceof h?i:i.baseType,o=n.get(r);if(this.baseType==r&&this.baseType==o&&i instanceof m){if("varchar"==this.baseType.name||t==e.concatenation)return new m(this.baseType,[this.parameterValues[0]+i.parameterValues[0]]);if("decimal"==this.baseType.name)return new m(this.baseType,[Math.max(this.parameterValues[0],i.parameterValues[0]),Math.max(this.parameterValues[1],i.parameterValues[1])])}return n.get(r)}getUnaryResultType(e){return this.baseType.getUnaryResultType(e)}getBinaryResult(e,t,i){let n=this.baseType.getBinaryResult(e,t,i);return(this.name="varchar")?null==n?null:(""+n).substr(0,this.parameterValues[0]):"decimal"==this.name?null==n?null:Math.round(n*c[this.parameterValues[1]])/c[this.parameterValues[1]]:n}}let p=["varchar","char","text","tinytext","mediumtext","longtext"];var f=new h("varchar",["Maximale Länge"],((e,t)=>`check(length(${e}) <= ${Math.max(t[0],1)})`),((e,t)=>e.substring(0,Math.max(t[0],1))),p),g=new h("char",["Maximale Länge"],((e,t)=>`check(length(${e}) <= ${Math.max(t[0],1)})`),((e,t)=>e.substring(0,Math.max(t[0],1))),p),b=new h("text",["Maximale Länge"],((e,t)=>""),((e,t)=>e),p.concat(["time","date","datetime","timestamp"])),w=new h("tinyText",[],((e,t)=>""),((e,t)=>e),p),k=new h("mediumText",[],((e,t)=>""),((e,t)=>e),p),y=new h("longText",[],((e,t)=>""),((e,t)=>e),p);let v=["decimal","numeric","double","real","float"];var C=new h("decimal",["Gesamtzahl der Stellen","Nachkommastellen"],((e,t)=>""),((e,t)=>{let i=Math.trunc(e),n=e-i;return i+(t[1]>0?"."+Math.round(n*c[t[1]]):"")}),v),T=new h("numeric",["Gesamtzahl der Stellen","Nachkommastellen"],((e,t)=>""),((e,t)=>""+e),v),x=new h("double",["Gesamtzahl der Stellen","Nachkommastellen"],((e,t)=>""),((e,t)=>""+e),v),E=new h("real",[],((e,t)=>""),((e,t)=>""+e),v),S=new h("float",[],((e,t)=>""),((e,t)=>""+e),v);let _=["int","integer","tinyint","smallint","mediumint","bigint"].concat(v);var j=new h("int",["Maximale Anzahl der Stellen"],((e,t)=>`check(round(${e}) = ${e})`),((e,t)=>""+Math.round(e)),_),D=new h("integer",["Maximale Anzahl der Stellen"],((e,t)=>`check(round(${e}) = ${e})`),((e,t)=>""+Math.round(e)),_),L=new h("tinyint",["Maximale Anzahl der Stellen"],((e,t)=>`check(round(${e}) = ${e})`),((e,t)=>""+Math.round(e)),_),P=new h("smallint",["Maximale Anzahl der Stellen"],((e,t)=>`check(round(${e}) = ${e})`),((e,t)=>""+Math.round(e)),_),M=new h("mediumint",["Maximale Anzahl der Stellen"],((e,t)=>`check(round(${e}) = ${e})`),((e,t)=>""+Math.round(e)),_),I=new h("bigint",["Maximale Anzahl der Stellen"],((e,t)=>`check(round(${e}) = ${e})`),((e,t)=>""+Math.round(e)),_),O=new h("time",[],((e,t)=>`check(isTime(${e}))`),((e,t)=>e),[]),B=new h("date",[],((e,t)=>`check(isDate(${e}))`),((e,t)=>e),[]),A=new h("datetime",[],((e,t)=>`check(isDateTime(${e}))`),((e,t)=>e),["timestamp"]),N=new h("timestamp",[],((e,t)=>`check(isDateTime(${e}))`),((e,t)=>e),["datetime"]),F=new h("boolean",[],((e,t)=>`check(${e} == 0 or ${e} == 1)`),((e,t)=>1==e?"true":"false"),["varchar","text","decimal","numeric"]),Q=new h("null",[],((e,t)=>""),((e,t)=>e),[]);let R=[C,T,x,E,S,j,D,L,P,M,I],W=[f,g,b,w,k,y,O,B,A,N,F,Q].concat(R),z=[O,B,A,N];h.addBaseTypes(W),f.addBinaryOperation(e.concatenation,f,f),f.addBinaryOperation(e.concatenation,g,f),f.addBinaryOperation(e.concatenation,b,b),b.addBinaryOperation(e.concatenation,b,b),f.addBinaryOperation(e.keywordLike,f,F),f.addBinaryOperation(e.keywordLike,b,F),b.addBinaryOperation(e.keywordLike,b,F),g.addBinaryOperation(e.concatenation,g,g),g.addBinaryOperation(e.concatenation,f,g),g.addBinaryOperation(e.concatenation,b,b),b.addBinaryOperation(e.concatenation,b,b),g.addBinaryOperation(e.keywordLike,g,F),g.addBinaryOperation(e.keywordLike,b,F),b.addBinaryOperation(e.keywordLike,b,F);let q=[e.plus,e.minus,e.multiplication,e.division,e.modulo],H=[e.lower,e.lowerOrEqual,e.greater,e.greaterOrEqual,e.equal,e.notEqual];for(let t=0;t<R.length;t++){for(let e=t;e<R.length;e++)R[t].addBinaryOperation(q,R[e],R[e]),R[t].addBinaryOperation(H,R[e],F);R[t].unaryOperators=[e.minus]}C.addBinaryOperation(q,C,C);let U=[f,b];for(let t=0;t<U.length;t++)for(let i=t;i<U.length;i++)U[t].addBinaryOperation(e.concatenation,U[i],U[i]),U[t].addBinaryOperation(H,U[i],F);for(let e=0;e<z.length;e++){z[e].addBinaryOperation(H,z[e],F);for(let t=0;t<U.length;t++)z[e].addBinaryOperation(H,U[t],F),U[t].addBinaryOperation(H,z[e],F)}let K=[e.keywordAnd,e.keywordOr];F.addBinaryOperation(K,F,F),F.unaryOperators=[e.keywordNot],W.forEach((t=>t.unaryOperators=t.unaryOperators.concat([e.isNull,e.isNotNull])));class V{constructor(){this.lookahead=4,this.endToken={position:{line:0,column:0,length:1},tt:e.endofSourcecode,value:"das Ende des Programms"},this.beginStatementKeywords=["select","insert into","update","create table","delete from","alter table","drop table"],this.identifierMap={year:"int",binary:"varchar",varbinary:"varchar"}}parse(e){if(this.module=e,this.tokenList=e.tokenList,this.errorList=[],e.completionHints=new Map,0==this.tokenList.length)return this.module.sqlStatements=[],this.module.errors[1]=this.errorList,void this.module.addCompletionHint({line:0,column:0,length:0},{line:2e4,column:100,length:0},!1,!1,this.beginStatementKeywords);this.pos=0,this.initializeLookahead();let t=this.tokenList[this.tokenList.length-1];this.endToken.position={line:t.position.line,column:t.position.column+t.position.length,length:1},this.module.sqlStatements=this.parseMain(),this.module.errors[1]=this.errorList}initializeLookahead(){this.ct=[];for(let t=0;t<this.lookahead;t++){let i=this.endToken;for(;!(this.pos>=this.tokenList.length);){let t=this.tokenList[this.pos];if(t.tt==e.comment&&(this.lastComment=t),t.tt!=e.newline&&t.tt!=e.space&&t.tt!=e.comment){i=t,null!=this.lastComment&&(i.commentBefore=this.lastComment,this.lastComment=null);break}this.pos++}this.ct.push(i),t<this.lookahead-1&&this.pos++}this.cct=this.ct[0],this.tt=this.cct.tt,this.position=this.cct.position}nextToken(){let t;for(this.lastToken=this.cct;;){if(this.pos++,this.pos>=this.tokenList.length){t=this.endToken;break}if(t=this.tokenList[this.pos],t.tt==e.comment&&(this.lastComment=t),t.tt!=e.newline&&t.tt!=e.space&&t.tt!=e.comment){t.commentBefore=this.lastComment,this.lastComment=null;break}}for(let e=0;e<this.lookahead-1;e++)this.ct[e]=this.ct[e+1];this.ct[this.lookahead-1]=t,this.cct=this.ct[0],this.tt=this.cct.tt,this.position=this.cct.position}pushError(e,t="error",i,n){null==i&&(i=Object.assign({},this.position)),this.errorList.push({text:e,position:i,quickFix:n,level:t})}skip(e){Array.isArray(e)||(e=[e]),e.indexOf(this.tt)>=0&&this.nextToken()}expect(t,n=!0,r=!1){if(this.tt!=t&&!(Array.isArray(t)&&t.indexOf(this.tt)>=0)){if(t==e.semicolon&&this.tt==e.endofSourcecode)return!0;let n=this.cct.position;t==e.semicolon&&null!=this.lastToken&&this.lastToken.position.line<n.line&&(n={line:this.lastToken.position.line,column:this.lastToken.position.column+this.lastToken.position.length,length:1});let o,s=null;if(t==e.semicolon&&this.lastToken.position.line<this.cct.position.line&&!this.isOperatorOrDot(this.lastToken.tt)&&(s={title:"Strichpunkt hier einfügen",editsProvider:e=>[{resource:e,edit:{range:{startLineNumber:n.line,startColumn:n.column,endLineNumber:n.line,endColumn:n.column,message:"",severity:monaco.MarkerSeverity.Error},text:";"}}]},r&&this.module.main.getSemicolonAngel().register(n,this.module)),Array.isArray(t)){o=t.map((e=>i[e]));let e=o.join(", ");this.pushError("Erwartet wird eines der folgenden: "+e+" - Gefunden wurde: "+i[this.tt],"error",n,s)}else o=[i[t]],this.pushError("Erwartet wird: "+i[t]+" - Gefunden wurde: "+i[this.tt],"error",n,s);return!1}return n&&this.nextToken(),!0}getEndOfPosition(e){return{line:e.line,column:e.column+e.length,length:0}}isOperatorOrDot(t){if(t==e.dot)return!0;for(let e of V.operatorPrecedence)for(let i of e)if(t==i)return!0}isEnd(){return this.cct==this.endToken}comesToken(e,t=!1){if(!Array.isArray(e)){let i=this.tt==e;return i&&t&&this.nextToken(),i}return e.indexOf(this.tt)>=0}getCurrentPosition(){return Object.assign({},this.position)}getCurrentPositionPlus(t){if(this.tt==e.endofSourcecode)return{line:this.endToken.position.line,column:100,length:1};let i=0,n=t,r=0;for(;i<this.lookahead-1&&(r=this.ct[i].position.length)<n;)n-=r,i++;let o=this.ct[i].position;return null==o&&(o=this.getCurrentPosition()),{line:o.line,column:o.column+n,length:1}}getEndOfCurrentToken(){let e=this.getCurrentPosition();return e.column=e.column+this.position.length,e.length=0,e}parseMain(){let t=[],n={column:0,line:1e4,length:1},r={column:0,line:0,length:0},o=!0;for(this.module.addCompletionHint(r,this.getCurrentPositionPlus(8),!1,!1,this.beginStatementKeywords);!this.isEnd();){let s=this.pos,a=this.errorList.length;for(;[e.space,e.newline,e.comment,e.semicolon].indexOf(this.cct.tt)>=0;)this.nextToken();let l=this.getCurrentPosition(),d=this.parseStatement();for(r={line:this.lastToken.position.line+1,column:0,length:0},o=this.tt==e.semicolon;this.tt==e.semicolon;)this.nextToken();let u=!1;for(let e=a;e<this.errorList.length;e++)"error"==this.errorList[e].level&&(u=!0);if(null!=d&&t.push({ast:d,from:l,to:this.getEndOfPosition(this.lastToken.position),hasErrors:u,acceptedBySQLite:!1}),n=this.getCurrentPosition(),this.pos==s){let t=[e.keywordSelect,e.keywordUpdate,e.keywordCreate,e.keywordInsert,e.keywordDelete,e.keywordDrop,e.keywordAlter],n=!0;for(;!this.isEnd()&&t.indexOf(this.tt)<0;)[e.space,e.newline].indexOf(this.tt)<0&&n&&(this.pushError("Erwartet wird eines dieser Schlüsselwörter: "+t.map((e=>i[e])).join(", ")+"; Gefunden wurde: "+this.cct.value),n=!0),this.nextToken()}(o||this.cct.position.line-r.line>0)&&this.module.addCompletionHint(r,this.getCurrentPositionPlus(8),!1,!1,this.beginStatementKeywords)}return this.module.addCompletionHint(r,{line:this.endToken.position.line+1,column:0,length:0},!1,!1,this.beginStatementKeywords),t}parseStatement(t=!0){switch(this.tt){case e.keywordSelect:return this.parseSelect();case e.keywordInsert:return this.parseInsert();case e.keywordCreate:return this.parseCreateTableOrDatabase();case e.keywordUpdate:return this.parseUpdate();case e.keywordDelete:return this.parseDelete();case e.keywordDrop:return this.parseDropTable();case e.keywordAlter:return this.parseAlterTable();case e.keywordCommit:return this.pushError("Die Aweisung commit ist unnötig, da jede Anweisung automatisch commited wird.","info"),this.nextToken(),null;case e.keywordSet:return this.parseSet();case e.keywordUse:return this.parseUse();case e.keywordStart:return this.pushError("Die Aweisung 'start transaction' ist unnötig, da jede Anweisung automatisch commited wird.","info"),this.nextToken(),this.expect(e.keywordTransaction,!0),null;case e.keywordLock:case e.keywordUnlock:return this.parseLockUnlock(),null;default:let t=i[this.tt];null==t&&(t=""),t!=this.cct.value&&(t+="("+this.cct.value+")"),t+=" wird hier nicht erwartet.",this.pushError(t),this.nextToken()}return null}parseLockUnlock(){this.nextToken(),this.expect(e.keywordTables,!0),this.skip(e.identifier),this.skip([e.keywordWrite,e.keywordRead]),this.skip(e.semicolon)}parseSet(){this.pushError("Das SET-Statement wird von SQLite nicht unterstützt. Diese Anweisung wird daher einfach überlesen.","info");let t={type:e.omittedeStatement,position:this.getCurrentPosition(),endPosition:null,symbolTable:null};return this.nextToken(),this.expect(e.identifier,!0),this.expect(e.equal,!0),this.expect([e.identifier,e.stringConstant,e.integerConstant,e.charConstant,e.booleanConstant,e.floatingPointConstant],!0),t.endPosition=this.getCurrentPosition(),t}parseUse(){this.pushError("Das USE-Statement wird von SQLite nicht unterstützt. Diese Anweisung wird daher einfach überlesen. Sie können eine andere Datenbank auswählen indem Sie in der Datenbankliste links darauf klicken.","info");let t={type:e.omittedeStatement,position:this.getCurrentPosition(),endPosition:null,symbolTable:null};return this.nextToken(),this.expect(e.identifier,!0),t.endPosition=this.getCurrentPosition(),t}parseAlterTable(){let t=this.getCurrentPosition();this.nextToken();let i={type:e.keywordAlter,kind:null,position:t,endPosition:this.getEndOfPosition(this.getCurrentPosition()),symbolTable:null,tableIdentifier:null,tableIdentifierPosition:null};if(this.expect(e.keywordTable,!0)||this.addCompletionHintHere(!1,!1,["table"],1),this.addCompletionHintHere(!1,!0,[],1),!this.expect(e.identifier,!1))return i;switch(i.tableIdentifier=this.cct.value,i.tableIdentifierPosition=this.getCurrentPosition(),this.nextToken(),i.endPosition=this.getCurrentPosition(),this.addCompletionHintHere(!1,!1,["rename to","rename column","add column","drop column"],1),this.tt){case e.keywordRename:this.parseRenameTableOrColumn(i);break;case e.keywordAdd:this.parseAlterTableAdd(i);break;case e.keywordDrop:this.parseDropColumn(i);break;default:this.pushError("Erwartet wird rename to, rename column, add column oder drop column")}return i}parseRenameTableOrColumn(t){switch(this.nextToken(),this.comesToken(e.keywordTo)||this.addCompletionHintHere(t.tableIdentifier,!1,["column","to"],3),t.endPosition=this.getEndOfCurrentToken(),this.tt){case e.keywordTo:return this.nextToken(),t.endPosition=this.getEndOfCurrentToken(),t.kind="renameTable",void(this.comesToken(e.identifier)?(t.newTableName=this.cct.value,this.nextToken(),t.endPosition=this.getEndOfCurrentToken()):this.pushError("Erwartet wird der neue Tabellenname."));case e.keywordColumn:if(this.nextToken(),t.endPosition=this.getEndOfCurrentToken(),this.addCompletionHintHere(t.tableIdentifier,!1,[],3),!this.comesToken(e.identifier))return void this.pushError("Erwartet wird der Name einer Spalte der Tabelle "+t.tableIdentifier+".");if(t.kind="renameColumn",t.oldColumnName=this.cct.value,t.oldColumnPosition=this.getCurrentPosition(),this.nextToken(),this.addCompletionHintHere(!1,!1,["to"],3),t.endPosition=this.getEndOfCurrentToken(),!this.expect(e.keywordTo,!0))return;return t.endPosition=this.getEndOfCurrentToken(),void(this.comesToken(e.identifier)?(t.newColumnName=this.cct.value,this.nextToken(),t.endPosition=this.getEndOfCurrentToken()):this.pushError("Erwartet wird der neue Spaltenname."));default:return void this.pushError("Erwartet wird das Schlüsselwort 'to' (zum Umbenennen der Tabelle) oder das Schlüsselwor 'column' (zum Umbenennen einer Spalte).")}}parseDropColumn(t){this.nextToken(),this.comesToken(e.keywordColumn,!0),t.oldColumnPosition=this.getCurrentPosition(),this.addCompletionHintHere(t.tableIdentifier,!1,[],3),t.kind="dropColumn",t.endPosition=this.getEndOfCurrentToken(),this.comesToken(e.identifier)?(t.oldColumnName=this.cct.value,this.nextToken()):this.pushError("Erwartet wird der Bezeichner der Spalte, die gelöscht werden soll.")}parseAlterTableAdd(t){do{this.nextToken(),this.comesToken(e.keywordAdd,!0);let i=!1;switch(this.tt){case e.keywordColumn:this.parseAddColumn(t);break;case e.keywordPrimary:this.parseAddPrimaryKey(t);break;case e.keywordUnique:this.nextToken(),i=!0,this.expect([e.keywordIndex,e.keywordKey],!1);case e.keywordKey:case e.keywordIndex:this.parseAddIndex(t,i);break;case e.keywordModify:this.parseModifyColumn(t);break;case e.keywordConstraint:this.parseAddConstraint(t)}}while(this.tt==e.comma)}parseAddConstraint(t){if(this.nextToken(),this.expect(e.identifier)&&this.comesToken(e.keywordForeign)){let e=this.parseForeignKeyDefinition();null!=e&&(null==t.foreignKeys&&(t.foreignKeys=[]),t.foreignKeys.push(e),t.kind="omittedKind")}}parseForeignKeyDefinition(){let t={column:"",referencesTable:"",referencesColumn:"",referencesPosition:this.getCurrentPosition()};if(this.expect(e.keywordForeign)&&this.expect(e.keywordKey)&&this.expect(e.leftBracket))if(this.comesToken(e.identifier)){if(t.column=this.cct.value,this.nextToken(),this.expect(e.rightBracket))return this.parseReferences(t),t}else this.pushError("Der Bezeichner der Fremdschlüsselspalte wird erwartet.")}parseReferences(t){if(!this.expect(e.keywordReferences))return;if(this.addCompletionHintHere(!1,!0,[]),!this.comesToken(e.identifier))return void this.pushError("Der Bezeichner der referenzierten Tabelle wird erwartet.");t.referencesTable=this.cct.value,this.nextToken();let i=this.lastToken.position,n=this.getCurrentPosition();if(this.module.addCompletionHint(this.getEndOfPosition(i),n,t.referencesTable,!1,[]),this.expect(e.leftBracket))if(this.comesToken(e.identifier)){if(t.referencesColumn=this.cct.value,this.nextToken(),this.expect(e.rightBracket))for(;this.tt==e.keywordOn;){this.nextToken();let i="";switch(this.tt){case e.keywordDelete:i="onDelete";break;case e.keywordUpdate:i="onUpdate"}switch(""==i?(this.pushError("Nach 'on' wird 'delete' oder 'update' erwartet."),this.comesToken([e.keywordCascade,e.keywordRestrict,e.keywordSet,e.keywordNo])||(this.nextToken(),i="onDelete")):this.nextToken(),this.tt){case e.keywordCascade:case e.keywordRestrict:t[i]=this.cct.value,this.nextToken();break;case e.keywordSet:t[i]="set ",this.nextToken(),[e.keywordNull,e.keywordDefault].indexOf(this.tt)>=0?(t[i]+=this.cct.value,this.nextToken()):this.pushError("Nach 'on delete/update set' wird 'null' oder 'default' erwartet.");break;case e.keywordNo:this.nextToken(),this.expect(e.keywordAction),t[i]="no action";break;default:this.pushError("Nach 'on delete/update' wird 'cascade', 'set null', 'set default' oder 'no action' erwartet.")}}}else this.pushError("Der Bezeichner der referenzierten Spalte wird erwartet.")}parseModifyColumn(e){this.nextToken();let t=this.parseColumnDefinition(!1);null!=t&&(null==e.modifyColumnInfo&&(e.modifyColumnInfo=[]),e.modifyColumnInfo.push(t))}parseAddPrimaryKey(t){if(this.nextToken(),t.primaryKeys=[],this.expect(e.keywordKey,!0)&&this.expect(e.leftBracket,!1))do{this.nextToken(),this.tt==e.identifier&&(t.primaryKeys.push(this.cct.value),this.nextToken())}while(this.tt==e.comma);return this.expect(e.rightBracket,!0)?(t.kind="omittedKind",t):null}parseAddIndex(t,i){this.nextToken();let n={index_name:"",column:"",unique:i};return this.tt!=e.identifier?(this.pushError("Erwartet wird der Bezeichner des Index."),null):(n.index_name=this.cct.value,this.nextToken(),this.expect(e.leftBracket,!0)?this.tt!=e.identifier?(this.pushError("Erwartet wird der Bezeichner der Spalte, für die ein Index erstellt werden soll."),null):(n.column=this.cct.value,this.nextToken(),null==t.indices&&(t.indices=[]),t.indices.push(n),t.kind="omittedKind",this.expect(e.rightBracket,!0),null):null)}parseAddColumn(t){t.kind="addColumn",this.comesToken(e.keywordColumn,!0),t.columnDefBegin=this.getCurrentPosition(),t.columnDef=this.parseColumnDefinition(!1)}parseDropTable(){let t=this.getCurrentPosition();this.nextToken();let i={type:e.keywordDrop,position:t,endPosition:this.getEndOfPosition(this.getCurrentPosition()),symbolTable:null,tableIdentifier:null,tableIdentifierPosition:null,ifExists:!1};return this.expect(e.keywordTable,!0)||this.addCompletionHintHere(!1,!1,["table"],1),this.comesToken(e.keywordIf,!0)&&(i.ifExists=!0,this.expect(e.keywordExists,!0)),this.addCompletionHintHere(!1,!0,[],1,"",";"),this.expect(e.identifier,!1)?(i.tableIdentifier=this.cct.value,i.tableIdentifierPosition=this.getCurrentPosition(),this.nextToken(),i.endPosition=this.getCurrentPosition(),i):i}parseDelete(){let t=this.getCurrentPosition();this.nextToken();let i={type:e.keywordDelete,position:t,endPosition:this.getEndOfPosition(this.getCurrentPosition()),symbolTable:null,tableIdentifier:null,tableIdentifierPosition:null,whereNode:null,whereNodeBegin:null,whereNodeEnd:null};return this.expect(e.keywordFrom,!0)||this.addCompletionHintHere(!1,!1,["from"],1),this.addCompletionHintHere(!1,!0,[],1,""," where\n\t"),this.expect(e.identifier,!1)?(i.tableIdentifier=this.cct.value,i.tableIdentifierPosition=this.getCurrentPosition(),this.nextToken(),i.endPosition=this.getCurrentPosition(),this.addCompletionHintHere(!1,!1,["where\n\t"],1),this.tt!=e.keywordWhere||(this.nextToken(),i.endPosition=this.getCurrentPosition(),i.whereNodeBegin=this.getEndOfPosition(this.lastToken.position),i.whereNode=this.parseTerm(),i.whereNodeEnd=this.getCurrentPosition(),this.module.addCompletionHint(i.whereNodeBegin,this.getCurrentPositionPlus(3),i.tableIdentifier,!1,[]),i.endPosition=this.getCurrentPosition()),i):i}parseUpdate(){let t=this.getCurrentPosition();this.nextToken();let i={type:e.keywordUpdate,position:t,endPosition:this.getEndOfPosition(this.getCurrentPosition()),symbolTable:null,tableIdentifier:null,tableIdentifierPosition:null,columnIdentifiers:[],columnIdentifierPositions:[],values:[],valuePosBegin:[],valuePosEnd:[],whereNode:null,whereNodeBegin:null,whereNodeEnd:null};if(this.addCompletionHintHere(!1,!0,[],1,""," set\n\t"),!this.expect(e.identifier,!1))return i;if(i.tableIdentifier=this.cct.value,i.tableIdentifierPosition=this.getCurrentPosition(),this.nextToken(),i.endPosition=this.getCurrentPosition(),this.addCompletionHintHere(!1,!1,["set\n\t"],1),!this.expect(e.keywordSet))return i;let n=!0;do{if(this.addCompletionHintHere(i.tableIdentifier,!1,n?[]:["where"],1,null," = "),n=!1,this.tt!=e.identifier){this.pushError("Hier wird der Bezeichner derjenigen Spalte der Tabelle "+i.tableIdentifier+" erwaretet, deren Wert verändert werden soll.","error");break}i.columnIdentifiers.push(this.cct.value),i.columnIdentifierPositions.push(this.getCurrentPosition()),this.nextToken(),this.expect(e.equal,!0),i.valuePosBegin.push(this.getCurrentPosition()),i.values.push(this.parseTerm()),i.valuePosEnd.push(this.getCurrentPosition())}while(this.comesToken(e.comma,!0));if(i.endPosition=this.getCurrentPosition(),this.lastToken.tt!=e.comma||this.comesToken(e.keywordWhere)){if(!this.expect(e.keywordWhere,!0))return i;i.whereNodeBegin=this.getEndOfPosition(this.lastToken.position),i.whereNode=this.parseTerm(),i.whereNodeEnd=this.getCurrentPosition(),this.module.addCompletionHint(i.whereNodeBegin,i.whereNodeEnd,i.tableIdentifier,!1,[]),i.endPosition=this.getCurrentPosition()}else this.comesToken(e.keywordWhere,!0);return i}parseCreateTableOrDatabase(){switch(this.ct[1].tt){case e.keywordDatabase:return this.parseCreateDatabase();case e.keywordTable:return this.parseCreateTable();default:return this.nextToken(),this.pushError("Nach 'create' wird 'table' erwartet."),this.nextToken(),null}}parseCreateDatabase(){let t={type:e.omittedeStatement,position:this.getCurrentPosition(),endPosition:null,symbolTable:null};for(this.nextToken(),this.pushError("Die CREATE-DATABASE-Anweisung wird von der SQLite-Engine nicht unterstützt. Sie können eine neue Datenbank anlegen, indem Sie auf den entsprechenden Button oberhalb der Liste der Datenbanken (linke Seite des Fensters) klicken. Diese Anweisung wird überlesen.","info");this.tt!=e.semicolon&&this.tt!=e.endofSourcecode;)t.endPosition=this.getEndOfCurrentToken(),this.nextToken();return t}parseCreateTable(){let t=this.getCurrentPosition();this.nextToken(),this.expect(e.keywordTable,!0)||this.module.addCompletionHint(t,this.getCurrentPositionPlus(3),!1,!1,["table"]);let n=!1;this.comesToken(e.keywordIf)&&(this.nextToken(),this.expect(e.keywordNot,!0),this.expect(e.keywordExists,!0),n=!0);let r="";if(this.expect(e.identifier,!1)){r=this.cct.value;let t=this.getCurrentPosition(),i=this.getCurrentPositionPlus(r.length+3);this.nextToken(),this.comesToken(e.leftBracket)||this.module.addCompletionHint(t,i,!1,!1,["("])}let o={type:e.keywordCreate,identifier:r,position:t,endPosition:null,columnList:[],symbolTable:null,combinedPrimaryKeyColumns:[],foreignKeyInfoList:[],ifNotExists:n,uniqueConstraints:[]};if(!this.expect(e.leftBracket,!0))return o;let s=!1,a=!0;for(;this.tt!=e.rightBracket;){switch(a||this.expect(e.comma,!0),a=!1,this.comesToken(e.keywordConstraint,!0)&&(this.expect(e.identifier,!0),this.expect([e.keywordForeign,e.keywordPrimary,e.keywordUnique],!1)),this.tt){case e.keywordPrimary:s&&this.pushError("Je Tabelle darf nur ein einziger Primärschlüssel definiert werden.","error",this.getCurrentPosition()),this.parsePrimaryKeyTerm(s,o),s=!0;break;case e.keywordUnique:this.parseUniqueTerm(o);break;case e.keywordForeign:let t=this.parseForeignKeyDefinition();null!=t&&o.foreignKeyInfoList.push(t);break;case e.identifier:let n=this.parseColumnDefinition(s);o.columnList.push(n),s=s||n.isPrimary;break;default:this.pushError(i[this.tt]+" wird hier nicht erwartet.","error")}if(!this.comesToken(e.comma))break}for(this.expect(e.rightBracket,!0);[e.keywordAutoincrement,e.keywordEngine,e.keywordDefault,e.keywordCollate].indexOf(this.tt)>=0;)switch(this.tt){case e.keywordCollate:case e.keywordEngine:this.nextToken(),this.skip(e.equal),this.expect(e.identifier,!0);break;case e.keywordDefault:this.nextToken(),this.expect([e.keywordCharset,e.keywordCharacter],!0),this.skip(e.keywordSet),this.skip(e.equal),this.expect(e.identifier,!0);break;case e.keywordAutoincrement:this.nextToken(),this.expect(e.equal,!0),this.expect(e.integerConstant,!0)}for(let e of o.columnList)e.isAutoIncrement&&!(e.isPrimary||o.combinedPrimaryKeyColumns.indexOf(e.identifier)>=0)&&this.pushError("autoincrement gibt es nur bei Primärschlüsseln, d.h. es fehlt wahrscheinlich 'primary key'.","warning",o.position);return o.endPosition=this.getCurrentPosition(),o}parsePrimaryKeyTerm(t,i){t&&this.pushError("Die Tabelle kann nur einen einzigen Primärschlüssel haben."),this.nextToken(),this.expect(e.keywordKey,!0);let n=i.columnList.map((e=>e.identifier));if(this.addCompletionHintHere(!1,!1,n),this.comesToken(e.leftBracket)){for(this.addCompletionHintHere(!1,!1,n),this.nextToken();;){if(!this.comesToken(e.identifier)){this.pushError("Der Bezeichner einer Spalte wird erwartet. Gefunden wurde: "+this.cct.value);break}if(i.combinedPrimaryKeyColumns.push(this.cct.value),this.nextToken(),this.addCompletionHintHere(!1,!1,n,1),!this.comesToken(e.comma))break;this.nextToken(),this.addCompletionHintHere(!1,!1,n)}this.expect(e.rightBracket,!0)}else this.pushError("( erwartet.")}parseUniqueTerm(t){this.nextToken();let i=t.columnList.map((e=>e.identifier)),n=[];if(t.uniqueConstraints.push(n),this.addCompletionHintHere(!1,!1,i),this.comesToken(e.leftBracket)){for(this.addCompletionHintHere(!1,!1,i),this.nextToken();;){if(!this.comesToken(e.identifier)){this.pushError("Der Bezeichner einer Spalte wird erwartet. Gefunden wurde: "+this.cct.value);break}if(n.push(this.cct.value),this.nextToken(),this.addCompletionHintHere(!1,!1,i,1),!this.comesToken(e.comma))break;this.nextToken(),this.addCompletionHintHere(!1,!1,i)}this.expect(e.rightBracket,!0)}else this.pushError("( erwartet.")}parseColumnDefinition(t){let i=this.getCurrentPosition(),n=this.cct.value;this.nextToken();let r={type:e.columnDef,identifier:n,isPrimary:!1,isAutoIncrement:!1,position:i,baseType:null,notNull:!1};return this.parseType(r,t),r}addCompletionHintHere(e,t,i,n=0,r="",o=""){let s=this.lastToken.position,a=this.getCurrentPosition();a.column+=1+n,this.module.addCompletionHint(this.getEndOfPosition(s),a,e,t,i,null,r,o)}parseType(t,n){let r=h.baseTypes.map((e=>e.toString()));if(this.addCompletionHintHere(!1,!1,r),!this.expect(e.identifier,!1))return void this.pushError("Erwartet wird ein Datentyp. Gefunden wurde: "+this.cct.value);let o=this.cct.value,s=this.getCurrentPosition(),a=this.identifierMap[o.toLocaleLowerCase()];null!=a&&(o=a);let l=h.getBaseType(o);if(null==l&&this.pushError("Erwartet wird ein Datentyp. Gefunden wurde: "+o),t.baseType=l,this.nextToken(),this.tt==e.leftBracket){for(this.nextToken(),t.parameters=[];this.tt==e.integerConstant&&(t.parameters.push(this.cct.value),this.nextToken(),this.tt==e.comma);)if(this.nextToken(),this.tt!=e.integerConstant){this.pushError("Erwartet wird eine ganze Zahl, gefunden wurde: "+this.cct.value);break}null!=l&&t.parameters.length>l.parameterDescriptions.length&&this.pushError("Der Datentyp "+l.toString()+" hat höchstens "+l.parameterDescriptions.length+" Parameter."),this.expect(e.rightBracket,!0)}if(null!=o&&null==t.parameters)switch(o.toLocaleLowerCase()){case"char":t.parameters=[1];break;case"varchar":t.parameters=[1],this.pushError("Hinter dem Datentyp varchar wird zwingend eine Längenangabe in Klammern erwaretet, also z.B. varchar(30)","error",s)}this.addCompletionHintHere(!1,!1,["primary key","references","not null"]);let d=[];for(;[e.keywordOn,e.keywordCharacter,e.keywordComment,e.keywordAutoincrement,e.keywordKey,e.keywordPrimary,e.keywordNot,e.keywordReferences,e.keywordCollate,e.keywordDefault].indexOf(this.tt)>=0;)switch(d.indexOf(this.tt)>=0&&this.pushError("Das Schlüsselwort "+i[this.tt]+" darf bei der Definition einer Spalte nicht öfters als ein Mal vorkommen."),d.push(this.tt),this.tt){case e.keywordAutoincrement:this.nextToken(),t.isAutoIncrement=!0,this.tt==e.equal?(this.nextToken(),this.expect(e.integerConstant)):this.tt==e.comma&&this.ct[1].tt==e.keywordAutoincrement&&this.nextToken();break;case e.keywordPrimary:n&&this.pushError("In einer Tabelle darf es nur einen einzigen primary key geben."),this.nextToken(),this.expect(e.keywordKey,!0)?this.addCompletionHintHere(!1,!1,["autoincrement, \n"]):this.addCompletionHintHere(!1,!1,["key"]),t.isPrimary=!0;break;case e.keywordReferences:let i={column:t.identifier,referencesColumn:"",referencesTable:"",referencesPosition:this.getCurrentPosition()};t.foreignKeyInfo=i,this.parseReferences(i);break;case e.keywordNot:this.nextToken(),this.expect(e.keywordNull,!0)?this.addCompletionHintHere(!1,!1,["references"]):this.addCompletionHintHere(!1,!1,["null"]),t.notNull=!0;break;case e.keywordCollate:this.nextToken(),t.collate=this.cct.value,this.expect(e.identifier,!0);break;case e.keywordCharacter:this.nextToken(),this.expect(e.keywordSet,!0),this.expect(e.identifier,!0);break;case e.keywordDefault:if(this.nextToken(),this.ct[1].tt==e.leftBracket&&this.ct[2].tt==e.rightBracket){this.nextToken(),this.nextToken(),this.nextToken();break}if(t.defaultValue=this.cct.value,"string"==typeof this.cct.value&&"null"!=t.defaultValue.toLowerCase()&&(t.defaultValue="'"+t.defaultValue+"'"),this.tt==e.keywordNull){this.nextToken();break}[e.identifier,e.integerConstant,e.floatingPointConstant,e.stringConstant].indexOf(this.tt)>=0&&(h.fromConstantType(this.tt).canCastTo(l)||this.pushError("Die Konstante hinter 'default' passt nicht zum Datentyp der Spalte."),this.nextToken());break;case e.keywordComment:this.nextToken(),this.expect(e.stringConstant,!0);break;case e.keywordOn:for(this.nextToken(),this.expect([e.keywordUpdate],!0);!this.comesToken([e.comma,e.endofSourcecode,e.rightBracket]);)this.nextToken();this.lastToken.tt==e.leftBracket&&this.tt==e.rightBracket&&this.nextToken()}}parseInsert(){let t=this.getCurrentPosition(),i=t;this.nextToken(),this.expect(e.keywordInto,!0);let n={type:e.keywordInsert,position:t,endPosition:this.getCurrentPosition(),valuesPosition:null,columnsPosition:null,symbolTable:null,columnList:[],values:[],table:null};if(this.tt==e.identifier?(n.table={type:e.table,identifier:this.cct.value,alias:null,position:this.getCurrentPosition()},n.columnsPosition={line:n.table.position.line,column:n.table.position.column+n.table.position.length,length:0},this.nextToken()):this.pushError("Hier wird der Bezeichner einer Tabelle erwartet. Gefunden wurde: "+this.cct.value,"error"),this.tt==e.leftBracket){this.nextToken();let t=!0;for(;t||this.tt==e.comma;)t||this.nextToken(),t=!1,this.tt==e.identifier?n.columnList.push({type:e.identifier,identifier:this.cct.value+"",position:this.getCurrentPosition()}):this.pushError("Erwartet wird der Bezeichner einer Spalte. Gefunden wurde: "+this.cct.value,"error"),this.nextToken();i=this.getCurrentPosition(),this.expect(e.rightBracket,!0)}switch(n.valuesPosition=this.getCurrentPosition(),this.tt){case e.keywordValues:this.nextToken(),this.parseValueLists(n.values);break;case e.keywordSelect:case e.leftBracket:if(this.getCurrentPosition().line<=i.line+1){let e=this.parseSelect();n.select=e}}return n.endPosition=this.getCurrentPosition(),n}parseValueLists(t){let i=[e.keywordNull,e.charConstant,e.stringConstant,e.booleanConstant,e.floatingPointConstant,e.integerConstant],n=!0;for(;n||this.tt==e.comma;){n||this.nextToken(),n=!1;let r=this.getCurrentPosition();if(!this.expect(e.leftBracket,!0))break;let o=[],s=!0;for(;s||this.tt==e.comma;){if(s||this.nextToken(),s=!1,this.tt==e.identifier)if(this.cct.isDoubleQuotedIdentifier)this.tt=e.stringConstant;else{let e=(this.cct.value+"").toLocaleLowerCase();["date","_binary"].indexOf(e)>=0&&this.nextToken()}i.indexOf(this.tt)<0?(this.pushError("Erwartet wird eine Konstante oder null. Gefunden wurde: "+this.cct.value,"error"),this.nextToken()):(o.push({constantType:this.tt,position:this.getCurrentPosition(),constant:this.cct.value,type:e.constantNode}),this.nextToken())}this.expect(e.rightBracket,!0),0==o.length?this.pushError("Eine Zeile kann nur dann in die Tabelle eingefügt werden, wenn sie mindestens einen Spaltenwert besitzt.","error",r):t.push(o)}}parseConstant(){let t={constantType:this.tt,position:this.getCurrentPosition(),constant:this.cct.value,type:e.constantNode};return this.nextToken(),t}parseSelect(){let t=this.getCurrentPosition();this.nextToken();let i={line:t.line,column:t.column+6,length:1},n={type:e.keywordSelect,position:t,endPosition:this.getCurrentPosition(),symbolTable:null,columnList:[],fromNode:null,whereNode:null,parentStatement:null};n.columnList=this.parseColumnList([e.keywordFrom,e.semicolon,e.endofSourcecode],!0);let r=["distinct","as","*","from"];n.columnList.findIndex((t=>t.type==e.allColumns))>=0&&(r=["from"]),this.module.addCompletionHint(i,this.getCurrentPositionPlus(2),!0,!0,r);let o=["where","join","left","right","inner","outer","natural","on","as",", "];if(this.comesToken(e.keywordFrom,!0)){n.fromStartPosition={line:this.lastToken.position.line,column:this.lastToken.position.column+this.lastToken.position.length,length:0};let t=[];n.fromNode=this.parseTableOrSubQuery(t),o.splice(o.indexOf(this.lastToken.value+""),1);let i=this.getCurrentPositionPlus(2);this.comesToken(e.semicolon)&&(i=this.getCurrentPosition()),this.module.addCompletionHint(n.fromStartPosition,i,!1,!0,o,t),n.fromEndPosition=this.getCurrentPosition()}else r.unshift("from");let s=["like"];if(this.tt==e.keywordWhere){this.getCurrentPosition();let e=this.getCurrentPosition();this.nextToken(),n.whereNode=this.parseTerm(),this.module.addCompletionHint(e,this.getCurrentPositionPlus(4),!0,!0,s)}else o.push("where");let a=[];if(this.tt==e.keywordGroup){let e=this.getCurrentPosition();n.groupByNode=this.parseGroupBy(),this.module.addCompletionHint(e,this.getCurrentPosition(),!0,!0,a)}else s.push("group by");if(this.tt==e.keywordOrder){let e=this.getCurrentPosition();n.orderByNode=this.parseOrderBy(),this.module.addCompletionHint(e,this.getCurrentPosition(),!0,!0,["asc","desc"])}else s.push("order by"),a.push("order by");return this.tt==e.keywordLimit&&(n.limitNode=this.parseLimit()),n.endPosition=this.getCurrentPosition(),n.endPosition.column+=3,n}parseLimit(){let t=this.getCurrentPosition();this.nextToken();let i=this.parseTerm(),n={type:e.keywordLimit,position:t,numberOfRows:i};return this.tt==e.keywordOffset&&(this.nextToken(),n.offset=this.parseTerm()),n}parseGroupBy(){let t=this.getCurrentPosition();this.expect(e.keywordGroup,!0),this.expect(e.keywordBy,!0);let i={type:e.keywordGroup,columnList:[],position:t},n=[e.keywordHaving,e.keywordSelect,e.keywordOrder,e.keywordLimit,e.rightBracket,e.semicolon];return i.columnList=this.parseColumnList(n,!1).map((e=>e.term)),this.tt==e.keywordHaving&&(this.nextToken(),i.having=this.parseTerm()),i}parseOrderBy(){this.expect(e.keywordOrder,!0),this.expect(e.keywordBy,!0);let t=[],i=!0;do{i?i=!1:this.expect(e.comma,!0);let n=this.parseTerm(),r={type:e.keywordOrder,position:this.getCurrentPosition(),column:n};[e.keywordAscending,e.keywordDescending].indexOf(this.tt)>=0&&this.nextToken(),this.tt==e.keywordNulls&&(this.nextToken(),this.expect([e.keywordFirst,e.keywordLast],!0)),t.push(r)}while(this.tt==e.comma);return t}parseTableOrSubQuery(t){let i=this.parseAtomicTableOrSubQuery(t),n=this.getCurrentPosition();for(;this.parseJoinOperator();){let r=this.parseAtomicTableOrSubQuery(t);i={type:e.keywordJoin,firstOperand:i,secondOperand:r,position:n},this.tt==e.keywordOn&&(i.on=this.parseTerm())}return i}parseJoinOperator(){if(this.tt==e.comma)return this.nextToken(),!0;switch(this.tt==e.keywordNatural&&this.nextToken(),this.tt){case e.keywordLeft:return this.nextToken(),this.tt==e.keywordOuter&&this.nextToken(),this.expect(e.keywordJoin,!0);case e.keywordInner:case e.keywordCross:return this.nextToken(),this.expect(e.keywordJoin,!0);case e.keywordJoin:return this.nextToken(),!0;default:return!1}}parseAtomicTableOrSubQuery(t){if(!this.expect([e.identifier,e.leftBracket],!1))return null;if(this.tt==e.leftBracket){let i;if(this.nextToken(),this.tt==e.keywordSelect){let t=this.getCurrentPosition(),n=this.parseSelect();i={type:e.subquery,alias:null,position:t,query:n}}else i=this.parseTableOrSubQuery(t);return this.expect(e.rightBracket,!0),this.tt==e.keywordAs&&i.type==e.subquery&&(this.nextToken(),this.expect(e.identifier,!1)&&(i.alias=this.cct.value,this.nextToken(),t.push(i.alias))),i}if(this.tt==e.identifier){let i={type:e.table,identifier:this.cct.value,alias:null,position:this.getCurrentPosition()};return t.push(i.identifier),this.nextToken(),this.tt==e.keywordAs&&(this.nextToken(),this.expect(e.identifier,!1)&&(i.alias=this.cct.value,this.nextToken(),t.push(i.alias))),i}}parseColumnList(t,i){let n=[];for(;[e.stringConstant,e.integerConstant,e.floatingPointConstant,e.booleanConstant,e.identifier,e.multiplication,e.leftBracket,e.keywordDistinct].indexOf(this.tt)>=0;){if(this.tt==e.multiplication)n.push({term:null,alias:null,distinct:!1,position:this.getCurrentPosition(),type:e.allColumns}),this.nextToken();else{let t=this.comesToken(e.keywordDistinct,!0),i=this.parseTerm();if(null!=i){let r={type:e.column,term:i,distinct:t,position:i.position};n.push(r),this.comesToken(e.keywordAs)&&(this.nextToken(),this.expect(e.identifier,!1)&&(r.alias=""+this.cct.value),this.nextToken())}}if(t.indexOf(this.tt)>=0||this.isEnd())break;this.expect(e.comma,!0)}return 0==n.length&&this.pushError("Es fehlt die kommaseparierte Liste der gewünschten Spalten.","error"),n}parseTerm(){return this.parseTermBinary(0)}parseTermBinary(t){let i;i=t<V.operatorPrecedence.length-1?this.parseTermBinary(t+1):this.parseUnary();let n=V.operatorPrecedence[t];if(null==i||n.indexOf(this.tt)<0)return i;let r=!0;for(;r||n.indexOf(this.tt)>=0;){let n=this.tt;r=!1;let o,s=this.getCurrentPosition();this.nextToken(),o=t<V.operatorPrecedence.length-1?this.parseTermBinary(t+1):this.parseUnary(),i={type:e.binaryOp,position:s,operator:n,firstOperand:i,secondOperand:o}}return i}parseUnary(){let t,i=this.getCurrentPosition();switch(this.tt){case e.leftBracket:return this.parseBracket();case e.keywordNot:return this.nextToken(),t=this.parseTermBinary(2),{type:e.unaryOp,position:i,operand:t,operator:e.keywordNot};case e.minus:let n=this.tt;return this.nextToken(),t=this.parseUnary(),{type:e.unaryOp,position:i,operand:t,operator:n};case e.integerConstant:case e.charConstant:case e.floatingPointConstant:case e.stringConstant:case e.booleanConstant:t={type:e.constantNode,position:this.getCurrentPosition(),constantType:this.tt,constant:this.cct.value};let r=this.tt==e.stringConstant;return this.nextToken(),r?this.parseDotOrArrayChains(t):t;case e.identifier:let o=this.cct.value,s=this.getCurrentPosition();if(this.nextToken(),this.tt==e.leftBracket){let i=this.parseMethodCallParameters(),n=i.rightBracketPosition;t={type:e.callMethod,position:s,rightBracketPosition:n,operands:i.nodes,identifier:o,commaPositions:i.commaPositions}}else if(t={type:e.identifier,identifier:o,position:i},this.tt==e.dot){let i=this.getCurrentPosition();this.nextToken(),this.expect(e.identifier,!1);let n={type:e.identifier,identifier:this.cct.value,position:this.getCurrentPosition()};this.nextToken(),t={type:e.dot,identifierLeft:t,identifierRight:n,position:i}}else[e.isNull,e.isNotNull].indexOf(this.tt)>=0&&(t={type:e.unaryOp,operand:t,operator:this.tt,position:i},this.nextToken());return t;default:return this.pushError("Erwartet wird eine Variable, ein Methodenaufruf oder eine Konstante. Gefunden wurde: "+this.cct.value),null}}parseList(){let t={type:e.list,position:this.getCurrentPosition(),elements:[]},i=[e.charConstant,e.stringConstant,e.booleanConstant,e.floatingPointConstant,e.integerConstant];for(;i.indexOf(this.tt)>=0&&(t.elements.push({type:e.constantNode,constant:this.cct.value,constantType:this.tt,position:this.cct.position}),this.nextToken(),this.tt==e.comma);)this.nextToken();return t}parseBracket(){this.getCurrentPosition();let t=this.lastToken;if(this.nextToken(),this.tt==e.keywordSelect){let t=this.parseSelect();return this.expect(e.rightBracket,!0),t}if([e.comma,e.rightBracket].indexOf(this.ct[1].tt)>=0&&[e.keywordIn,e.keywordNotIn].indexOf(t.tt)>=0){let t=this.parseList();return this.expect(e.rightBracket,!0),t}{let t=this.parseTerm(),i=this.getCurrentPosition();return this.expect(e.rightBracket,!0),{position:i,type:e.rightBracket,termInsideBrackets:t}}}parseMethodCallParameters(){if(this.nextToken(),this.tt==e.rightBracket){let e=this.getCurrentPosition();return this.nextToken(),{rightBracketPosition:e,nodes:[],commaPositions:[]}}let t=[],i=[];for(;;){let n=this.pos;if(this.tt==e.multiplication)this.nextToken(),t.push({type:e.allColumns,position:this.getCurrentPosition()});else{let e=this.parseTerm();null!=e&&t.push(e)}if(this.tt!=e.comma)break;i.push(this.getCurrentPosition()),this.nextToken(),this.pos==n&&this.nextToken()}let n=this.getCurrentPosition();return{rightBracketPosition:this.expect(e.rightBracket,!0)?n:null,nodes:t,commaPositions:i}}parseDotOrArrayChains(t){if(null==t)return null;for(;this.comesToken([e.dot,e.leftSquareBracket]);)if(this.tt==e.dot){if(this.nextToken(),this.tt!=e.identifier)return this.pushError("Erwartet wird der Bezeichner eines Attributs oder einer Methode, gefunden wurde: "+this.cct.value),t;let i=this.cct.value,n=this.getCurrentPosition();if(this.nextToken(),this.tt==e.leftBracket){let r=this.parseMethodCallParameters();t={type:e.callMethod,position:n,rightBracketPosition:r.rightBracketPosition,operands:r.nodes,identifier:i,commaPositions:r.commaPositions}}}return t}}V.operatorPrecedence=[[e.keywordOr],[e.keywordAnd],[e.lower,e.lowerOrEqual,e.greater,e.greaterOrEqual,e.equal,e.notEqual,e.keywordLike],[e.concatenation,e.plus,e.minus],[e.multiplication,e.division,e.modulo],[e.keywordIn,e.keywordNotIn]];class G{constructor(e,t,i,n,r,o,s){this.identifier=e,this.type=t,this.table=i,this.isPrimaryKey=n,this.isNullable=r,this.defaultValue=o,this.isAutoIncrement=s}static fromColumnStructure(e,t){let i=e.completeTypeSQL.match(/^(\w*) *(?:\((.*)\))?.*$/),n=i[1],r=i[2],o=[];null!=r&&(o=r.split(",").map((e=>parseInt(e.trim()))));let s=h.getBaseType(n);o.length>0&&null!=s&&(s=new m(s,o));let a=new G(e.name,s,t,e.isPrimaryKey,!e.isPrimaryKey,e.defaultValue,e.isAutoIncrement);return a.notNull=e.notNull,a.fromColumnStructure=e,a}}class J{constructor(e){this.identifier=e,this.columns=[]}static fromTableStructure(e){let t=new J(e.name);return t.columns=e.columns.map((e=>G.fromColumnStructure(e,t))),t.size=e.size,t}static fromTableStructureList(e){null==e&&(e=[]);let t=e.map((e=>J.fromTableStructure(e))),i=new Map;for(let e of t)for(let t of e.columns)i.set(t.fromColumnStructure,t);for(let e of t)for(let t of e.columns){let e=t.fromColumnStructure.references;if(null!=e){let n=i.get(e);t.references=n}}return t}}class Y{constructor(e,t,i){this.childSymbolTables=[],this.symbols=new Map,this.symbolList=[],this.parent=e,this.positionFrom=t,this.positionTo=i,null!=this.parent&&this.parent.childSymbolTables.push(this)}extractDatabaseStructure(e){for(let t of J.fromTableStructureList(null==e?void 0:e.tables))this.storeTableSymbols(t)}storeTableSymbols(e){this.storeSymbol({identifier:e.identifier,posOfDefinition:null,referencedOnPositions:[],table:e});for(let t of e.columns)this.storeSymbol({identifier:t.identifier,posOfDefinition:null,referencedOnPositions:[],column:t})}storeSymbol(e){let t=this.symbols.get(e.identifier.toLowerCase());null==t?(t=[e],this.symbols.set(e.identifier.toLowerCase(),t)):t.push(e),this.symbolList.push(e)}findTableAtPosition(e,t){if(!this.containsPosition(e,t))return null;let i=null,n=1e7;for(let r of this.childSymbolTables)if(r.containsPosition(e,t)){let o=r.findTableAtPosition(e,t);o.positionTo.line-o.positionFrom.line<n&&(i=o,n=o.positionTo.line-o.positionFrom.line)}return null!=i?i:this}containsPosition(e,t){return!(e<this.positionFrom.line||e>this.positionTo.line||e==this.positionFrom.line&&t<this.positionFrom.column||e==this.positionTo.line&&t>this.positionTo.column+1)}findTable(e){let t=this.findTables(e);return 0==t.length?null:t[0].table}findTables(e){let t=this;for(;null!=t;){let i=t.symbols.get(e.toLowerCase());if(null!=i&&(i=i.filter((e=>null!=e.table)),i.length>0))return i;t=t.parent}return[]}findColumn(e){let t=this;for(;null!=t;){let i=t.symbols.get(e.toLowerCase());if(null!=i&&(i=i.filter((e=>null!=e.column)),i.length>0))return i;t=t.parent}return[]}}class Z{constructor(e,t){this.identifier=e,this.type=h.getBaseType(t)}}class X{constructor(e,t,i,n){this.identifier=e,this.isAggregating=t,this.parameters=n,this.acceptsStarParameter=!1,this.returnType=h.getBaseType(i)}}class ee{static getInstance(){return null==this.instance&&(this.instance=new ee),this.instance}constructor(){this.methods=[],this.pushOneParameterMethod("max","integer","integer"),this.pushOneParameterMethod("max","float","float"),this.pushOneParameterMethod("max","date","date"),this.pushOneParameterMethod("max","time","time"),this.pushOneParameterMethod("max","datetime","datetime"),this.pushOneParameterMethod("max","timestamp","timestamp"),this.pushOneParameterMethod("min","integer","integer"),this.pushOneParameterMethod("min","float","float"),this.pushOneParameterMethod("min","date","date"),this.pushOneParameterMethod("min","time","time"),this.pushOneParameterMethod("min","datetime","datetime"),this.pushOneParameterMethod("min","timestamp","timestamp"),this.pushOneParameterMethod("avg","integer","integer"),this.pushOneParameterMethod("avg","float","float"),this.pushOneParameterMethod("sum","float","float"),this.pushOneParameterMethod("sum","integer","integer");let e=new X("count",!0,"integer",[new Z("spalte","text")]);e.acceptsStarParameter=!0,this.methods.push(e)}getMethods(e){return this.methods.filter((t=>t.identifier==e.toLowerCase()))}pushOneParameterMethod(e,t,i){this.methods.push(new X(e,!0,t,[new Z("spalte",i)]))}}function te(e){return e.replace(/['"]+/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function ie(e){return e<10?"0"+e:""+e}function ne(e){if(null==e||"string"!=typeof e)return!1;if(e.match(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/)){var t=e.split("/"),i=e.split("-"),n=t.length,r=i.length;if(n>1)var o=e.split("/");else r>1&&(o=e.split("-"));if(3!=o.length)return!1;var s=parseInt(o[2]),a=parseInt(o[1]),l=parseInt(o[0]);if((1==a||a>2)&&s>[31,28,31,30,31,30,31,31,30,31,30,31][a-1])return!1;if(2==a){var d=!1;return(l%4||!(l%100))&&l%400||(d=!0),!(0==d&&s>=29||1==d&&s>29)}return!0}return!1}function re(e){if(null==e||"string"!=typeof e)return!1;if(e.match(/^\d{4}[\-](0[1-9]|1[012])[\-](0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0123]):([0-5][0-9]):([0-5][0-9])$/)){var t=e.split(" ")[0];if(10!=t.length)return!1;var i=parseInt(t.substring(8,10)),n=parseInt(t.substring(5,7)),r=parseInt(t.substring(0,4));if((1==n||n>2)&&i>[31,28,31,30,31,30,31,31,30,31,30,31][n-1])return!1;if(2==n){var o=!1;return(r%4||!(r%100))&&r%400||(o=!0),!(0==o&&i>=29||1==o&&i>29)}return!0}return!1}class oe{constructor(e){var t;this.symbolTableStack=[],this.databaseTool=e,this.tables=J.fromTableStructureList(null===(t=e.databaseStructure)||void 0===t?void 0:t.tables)}start(t){this.module=t,this.symbolTableStack=[],this.errorList=[],t.mainSymbolTable=new Y(null,{column:0,line:0,length:0},{column:0,line:1e5,length:0}),this.symbolTableStack.push(t.mainSymbolTable);for(let t of this.module.sqlStatements){let i=this.errorList.length,n=t.ast;if(null!=n){switch(n.type){case e.keywordSelect:this.resolveSelect(n),this.symbolTableStack.pop();break;case e.keywordInsert:this.resolveInsert(n),this.symbolTableStack.pop();break;case e.keywordCreate:this.resolveCreateTable(n),this.symbolTableStack.pop();break;case e.keywordUpdate:this.resolveUpdate(n),this.symbolTableStack.pop();break;case e.keywordDelete:this.resolveDelete(n),this.symbolTableStack.pop();break;case e.keywordDrop:this.resolveDropTable(n),this.symbolTableStack.pop();break;case e.keywordAlter:this.resolveAlterTable(n),this.symbolTableStack.pop()}t.hasErrors=t.hasErrors||this.errorList.length>i}}t.errors[2]=this.errorList}pushError(e,t="error",i,n){this.errorList.push({text:e,position:i,quickFix:n,level:t})}getCurrentSymbolTable(){return this.symbolTableStack[this.symbolTableStack.length-1]}pushNewSymbolTable(e,t){null==t&&(t={line:1e5,column:1,length:1});let i=new Y(this.getCurrentSymbolTable(),e,t);return this.symbolTableStack.push(i),i}resolveSelect(t){let i=new J(null);t.symbolTable=this.pushNewSymbolTable(t.position,t.endPosition);let n=[];this.resolveTableOrSubQuery(t.fromNode,n),null!=t.fromStartPosition&&new Y(this.getCurrentSymbolTable(),t.fromStartPosition,t.fromEndPosition).extractDatabaseStructure(this.databaseTool.databaseStructure);for(let r of t.columnList)if(r.type==e.allColumns)for(let e of n)for(let t of e.columns){let e=new G(t.identifier,t.type,i,!1,!0,t.defaultValue,t.isAutoIncrement);i.columns.push(e)}else{this.resolveTerm(r.term);let e=new G(r.alias,r.term.sqlType,i,!1,!0,null,!1);i.columns.push(e),null!=e.identifier&&t.symbolTable.storeSymbol({identifier:e.identifier,posOfDefinition:r.term.position,referencedOnPositions:[],column:e})}if(null!=t.whereNode){let e=this.resolveTerm(t.whereNode);null!=e&&"boolean"!=e.getBaseTypeName()&&this.pushError("Das Ergebnis des where-Teils einer select-Anweisung muss vom Typ boolean sein.","error",t.whereNode.position)}return i}resolveDropTable(e){e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure),null==e.tableIdentifier||e.ifExists||null==e.symbolTable.findTable(e.tableIdentifier)&&this.pushError("Die Tabelle "+e.tableIdentifier+" ist nicht bekannt.","error",e.tableIdentifierPosition)}resolveDelete(e){if(e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure),null==e.tableIdentifier)return;let t=e.symbolTable.findTable(e.tableIdentifier);if(null==t&&this.pushError("Die Tabelle "+e.tableIdentifier+" ist nicht bekannt.","error",e.tableIdentifierPosition),null!=e.whereNode){let i=this.pushNewSymbolTable(e.whereNodeBegin,e.whereNodeEnd);null!=t&&i.storeTableSymbols(t),this.resolveTerm(e.whereNode),this.symbolTableStack.pop()}}resolveAlterTable(e){if(e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure),null==e.tableIdentifier)return;let t=e.symbolTable.findTable(e.tableIdentifier);null==t&&this.pushError("Die Tabelle "+e.tableIdentifier+" ist nicht bekannt.","error",e.tableIdentifierPosition);let i=null;switch(null!=e.oldColumnName&&(i=t.columns.find((t=>t.identifier.toLocaleLowerCase()==e.oldColumnName.toLocaleLowerCase())),null==i&&this.pushError("Die Tabelle "+e.tableIdentifier+" hat keine Spalte mit dem Bezeichner "+e.oldColumnName,"error",e.oldColumnPosition)),e.kind){case"dropColumn":case"renameColumn":case"renameTable":default:break;case"addColumn":let t=e.columnDef;if(null==t)break;if(null!=t.foreignKeyInfo&&null!=t.baseType){let e=t.foreignKeyInfo,i=this.getCurrentSymbolTable().findTables(e.referencesTable);if(1==i.length){let n=i[0].table,r=n.columns.find((t=>t.identifier==e.referencesColumn));null!=r&&null!=r.type&&(r.isPrimaryKey||this.pushError("Die referenzierte Spalte "+e.referencesTable+"."+e.referencesColumn+" ist kein Primärschlüssel.","warning",t.referencesPosition),r.type.canCastTo(t.baseType)||this.pushError("Der Datentyp "+t.baseType.toString()+" der Spalte "+t.identifier+" kann nich in den Datentyp "+r.type.toString()+" der referenzierten Spalte "+n.identifier+"."+r.identifier+" umgewandelt werden.","error",t.referencesPosition))}}}}resolveUpdate(e){if(e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure),null==e.tableIdentifier)return;let t=e.symbolTable.findTable(e.tableIdentifier);null==t&&this.pushError("Die Tabelle "+e.tableIdentifier+" ist nicht bekannt.","error",e.tableIdentifierPosition);for(let i=0;i<e.columnIdentifiers.length;i++){let n=e.columnIdentifiers[i],r=e.columnIdentifierPositions[i],o=e.values[i];null!=n&&(null==t.columns.find((e=>e.identifier==n))&&this.pushError(n+" ist kein Bezeichner einer Spalte der Tabelle "+e.tableIdentifier+".","error",r),null!=o&&(this.pushNewSymbolTable(e.valuePosBegin[i],e.valuePosEnd[i]).storeTableSymbols(t),this.resolveTerm(o),this.symbolTableStack.pop()))}null!=e.whereNodeBegin&&this.pushNewSymbolTable(e.whereNodeBegin,e.whereNodeEnd).storeTableSymbols(t),null!=e.whereNode&&this.resolveTerm(e.whereNode),this.symbolTableStack.pop()}resolveCreateTable(e){e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure);let t={identifier:e.identifier,columns:null,size:0};t.columns=e.columnList.map((e=>({identifier:e.identifier,isNullable:!1,isPrimaryKey:e.isPrimary,isAutoIncrement:e.isAutoIncrement,notNull:!1,references:null,table:t,type:e.baseType,defaultValue:e.defaultValue}))),e.symbolTable.storeTableSymbols(t);for(let t of e.columnList)if(e.columnList.filter((e=>e.identifier.toLocaleLowerCase()==t.identifier.toLocaleLowerCase())).length>1&&this.pushError("Der Spaltenbezeichner "+t.identifier+" darf in einer Tabelle nur ein einziges Mal verwendet werden","error",t.position),null!=t.foreignKeyInfo&&null!=t.baseType){let e=t.foreignKeyInfo,i=this.getCurrentSymbolTable().findTables(e.referencesTable);if(1==i.length){let n=i[0].table,r=n.columns.find((t=>t.identifier==e.referencesColumn));null!=r&&null!=r.type&&(r.isPrimaryKey||this.pushError("Die referenzierte Spalte "+e.referencesTable+"."+e.referencesColumn+" ist kein Primärschlüssel.","warning",t.referencesPosition),r.type.canCastTo(t.baseType)||this.pushError("Der Datentyp "+t.baseType.toString()+" der Spalte "+t.identifier+" kann nich in den Datentyp "+r.type.toString()+" der referenzierten Spalte "+n.identifier+"."+r.identifier+" umgewandelt werden.","error",t.referencesPosition))}}for(let t of e.foreignKeyInfoList){let i=e.columnList.find((e=>e.identifier==t.column));if(null==i)continue;let n=this.getCurrentSymbolTable().findTables(t.referencesTable);if(1==n.length){let e=n[0].table,r=e.columns.find((e=>e.identifier==t.referencesColumn));null!=r&&null!=r.type&&(r.isPrimaryKey||this.pushError("Die referenzierte Spalte "+t.referencesTable+"."+t.referencesColumn+" ist kein Primärschlüssel.","warning",t.referencesPosition),r.type.canCastTo(i.baseType)||this.pushError("Der Datentyp "+i.baseType.toString()+" der Spalte "+i.identifier+" kann nich in den Datentyp "+r.type.toString()+" der referenzierten Spalte "+e.identifier+"."+r.identifier+" umgewandelt werden.","error",t.referencesPosition))}}}resolveTableOrSubQuery(t,i){if(null!=t)switch(t.type){case e.table:let n=this.tables.filter((e=>e.identifier.toLowerCase()==t.identifier.toLowerCase()));if(0==n.length)this.pushError(t.identifier+" ist nicht der Name einer Tabelle.","error",t.position);else if(n.length>1)this.pushError("Der Bezeichner "+t.identifier+" ist hier nicht eindeutig.","error",t.position);else{let e=n[0];i.push(e),this.storeTableIntoSymbolTable(e,t.position,t.alias)}break;case e.keywordJoin:this.resolveTableOrSubQuery(t.firstOperand,i),this.resolveTableOrSubQuery(t.secondOperand,i);break;case e.subquery:t.table=this.resolveSelect(t.query),i.push(t.table),null!=t.alias&&(t.table.identifier=t.alias,this.storeTableIntoSymbolTable(t.table,t.position))}}storeTableIntoSymbolTable(e,t,i){let n=this.getCurrentSymbolTable();n.storeSymbol({identifier:null==i?e.identifier.toLowerCase():i.toLowerCase(),posOfDefinition:t,table:e,referencedOnPositions:[]});for(let t of e.columns)n.storeSymbol({identifier:t.identifier.toLowerCase(),posOfDefinition:null,column:t,tableAlias:i,referencedOnPositions:[]})}resolveTerm(t){if(null==t)return null;switch(t.type){case e.binaryOp:if([e.keywordIn,e.keywordNotIn].indexOf(t.operator)>=0)return this.resolveNotIn(t);let n=this.resolveTerm(t.firstOperand),r=this.resolveTerm(t.secondOperand);if(null!=n&&null!=r){let e=n.getBinaryResultType(t.operator,r);return null==e&&this.pushError("Der Operator "+i[t.operator]+" ist für die Datentypen "+n.toString()+" und "+r.toString()+" nicht definiert.","error",t.position),t.sqlType=e,e}return null;case e.unaryOp:let o=this.resolveTerm(t.operand);if(null!=o){let e=o.getUnaryResultType(t.operator);return null==e&&this.pushError("Der Operator "+i[t.operator]+" ist für einen Operanden des Datentyps "+o.toString()+" nicht definiert.","error",t.position),t.sqlType=e,e}return null;case e.callMethod:return this.resolveMethodCall(t);case e.constantNode:return t.sqlType=h.fromConstantType(t.constantType),t.sqlType;case e.identifier:return this.resolveIdentifier(t);case e.dot:return this.resolveDot(t);case e.keywordSelect:let s=this.resolveSelect(t);return 1!=s.columns.length?(this.pushError("Die Ergebnistabelle einer Unterabfrage an dieser Stelle muss genau eine Spalte besitzen.","error",t.position),null):s.columns[0].type;case e.rightBracket:return t.sqlType=this.resolveTerm(t.termInsideBrackets),t.sqlType;case e.allColumns:this.pushError("Das Zeichen * kann hier nicht verwendet werden.","error",t.position);break;case e.list:this.pushError("Eine Liste wird hier nicht erwartet.","error",t.position)}}resolveDot(e){let t=this.getCurrentSymbolTable().findTables(e.identifierLeft.identifier);if(0==t.length)return this.pushError("Die Tabelle "+e.identifierLeft.identifier+" kann nicht gefunden werden.","error",e.identifierLeft.position),null;if(t.length>1)return this.pushError("Der Tabellenbezeichner "+e.identifierLeft.identifier+" ist nicht eindeutig.","error",e.identifierLeft.position),null;let i=t[0].table.columns.filter((t=>t.identifier.toLowerCase()==e.identifierRight.identifier.toLowerCase()));if(0==i.length)return void this.pushError("Die Tabelle "+e.identifierLeft.identifier+" hat keine Spalte mit dem Bezeichner "+e.identifierRight.identifier+".","error",e.identifierRight.position);if(i.length>1)return void this.pushError("Die Tabelle "+e.identifierLeft.identifier+" hat mehrere Spalten mit dem Bezeichner "+e.identifierRight.identifier+".","error",e.identifierRight.position);let n=i[0];return e.sqlType=n.type,n.type}resolveIdentifier(e){let t=this.getCurrentSymbolTable().findColumn(e.identifier);if(0==t.length)return this.pushError("Der Bezeichner "+e.identifier+" ist an dieser Stelle nicht bekannt.","error",e.position),null;if(t.length>1)return this.pushError("Der Bezeichner "+e.identifier+" ist nicht eindeutig.","error",e.position),null;let i=t[0];return e.sqlType=i.column.type,i.column.type}resolveMethodCall(t){let i=ee.getInstance().getMethods(t.identifier);if(i=i.filter((e=>e.parameters.length==t.operands.length)),1==t.operands.length&&t.operands[0].type==e.allColumns)return i=i.filter((e=>e.acceptsStarParameter)),t.sqlType=i[0].returnType,t.sqlType;if(0==i.length)return this.pushError("Es gibt keine passende Methode mit dem Bezeichner '"+t.identifier+"'.","error",t.position),null;for(let e of t.operands)if(null==this.resolveTerm(e))return t.sqlType=i[0].returnType,t.sqlType;for(let e of i){let i=!0;for(let n=0;n<e.parameters.length;n++){let r=e.parameters[n];if(!t.operands[n].sqlType.canCastTo(r.type)){i=!1;break}}if(i)return t.sqlType=e.returnType,t.sqlType}return this.pushError("Es gibt keine passende Methode mit dem Bezeichner '"+t.identifier+"'.","error",t.position),null}resolveNotIn(t){if(null==t.firstOperand||null==t.secondOperand)return null;let n=i[t.operator];this.resolveTerm(t.firstOperand);let r=t.firstOperand.sqlType;if(null!=r)if(t.secondOperand.type==e.keywordSelect){let e=t.secondOperand;1!=e.columnList.length&&this.pushError("Wenn rechts vom Operator '"+n+"' eine Unterabfrage steht, muss die Ergebnistabelle dieser Unterabfrage genau eine Spalte haben.","error",e.position),this.resolveSelect(e);let i=e.columnList[0].term.sqlType;i.canCastTo(r)||this.pushError("Der Datentyp der Ergebnisspalte der Unterabfrage ist "+i.toString()+". Dieser kann nicht in den Datentyp "+r.toString()+" umgewandelt werden.","error",e.position)}else if(t.secondOperand.type==e.list){let e=t.secondOperand;for(let t of e.elements){let e=h.fromConstantType(t.constantType);t.sqlType=e,e.canCastTo(r)||this.pushError("Der Datentyp des Listenelements "+t.constant+" ist "+e.toString()+". Er kann nicht in den Datentype "+r.toString()+" des Operanden auf der linken Seite des Operators '"+n+"' umgewandelt werden.","error",t.position)}}else this.pushError("Der rechte Operand der Operatoren 'in' und 'not in' muss eine Unterabfrage oder eine Liste sein.","error",t.secondOperand.position);return h.getBaseType("boolean")}resolveInsert(t){let i=null,n=this.pushNewSymbolTable(t.position,t.endPosition);null!=t.table&&(t.table.table=this.tables.find((e=>e.identifier.toLowerCase()==t.table.identifier.toLocaleLowerCase())),null==t.table.table?this.pushError("Die Tabelle "+t.table.identifier+" gibt es nicht.","error",t.table.position):(i=t.table.table,n.storeTableSymbols(i)));let r=t.endPosition;null!=t.valuesPosition&&(r=t.valuesPosition),null!=t.columnsPosition&&(r=t.columnsPosition),this.module.addCompletionHint(t.position,r,!1,!0,["into","values"]),null!=i&&this.module.addCompletionHint(r,null==t.valuesPosition?t.endPosition:t.valuesPosition,!0,!1,["values"]),this.pushNewSymbolTable(t.position,r).extractDatabaseStructure(this.databaseTool.databaseStructure);let o=[];if(0==t.columnList.length)null!=i&&(o=i.columns);else if(null!=i)for(let e of t.columnList){let t=i.columns.find((t=>t.identifier.toLowerCase()==e.identifier.toLowerCase()));null==t?this.pushError("Die Tabelle "+i.identifier+" besitzt keine Spalte mit dem Bezeichner "+e.identifier+".","error",e.position):o.push(t)}if(o.length>0)if(null!=t.select){let e=this.resolveSelect(t.select);if(null!=(null==e?void 0:e.columns))if(o.length!=e.columns.length)this.pushError("Die insert-Anweisung erwartet "+o.length+" Werte je Datensatz, die select-Anweisung liefert aber "+e.columns.length+".","error",t.position);else for(let i=0;i<o.length;i++){let n=o[i],r=e.columns[i];null!=n.type&&null!=r.type&&(r.type.canCastTo(n.type)||this.pushError("Der Datentyp "+r.type.toString()+" der "+(i+1)+"-ten Spalte des select-Terms kann nicht in den Datentyp "+n.type.toString()+" der entsprechenden Spalte der insert-Anweisung umgewandelt werden.","error",t.position))}}else for(let i of t.values)if(i.length!=o.length&&i.length>0)this.pushError("Erwartet werden "+o.length+" Elemente, hier stehen aber "+i.length+" Elemente in der Liste.","error",i[0].position);else for(let t=0;t<i.length;t++){let n=i[t],r=o[t];n.sqlType=h.fromConstantType(n.constantType);let a=r.type.toString().toLocaleLowerCase();if(n.constantType==e.keywordNull)r.isNullable&&!r.notNull||this.pushError("Die Spalte "+r.identifier+" ist nicht nullable, daher kann null hier nicht eingefügt werden.","error",n.position);else if(n.sqlType.canCastTo(r.type)){if("date"==a){if(!ne(n.constant)){let e=`'${n.constant}' ist kein date-Wert.<br><b>Tipp: </b>Datumswerte haben die Form 'yyyy-mm-dd', also z.B. '2022-06-15'.`;this.pushError(e,"error",n.position)}}else if("datetime"==a||"timestamp"==a){if(!re(n.constant)){let e=`'${n.constant}' ist kein ${a}-Wert.<br><b>Tipp: </b>Timestamps haben die Form 'yyyy-mm-dd hh:min:ss', also z.B. '2022-06-15 07:56:22'.`;this.pushError(e,"error",n.position)}}else if("time"==a&&(null==(s=n.constant)||"string"!=typeof s||null==s.match(/^([01][0-9]|2[0123]):([0-5][0-9]):([0-5][0-9])$/))){let e=`'${n.constant}' ist kein ${a}-Wert.<br><b>Tipp: </b>Time-Werte haben die Form 'hh:min:ss', also z.B. '07:56:22'.`;this.pushError(e,"error",n.position)}}else{let e="Der Wert "+n.constant+" vom Datentyp "+n.sqlType.toString()+" kann nicht in den Datentyp "+r.type.toString()+" der Spalte "+r.identifier+" umgewandelt werden.";"date"==a&&(e+="<br><b>Tipp: </b>Datumswerte haben die Form 'yyyy-mm-dd', also z.B. '2022-06-15'."),"datetime"!=a&&"timestamp"!=a||(e+="<br><b>Tipp: </b>Timestamps haben die Form 'yyyy-mm-dd hh:min:ss', also z.B. '2022-06-15 07:56:22'."),this.pushError(e,"error",n.position)}}var s;this.symbolTableStack.pop()}}var se;!function(e){e[e.compiling=0]="compiling",e[e.error=1]="error",e[e.compiledButNothingToRun=2]="compiledButNothingToRun",e[e.readyToRun=3]="readyToRun"}(se||(se={}));class ae{constructor(e){this.main=e,this.compilerStatus=se.compiledButNothingToRun}compile(e){this.compilerStatus=se.compiling;let t=performance.now(),i=new a;for(let t of e.getModules(!1)){t.file.dirty=!1,t.clear();let e=i.lex(t.getProgramTextFromMonacoModel());t.errors[0]=e.errors,t.tokenList=e.tokens,t.bracketError=e.bracketError,t.file.name==this.main.getCurrentlyEditedModule().file.name&&null!=this.main.getBottomDiv()&&this.main.getBottomDiv().errorManager.showParenthesisWarning(e.bracketError)}this.main.getSemicolonAngel().startRegistering();let n=new V;for(let t of e.getModules(!1))n.parse(t);let r=this.main.getDatabaseTool(),o=new oe(r);for(let t of e.getModules(!1))o.start(t);let s=performance.now()-t;s=Math.round(100*s)/100;let l="Compiled in "+s+" ms.";return this.main.getCurrentWorkspace().compilerMessage=l,this.main.getSemicolonAngel().healSemicolons(),this.compilerStatus=se.readyToRun,null}}class le{constructor(e,t){if(this.main=t,this.oldErrorDecorations=[],this.errors=[[],[],[],[]],this.identifierPositions={},this.methodCallPositions={},this.completionHints=new Map,null==e||null==this.main)return;this.file=e;let i=e.name,n=le.uriMap[i];null==n?n=0:n++,le.uriMap[i]=n,n>0&&(i+=" ("+n+")"),this.uri=monaco.Uri.from({path:i,scheme:"inmemory"}),this.model=monaco.editor.createModel(e.text,"vscSQL",this.uri),this.model.updateOptions({tabSize:3}),this.lastSavedVersionId=this.model.getAlternativeVersionId();let r=this;this.model.onDidChangeContent((()=>{let e=r.model.getAlternativeVersionId();if(e!=r.lastSavedVersionId&&(r.file.dirty=!0,r.file.saved=!1,r.lastSavedVersionId=e),!r.main.isEmbedded()){let e=t;e.workspacesOwnerId!=e.user.id?(null==r.file.text_before_revision||r.file.student_edited_after_revision)&&(r.file.student_edited_after_revision=!1,r.file.text_before_revision=r.file.text,r.file.saved=!1,e.networkManager.sendUpdates(null,!1),e.bottomDiv.homeworkManager.showHomeWorkRevisionButton(),e.projectExplorer.renderHomeworkButton(r.file)):r.file.student_edited_after_revision=!0}}))}addCompletionHint(e,t,i,n,r,o,s="",a=""){let l={fromColumn:e.column,fromLine:e.line,toColumn:t.column,toLine:t.line,hintColumns:"boolean"!=typeof i||i,hintColumnsOfTable:"string"==typeof i?i:null,hintTables:n,hintKeywords:null==r?null:r.map((e=>e.toUpperCase())),dontHint:o,praefix:s,suffix:a};for(let e=l.fromLine;e<=l.toLine;e++){let t=this.completionHints.get(e);null==t&&(t=[],this.completionHints.set(e,t)),t.push(l)}}getSQLSTatementsAtSelection(e){let t={line:e.startLineNumber,column:e.startColumn},i={line:e.endLineNumber,column:e.endColumn};return null==this.sqlStatements?[]:this.sqlStatements.filter((e=>!(this.compare(e.to,t)<0||this.compare(e.from,i)>0)))}compare(e,t){return e.line>t.line?1:e.line<t.line?-1:e.column>t.column?1:e.column<t.column?-1:0}getSQLStatementAtPosition(e){return this.sqlStatements.find((t=>!(t.from.line>e.lineNumber||t.from.line==e.lineNumber&&t.from.column>e.column||t.to.line<e.lineNumber||t.to.line==e.lineNumber&&t.to.column<e.column)))}getCompletionHint(e,t){let i=this.completionHints.get(e);if(null==i||0==i.length)return null;let n=1e3*e+t;if(i=i.filter((e=>n>=1e3*e.fromLine+e.fromColumn&&n<=1e3*e.toLine+e.toColumn)),0==i.length)return;let r=i[0],o=1e3*(r.toLine-r.fromLine)+(r.toColumn-r.fromColumn);for(let e=1;e<i.length;e++){let t=i[e],n=1e3*(t.toLine-t.fromLine)+(t.toColumn-t.fromColumn);n<o&&(r=t,o=n)}return r}static restoreFromData(e,t){let i={name:e.name,text:e.text,text_before_revision:e.text_before_revision,submitted_date:e.submitted_date,student_edited_after_revision:!1,dirty:!0,saved:!0,version:e.version,id:e.id};return new le(i,t)}getFileData(e){let t=this.file;return{id:t.id,name:t.name,text:t.text,text_before_revision:t.text_before_revision,submitted_date:t.submitted_date,student_edited_after_revision:t.student_edited_after_revision,version:t.version,workspace_id:e.id,forceUpdate:!1,file_type:11}}findSymbolTableAtPosition(e,t){return null==this.mainSymbolTable?null:((e>this.mainSymbolTable.positionTo.line||e==this.mainSymbolTable.positionTo.line&&t>this.mainSymbolTable.positionTo.column)&&(e=this.mainSymbolTable.positionTo.line,t=this.mainSymbolTable.positionTo.column-1),this.mainSymbolTable.findTableAtPosition(e,t))}getErrorCount(){let e=0;for(let t of this.errors)t.forEach((t=>e+="error"==t.level?1:0));return e}getProgramTextFromMonacoModel(){return this.model.getValue(monaco.editor.EndOfLinePreference.LF,!1)}addIdentifierPosition(e,t){let i=this.identifierPositions[e.line];null==i&&(i=[],this.identifierPositions[e.line]=i),i.push({position:e,element:t})}getElementAtPosition(e,t){let i=this.identifierPositions[e];if(null==i)return null;let n=null;for(let e of i)t>=e.position.column&&t<e.position.column+e.position.length&&e.position.length>0&&null==n&&(n=e);return null==n?null:n.element}copy(){let e=new le(this.file,this.main);return e.model=this.model,e.mainSymbolTable=this.mainSymbolTable,this.mainSymbolTable=null,this.file.dirty=!0,e}clear(){this.identifierPositions={},null!=this.file&&this.file.dirty&&(this.tokenList=null,this.errors[0]=[],this.errors[1]=[]),this.errors[2]=[],this.errors[3]=[],this.mainSymbolTable=new Y(null,{line:1,column:1,length:1},{line:1e5,column:1,length:0}),this.methodCallPositions={}}hasErrors(){for(let e of this.errors)if(e.find((e=>"error"==e.level)))return!0;return!1}getSortedAndFilteredErrors(){let e=[];for(let t of this.errors)e=e.concat(t);e.sort(((e,t)=>e.position.line>t.position.line?1:t.position.line>e.position.line?-1:e.position.column>=t.position.column?1:-1));for(let t=0;t<e.length-1;t++){let i=e[t],n=e[t+1];i.position.line==n.position.line&&i.position.column+10>n.position.column&&(1==this.errorLevelCompare(i.level,n.level)?e.splice(t+1,1):e.splice(t,1),t--)}return e}errorLevelCompare(e,t){return"error"==e?1:"error"==t?2:"warning"==e?1:"warning"==t?2:1}}le.maxUriNumber=0,le.uriMap={};class de{constructor(e){this.main=e,this.modules=[],this.moduleMap=new Map,this.dirty=!1}findModuleById(e){for(let t of this.modules)if(t.file.id==e)return t;return null}copy(){let e=new de(this.main);for(let t of this.modules)e.putModule(t.copy());return e}findModuleByFile(e){for(let t of this.modules)if(t.file==e)return t;return null}hasErrors(){for(let e of this.modules)if(e.hasErrors())return!0;return!1}getFirstModule(){if(this.modules.length>0)for(let e of this.modules)return e;return null}isDirty(){if(this.dirty)return this.dirty=!1,!0;let e=!1;for(let t of this.modules)if(t.file.dirty){e=!0;break}return e}getModules(e,t){let i=[];for(let e of this.modules)e.file.name!=t&&i.push(e);return i}putModule(e){this.modules.push(e),this.moduleMap[e.file.name]=e}removeModuleWithFile(e){for(let t of this.modules)if(t.file==e){this.removeModule(t);break}}removeModule(e){this.modules.indexOf(e)<0||(this.modules.splice(this.modules.indexOf(e),1),this.moduleMap[e.file.name]=void 0,this.dirty=!0)}getModule(e){return this.moduleMap[e]}}class ue{constructor(e,t){this.$mainElement=e,this.main=t,this.actions={},this.keyEntries={},this.buttons={}}init(){let e=this.$mainElement;null==e&&(e=jQuery(document));let t=this;e.on("keydown",(function(e){null!=e&&t.executeKeyDownEvent(e)}))}trigger(e){let t=this.actions[e];null!=t&&t.action(e,null,"")}registerAction(e,t,i,n="",r){let o={action:i,identifier:e,keys:t,text:n,active:!0};this.actions[e]=o;for(let e of t)null==this.keyEntries[e.toLowerCase()]&&(this.keyEntries[e.toLowerCase()]=[]),this.keyEntries[e.toLowerCase()].push(o);if(null!=r){null==this.buttons[e]&&(this.buttons[e]=[]),this.buttons[e].push(r);let s=n;t.length>0&&(s+=" ["+t.join(", ")+"]"),r.attr("title",s),r.on("mousedown",(()=>{o.active&&i(e,null,"mousedown")}))}}isActive(e){let t=this.actions[e];return null!=t&&t.active}setActive(e,t){let i=this.actions[e];null!=i&&(i.active=t);let n=this.buttons[e];if(null!=n)for(let e of n)t?e.addClass("jo_active"):e.removeClass("jo_active")}executeKeyDownEvent(e){if("input"==document.activeElement.tagName.toLowerCase())return;if(e.keyCode<=18&&e.keyCode>=16)return;let t="";e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),null!=e.key&&(t+=e.key.toLowerCase());let i=this.keyEntries[t];if(null!=i)for(let n of i)if(n.active){e.stopPropagation(),e.preventDefault(),n.action(n.identifier,null,t);break}}}function he(e,t,i,n=null){let r=window.PointerEvent?"pointer":"mouse";null==t&&(t=e);let o=jQuery('<input type="text" class="jo_inplaceeditor" spellcheck="false">');o.css({width:t.css("width"),height:t.css("height"),color:t.css("color"),position:t.css("position"),"background-color":t.css("background-color"),"font-size":t.css("font-size"),"font-weight":t.css("font-weight"),"box-sizing":"border-box"}),o.val(e.text()),o.on(r+"down",(e=>{e.stopPropagation()})),null!=n&&o[0].setSelectionRange(n.start,n.end),t.after(o),t.hide(),setTimeout((()=>{o.focus()}),300),o.on("keydown.me",(e=>{if("Enter"!=e.key&&"Escape"!=e.key);else{o.off("keydown.me"),o.off("focusout.me"),o.remove(),t.show();let e=te(o.val());i(e)}})),o.on("focusout.me",(e=>{o.off("keydown.me"),o.off("focusout.me"),o.remove(),t.show();let n=te(o.val());i(n)}))}function ce(e,t,i){let n=window.PointerEvent?"pointer":"mouse",r=jQuery('<div class="jo_contextmenu"></div>'),o=null,s=null;for(let t of e){let e=t.caption;null!=t.link&&(e=`<a href="${t.link}" target="_blank" class="jo_menulink">${t.caption}</a>`);let i=jQuery("<div>"+e+(null!=t.subMenu?'<span style="float: right"> &nbsp; &nbsp; &gt;</span>':"")+"</div>");if(null!=t.color&&i.css("color",t.color),null==t.link)i.on(n+"up.contextmenu",(e=>{e.stopPropagation(),jQuery(".jo_contextmenu").remove(),jQuery(document).off(n+"up.contextmenu"),jQuery(document).off(n+"down.contextmenu"),jQuery(document).off("keydown.contextmenu"),t.callback()})),i.on(n+"down.contextmenu",(e=>{e.stopPropagation()}));else{let e=i.find("a");e.on(n+"up",(e=>{e.stopPropagation(),setTimeout((()=>{i.hide()}),500)})),e.on(n+"down",(e=>{e.stopPropagation()}))}i.on(n+"move.contextmenu",(()=>{t!=s&&null!=o&&(o.remove(),s=null,o=null),null!=t.subMenu&&(o=ce(t.subMenu,i.offset().left+i.width(),i.offset().top))})),r.append(i)}jQuery(document).on(n+"down.contextmenu",(e=>{jQuery(document).off(n+"down.contextmenu"),jQuery(document).off("keydown.contextmenu"),jQuery(".jo_contextmenu").remove()})),jQuery(document).on("keydown.contextmenu",(e=>{"Escape"==e.key&&(jQuery(document).off(n+"up.contextmenu"),jQuery(document).off("keydown.contextmenu"),jQuery(".jo_contextmenu").remove())}));let a=t>.8*window.innerWidth?"right":"left",l=t>.8*window.innerWidth?window.innerWidth-t:t,d=i>.8*window.innerHeight?"bottom":"top",u=i>.8*window.innerHeight?window.innerHeight-i:i,h={};return h[a]=l+"px",h[d]=u+"px",r.css(h),jQuery("body").append(r),r.show(),r}function me(e){let t=e.find(".jo_tabheadings>div").not(".jo_noHeading"),i=e.find(".jo_tabs>div"),n=window.PointerEvent?"pointer":"mouse";t.on(n+"down",(n=>{let r=jQuery(n.target);t.removeClass("jo_active"),r.addClass("jo_active");let o=e.find("."+r.data("target"));i.removeClass("jo_active"),i.trigger("myhide"),o.addClass("jo_active"),o.trigger("myshow")}))}function pe(e,t="",i="",n){let r="";null!=e&&""!=e&&(r+=` id="${e}"`),null!=t&&""!=t&&(r+=` class="${t}"`);let o=jQuery(`<div${r}></div>`);return null!=n&&o.css(n),null!=i&&""!=i&&o.text(i),o}var fe=!1;function ge(e,t,i,n){let r="rgba("+i[0]+", "+i[1]+", "+i[2]+", ",o=1,s=o/(n/20),a=()=>{e.css(t,r+o+")"),o-=s,o<0?e.css(t,""):setTimeout(a,20)};a()}function be(e){navigator.clipboard?navigator.clipboard.writeText(e).then((function(){}),(function(e){console.error("Async: Could not copy text: ",e)})):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}(e)}class we{static registerPerformanceEntry(e,t){let i=we.performanceData.find((t=>t.url==e));null==i&&(i={count:0,sumTime:0,url:e},we.performanceData.push(i)),i.count++;let n=Math.round(performance.now()-t);i.sumTime+=n,we.performanceDataCount++}static sendDataToServer(){if(performance.now()-we.lastTimeSent>18e4){let e={data:we.performanceData};we.performanceData=[],we.performanceDataCount=0,we.lastTimeSent=performance.now(),ke("collectPerformanceData",e,(()=>{}))}}}function ke(e,t,i,n){ye(!0);let r=performance.now();$.ajax({type:"POST",async:!0,data:JSON.stringify(t),contentType:"application/json",url:"servlet/"+e,success:function(t){if(we.registerPerformanceEntry(e,r),ye(!1),null!=t.success&&0==t.success||"string"==typeof t&&""==t){let e="Fehler bei der Bearbeitung der Anfrage";null!=t.message&&(e=t.message),n&&n(e)}else i(t)},error:function(e,t){if(ye(!1),n){let i="Server nicht erreichbar.";return 0!=e.status&&(i=""+e.status),void n(t+": "+i)}}})}function ye(e){e?jQuery(".jo_network-busy").css("visibility","visible"):jQuery(".jo_network-busy").css("visibility","hidden")}we.performanceData=[],we.performanceDataCount=0,we.lastTimeSent=performance.now();class ve{static fromDatabaseData(e,t){let i=new ve;return i.id=e.id,i.name=e.name,i.statements=e.statements,i.published_to=e.published_to,i.version=t,i.description=e.description,i.templateDump=null,i.based_on_template_id=e.based_on_template_id,i.owner_id=e.owner_id,i}}class Ce{fetchTemplateFromCache(e,t){if(null==e)return void t(null);let i=this;this.cacheAvailable()||t(null),this.getCache((n=>{n.match(i.databaseIdToCacheIdentifier(e)).then((e=>{e.arrayBuffer().then((e=>t(new Uint8Array(e))))})).catch((()=>t(null)))}))}saveTemplateToCache(e,t){if(!this.cacheAvailable())return;let i=this;this.getCache((n=>{n.put(i.databaseIdToCacheIdentifier(e),new Response(t))}))}cacheAvailable(){return"caches"in self}getCache(e){caches.open("my-cache").then(e)}databaseIdToCacheIdentifier(e){return"/onlineIdeTemplateDb"+e}}class Te{constructor(e,t){this.main=e,this.networkManager=t,this.unsentMessages=[],this.connect()}connect(){this.state="connecting",ke("getWebSocketToken",{},(e=>{let t=(window.location.protocol.startsWith("https")?"wss://":"ws://")+window.location.host+"/servlet/subscriptionwebsocket";this.connection=new WebSocket(t),this.connection.onerror=e=>{this.onError(e)},this.connection.onclose=e=>{this.onClose(e)},this.connection.onmessage=e=>{this.onMessage(e)},this.connection.onopen=t=>{let i={command:1,token:e.token};this.state="connected",this.sendIntern(JSON.stringify(i))},setTimeout((()=>{"subscribed"!=this.state&&(this.networkManager.forcedUpdateEvery=1,this.networkManager.counterTillForcedUpdate=1)}),7e3)}))}disconnect(){this.state="connected",this.sendIntern(JSON.stringify({command:2}))}sendIntern(e){if("disconnected"!=this.state)try{this.connection.send(e)}catch(e){console.log(e)}}onClose(e){this.state="disconnected"}onMessage(e){let t=JSON.parse(e.data);if(null!=t.command)switch(t.command){case 1:this.state="subscribed";break;case 2:this.networkManager.sendUpdates((()=>{}),!0);break;case 3:this.state="disconnected"}}onError(e){console.log("Fehler beim Notifier-Websocket")}}class xe{uploadCurrentDatabase(e,t,i,n,r=(()=>{})){t.waitOverlay.show("Bitte warten, lade Vorlage auf den Server hoch ..."),e>=0?t.getDatabaseTool().export((i=>{i=pako.deflate(i),this.uploadIntern(i,e,n,t,r)}),(e=>{alert("Fehler beim Exportieren der Datenbank: "+e),t.waitOverlay.hide()})):this.uploadIntern(i,-1,n,t,r)}uploadIntern(e,t,i,n,r){return $.ajax({type:"POST",async:!0,contentType:"application/octet-stream",data:e,processData:!1,headers:{"x-workspaceid":""+t,"x-reason":i},url:"servlet/uploadTemplate",success:function(e){n.waitOverlay.hide(),r(e)},error:function(e,t){alert("message"),n.waitOverlay.hide()}}),e}}class Ee{constructor(e,t){this.main=e,this.$updateTimerDiv=t,this.ownUpdateFrequencyInSeconds=20,this.teacherUpdateFrequencyInSeconds=5,this.updateFrequencyInSeconds=20,this.forcedUpdateEvery=4,this.counterTillForcedUpdate=2,this.secondsTillNextUpdate=this.updateFrequencyInSeconds,this.errorHappened=!1}initializeTimer(){let e=this;this.$updateTimerDiv.find("svg").attr("width",e.updateFrequencyInSeconds),null!=this.interval&&clearInterval(this.interval),this.interval=setInterval((()=>{if(null==e.main.user)return;if(e.secondsTillNextUpdate--,e.secondsTillNextUpdate<0){e.secondsTillNextUpdate=e.updateFrequencyInSeconds,this.counterTillForcedUpdate--;let t=0==this.counterTillForcedUpdate;t&&(this.counterTillForcedUpdate=this.forcedUpdateEvery),e.sendUpdates((()=>{}),t)}let t=this.$updateTimerDiv.find(".jo_updateTimerRect");t.attr("width",e.secondsTillNextUpdate+"px"),e.errorHappened?(t.css("fill","#c00000"),this.$updateTimerDiv.attr("title","Fehler beim letzten Speichervorgang -> Werd's wieder versuchen")):(t.css("fill","#008000"),this.$updateTimerDiv.attr("title",e.secondsTillNextUpdate+" Sekunden bis zum nächsten Speichern"))}),1e3)}initializeNotifierClient(){this.notifierClient=new Te(this.main,this)}sendUpdates(e,t=!1){var i;if(null==this.main.user)return;this.main.projectExplorer.writeEditorTextToFile(),this.main.userDataDirty&&(this.main.userDataDirty=!1,this.sendUpdateUserSettings((()=>{})));let n=[],r=[];for(let e of this.main.workspaceList){e.saved||(n.push(e.getWorkspaceData(!1)),e.saved=!0);for(let t of e.moduleStore.getModules(!1))t.file.saved||(t.file.text=t.getProgramTextFromMonacoModel(),r.push(t.getFileData(e)),t.file.saved=!0)}let o={workspacesWithoutFiles:n,files:r,owner_id:this.main.workspacesOwnerId,userId:this.main.user.id,language:1,currentWorkspaceId:null===(i=this.main.getCurrentWorkspace())||void 0===i?void 0:i.id,getModifiedWorkspaces:!1},s=this;if(n.length>0||r.length>0||t)ke("sendUpdates",o,(t=>{s.errorHappened=!t.success,s.errorHappened||(s.updateWorkspaces(o,t),null==e)||e()}),(()=>{s.errorHappened=!0}));else if(null!=e)return void e()}sendCreateWorkspace(e,t,i){if(this.main.user.is_testuser)return e.id=Math.round(1e7*Math.random()),void i(null);ke("createOrDeleteFileOrWorkspace",{type:"create",entity:"workspace",data:e,owner_id:t,userId:this.main.user.id},(t=>{e.id=t.id,i(null)}),i)}getDatabaseSettings(e,t){ke("getDatabaseSettings",{workspaceId:e},(e=>{t(e)}),(e=>{alert(e)}))}setNewSecret(e,t,i){ke("setNewSecret",{workspaceId:e,secretKind:t},(e=>{i(e.secret)}),(e=>{alert(e)}))}setNameAndPublishedTo(e,t,i,n,r){ke("setPublishedTo",{workspaceId:e,databaseName:t,publishedTo:i,description:n},(e=>{r()}),(e=>{alert(e)}))}sendCreateFile(e,t,i,n){ke("createOrDeleteFileOrWorkspace",{type:"create",entity:"file",data:e.getFileData(t),owner_id:i,userId:this.main.user.id},(t=>{e.file.id=t.id,n(null)}),n)}sendDuplicateWorkspace(e,t){ke("duplicateWorkspace",{workspace_id:e.id,language:1},(e=>{t(e.message,e.workspace)}),t)}sendDistributeWorkspace(e,t,i,n){this.main.projectExplorer.setWorkspaceActive(e,(()=>{(new xe).uploadCurrentDatabase(e.id,this.main,null,"distributeWorkspace",(r=>{this.sendUpdates((()=>{ke("distributeWorkspace",{workspace_id:e.id,database_as_template_id:r.newTemplateId,class_id:null==t?void 0:t.id,student_ids:i},(e=>{n(e.message)}),n)}),!1)}))}))}sendDeleteWorkspaceOrFile(e,t,i){ke("createOrDeleteFileOrWorkspace",{type:"delete",entity:e,id:t,userId:this.main.user.id},(e=>{e.success?i(null):i("Netzwerkfehler!")}),i)}sendUpdateUserSettings(e){var t;ke("updateUserSettings",{settings:this.main.user.settings,userId:this.main.user.id,current_workspace_id:null===(t=this.main.getCurrentWorkspace())||void 0===t?void 0:t.id},(t=>{t.success?e(null):e("Netzwerkfehler!")}),e)}getNewStatements(e,t){ke("getNewStatements",{workspaceId:e.id,version_before:e.database.version},(e=>{e.success&&t(e.newStatements,e.firstNewStatementIndex)}))}AddDatabaseStatements(e,t,i){ke("addDatabaseStatements",{workspaceId:e.id,version_before:e.database.version,statements:t},(e=>{e.success&&i(e.statements_before,e.new_version)}))}fetchDatabase(e,t){let i=new Ce;ke("getDatabase",{workspaceId:e.id},(n=>{n.success?(e.database=ve.fromDatabaseData(n.database,n.version),i.fetchTemplateFromCache(e.database.based_on_template_id,(n=>{if(null==n)null!=e.database.based_on_template_id?this.fetchTemplate(e.id,(n=>null!=n?(i.saveTemplateToCache(e.database.based_on_template_id,n),e.database.templateDump=pako.inflate(n),void t(null)):void t("Konnte das Template nicht laden."))):t(null);else{try{e.database.templateDump=pako.inflate(n)}catch(t){console.log(t),console.log("Dump seems not to be compressed..."),e.database.templateDump=n}t(null)}}))):t("Netzwerkfehler!")}))}fetchTemplate(e,t){let i={workspaceId:e};$.ajax({type:"POST",async:!0,data:JSON.stringify(i),contentType:"application/json",url:"servlet/getTemplate",xhrFields:{responseType:"arraybuffer"},success:function(e){t(new Uint8Array(e))},error:function(e,i){alert("Konnte das Template nicht laden."),t(null)}})}fetchTemplateList(e){ke("getTemplateList",{user_id:this.main.user.id},(t=>{t.success?e(t.templateList):e([])}),(t=>{alert(t),e([])}))}updateWorkspaces(e,t){let i=new Map,n=[];e.files.forEach((e=>n.push(e.id))),t.workspaces.workspaces.forEach((e=>i.set(e.id,e)));let r=[];for(let e of t.workspaces.workspaces)0==this.main.workspaceList.filter((t=>t.id==e.id)).length&&(r.push(e.name),this.createNewWorkspaceFromWorkspaceData(e));for(let e of this.main.workspaceList){let t=i.get(e.id);if(null!=t){let i=new Map;t.files.forEach((e=>i.set(e.id,e)));let r=new Map;for(let t of e.moduleStore.getModules(!1)){let e=t.file.id;r.set(e,t);let o=i.get(e);null==o?(this.main.projectExplorer.fileListPanel.removeElement(t),this.main.currentWorkspace.moduleStore.removeModule(t)):o.version>t.file.version&&((n.indexOf(e)<0||o.forceUpdate)&&(t.file.text=o.text,t.model.setValue(o.text),t.file.saved=!0,t.lastSavedVersionId=t.model.getAlternativeVersionId()),t.file.version=o.version)}for(let i of t.files)null==r.get(i.id)&&this.createFile(e,i)}}if(r.length>0){let e=r.length>1?"Folgende Workspaces hat Deine Lehrkraft Dir gesendet: ":"Folgenden Workspace hat Deine Lehrkraft Dir gesendet: ";e+=r.join(", "),alert(e)}this.main.projectExplorer.workspaceListPanel.sortElements(),this.main.projectExplorer.fileListPanel.sortElements()}createNewWorkspaceFromWorkspaceData(e,t=!1){let i=this.main.createNewWorkspace(e.name,e.owner_id);i.id=e.id,i.sql_history="",i.path=e.path,i.isFolder=e.isFolder,this.main.workspaceList.push(i);let n=e.path.split("/");1==n.length&&""==n[0]&&(n=[]);let r={name:e.name,externalElement:i,iconClass:"workspace",isFolder:e.isFolder,path:n};this.main.projectExplorer.workspaceListPanel.addElement(r,!0),i.panelElement=r;for(let t of e.files)this.createFile(i,t);t&&(this.main.projectExplorer.workspaceListPanel.sortElements(),this.main.projectExplorer.fileListPanel.sortElements())}createFile(e,t){let i=null;e==this.main.currentWorkspace&&(i={name:t.name,externalElement:null},this.main.projectExplorer.fileListPanel.addElement(i,!0));let n={id:t.id,name:t.name,dirty:!1,saved:!0,text:t.text,version:t.version,identical_to_repository_version:!0,workspace_id:e.id,panelElement:i},r=this.main.projectExplorer.getNewModule(n);null!=i&&(i.externalElement=r),e.moduleStore.putModule(r)}rollback(e){let t=this.main.currentWorkspace;ke("rollback",{workspaceId:t.id,version:t.database.version},(i=>{i.success?e(null,t.database.version>i.new_version):(alert(i.message),e(i.message,!1))}),(t=>{alert(t),e(t,!1)}))}}class Se{constructor(e,t){this.main=e,this.workspace=t,this.init()}init(){this.$dialog=jQuery("#dialog"),jQuery("#main").css("visibility","hidden"),this.$dialog.append(jQuery('<div class="jo_ds_heading">Datenbank-Einstellungen</div>\n            <div style="width: 100%; margin-left: 10px">\n                <div class="jo_ds_settings" style="margin-left: 0px">\n                <div class="jo_ds_settings_caption">Name der Datenbank:</div><div><input class="dialog-input jo_databasename" value="Neue Datenbank"></input></div>\n                </div>\n\n                <div class="jo_ds_settings_caption" style="margin-top: 20px">\n                Zugriffscodes für andere Benutzer:\n                </div>\n                                \n                <div>\n                    <table class="jo_ds_secret_table">\n                    <tr>\n                        <td>Nur Lesen:</td><td class="jo_ds_secret jo_ds_secret_read"></td><td id="copySecretTdread"></td><td><button class="jo_small_button jo_button_code_read">Neuen Code generieren</button></td>\n                    <tr>\n                        <td>Lesen und schreiben:</td><td class="jo_ds_secret jo_ds_secret_write"></td><td id="copySecretTdwrite"></td><td><button class="jo_small_button jo_button_code_write">Neuen Code generieren</button></td>\n                    </tr>\n                    <tr>\n                        <td>Lesen, schreiben und Struktur verändern:</td><td class="jo_ds_secret jo_ds_secret_ddl"></td><td id="copySecretTdddl"></td><td><button class="jo_small_button jo_button_code_ddl">Neuen Code generieren</button></td>\n                    </tr>\n                    </table>\n                </div>\n\n                <div class="jo_ds_settings_caption" style="margin-top: 20px">\n                Beschreibung:\n                </div>\n                <div>\n                <textarea class="jo_ds_settings_description" maxlength="5000"></textarea>\n                </div>\n\n                <div class="jo_ds_settings_caption" style="margin-top: 20px">\n                Datenbank freigeben als Vorlage für andere Benutzer:\n                </div>\n\n                <fieldset id="jo_ds_publishedTo">\n                    <input type="radio" id="b0" name="publishedFilter" value="0" checked="checked"><label for="b0">Keine Freigabe</label>\n                    <input type="radio" id="b1" name="publishedFilter" value="1"><label for="b1">Freigabe für meine Klasse(n)</label>\n                    <input type="radio" id="b2" name="publishedFilter" value="2" style="visibility: none"><label id="lb2" for="b2" style="visibility: none">Freigabe für meine Schule</label>\n                    <input type="radio" id="b3" name="publishedFilter" value="3" style="visibility: none"><label id="lb3" for="b3" style="visibility: none">Freigabe für alle Schulen</label>\n                </fieldset>\n\n                <div>\n                    <input type="checkbox" id="jo_upload_db" name="jo_upload_db">\n                    <label for="jo_upload_db">Aktuellen Zustand der Datenbank als Vorlage hochladen</label>\n                </div>\n            </div>\n\n\n             <div class="dialog-buttonRow jo_ds_buttonRow">\n                <button id="jo_ds_cancel_button">Abbrechen</button>\n                <button id="jo_ds_save_button">Speichern</button>\n             </div>\n            '));let e=this;this.$dialog.css("visibility","visible"),jQuery("#jo_ds_cancel_button").on("click",(()=>{this.showMainWindow()})),jQuery("#jo_ds_save_button").on("click",(()=>{this.saveNameAndPublishedTo()})),this.setValues(),["read","write","ddl"].forEach((t=>{jQuery(".jo_button_code_"+t).on("pointerdown",(()=>{e.main.networkManager.setNewSecret(e.workspace.id,t,(e=>{jQuery(".jo_ds_secret_"+t).text(e)}))}));let i=jQuery('<button class="jo_small_button jo_copy_secret_button jo_active">Kopieren</button>');jQuery("#copySecretTd"+t).append(i),i.on("pointerdown",(()=>{be(jQuery(".jo_ds_secret_"+t).text())}))})),jQuery("#jo_ds_publishedTo>input").on("change",(e=>{$("#jo_upload_db").prop("checked",!jQuery("#b0")[0].checked)}))}saveNameAndPublishedTo(){let e=0;jQuery("#jo_ds_publishedTo").find("input").each(((t,i)=>{let n=jQuery(i);i.checked&&(e=Number.parseInt(n.attr("value")))})),this.main.networkManager.setNameAndPublishedTo(this.workspace.id,jQuery(".jo_databasename").val(),e,jQuery(".jo_ds_settings_description").val(),(()=>{$("#jo_upload_db").prop("checked")&&(new xe).uploadCurrentDatabase(this.workspace.id,this.main,null,"publishDatabaseAsTemplate"),this.showMainWindow()}))}setValues(){jQuery(".jo_databasename").val(this.workspace.name),this.main.networkManager.getDatabaseSettings(this.workspace.id,(e=>{["read","write","ddl"].forEach((t=>{jQuery(".jo_ds_secret_"+t).text(e.secrets[t])})),this.main.user.is_admin&&(jQuery("#b3").css("visibility","visible"),jQuery("#lb3").css("visibility","visible")),this.main.user.is_schooladmin&&(jQuery("#b2").css("visibility","visible"),jQuery("#lb2").css("visibility","visible")),jQuery("#b"+e.publishedTo).prop("checked",!0),jQuery("#jo_upload_db").prop("checked",0!=e.publishedTo),jQuery(".jo_ds_settings_description").val(this.workspace.database.description)}))}showMainWindow(){jQuery("#main").css("visibility","visible"),this.$dialog.css("visibility","hidden"),this.$dialog.empty()}}class _e{constructor(e,t,i){this.main=t,this.path="",this.saved=!0,this.name=e,this.owner_id=i,this.moduleStore=new de(t),this.sql_history=""}getWorkspaceData(e){let t={name:this.name,id:this.id,owner_id:this.owner_id,currentFileId:null==this.currentlyOpenModule?null:this.currentlyOpenModule.file.id,files:[],sql_history:this.sql_history,path:this.path,isFolder:!1,permissions:this.permissions,database_id:this.databaseId};if(e)for(let e of this.moduleStore.getModules(!1))t.files.push(e.getFileData(this));return t}renderSettingsButton(e){var t;let i=null===(t=null==e?void 0:e.$htmlFirstLine)||void 0===t?void 0:t.find(".jo_additionalButtonSettings");if(null==i)return;let n=jQuery('<div class="jo_settingsButton img_settings jo_button jo_active" title="Datenbank-Einstellungen..."></div>');i.append(n);let r=this;n.on("pointerdown",(e=>e.stopPropagation())),n.on("pointerup",(e=>{e.stopPropagation(),new Se(r.main,r)})),n[0].addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation()}),!1)}static restoreFromData(e,t){let i=new _e(e.name,t,e.owner_id);i.id=e.id,i.path=e.path,i.isFolder=e.isFolder,i.owner_id=e.owner_id,i.sql_history=e.sql_history,i.permissions=e.permissions,i.databaseId=e.database_id;for(let n of e.files){let r=le.restoreFromData(n,t);i.moduleStore.putModule(r),n.id==e.currentFileId&&(i.currentlyOpenModule=r)}return i}hasErrors(){return this.moduleStore.hasErrors()}getModuleByMonacoModel(e){for(let t of this.moduleStore.getModules(!1))if(t.model==e)return t;return null}}class je{constructor(e){this.main=e,this.triggerCharacters=[".","abcdefghijklmnopqrstuvwxyzäöüß_ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜ"," ",",","("],this.keywordCompletionItems=new Map,this.first=!0,this.keywordToSnippetMap={"(":"(\n\t$0\n)",varchar:"varchar($1) $0",decimal:"decimal($1, $2) $0"},this.setupKeywordCompletionItems()}provideCompletionItems(e,t,i,n){let r=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);return null==r||null==r.mainSymbolTable?null:new Promise(((o,s)=>{let a=this,l=function(){r.file.dirty?setTimeout((()=>{l()}),100):o(a.provideCompletionItemsIntern(e,t,i,n))};l()}))}provideCompletionItemsIntern(e,t,i,n){setTimeout((()=>{let e=this.main.getMonacoEditor()._contentWidgets["editor.widget.suggestWidget"].widget;this.first&&(e.toggleDetails(),this.first=!1)}),500);let r=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(null==r||null==r.mainSymbolTable)return null;if(this.isStringLiteral(r,t))return null;let o=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),s=e.getValueInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:t.lineNumber+5,endColumn:1}),a=r.mainSymbolTable.findTableAtPosition(t.lineNumber,t.column),l=r.getCompletionHint(t.lineNumber,t.column);null==l&&(l={fromColumn:0,toColumn:0,fromLine:0,toLine:0,hintColumns:!1,hintTables:!1,hintKeywords:[]});let d=[];this.addKeywordCompletionItems(l,d);let u=o.match(/.*\s([\wöäüÖÄÜß]*)(\.)([\wöäüÖÄÜß]*)$/),h=s.match(/^([\wöäüÖÄÜß]*)/),c="";null!=h&&h.length>0&&(c=h[0]),null==u?this.addIdentifierCompletionItems(l,a,d):this.addDotCompletionItems(t,u,c,a,d);let m=e.getWordUntilPosition(t),p={startColumn:m.startColumn,startLineNumber:t.lineNumber,endColumn:m.endColumn,endLineNumber:t.lineNumber},f={startColumn:t.column,startLineNumber:t.lineNumber,endColumn:t.column,endLineNumber:t.lineNumber};for(let e of d)null==e.range&&(e.insertText.startsWith(",")?e.range=f:e.range=p);return null!=l.dontHint&&(d=d.filter((e=>l.dontHint.indexOf(e.insertText)<0))),{suggestions:d}}addDotCompletionItems(e,t,i,n,r){let o=t[3],s=t[1],a=(e.column,o.length,{startLineNumber:e.lineNumber,startColumn:e.column-o.length,endLineNumber:e.lineNumber,endColumn:e.column+i.length});for(let e of n.symbolList)if(null!=e.table){let t=e.table.identifier;if(null!=e.tableAlias&&(t=e.tableAlias),t.toLowerCase()==s)for(let t of e.table.columns)r.push({label:t.identifier,detail:"Spalte "+t.identifier+" der Tabelle "+e.table.identifier,filterText:t.identifier,insertText:t.identifier,insertTextRules:monaco.languages.CompletionItemInsertTextRule.KeepWhitespace,kind:monaco.languages.CompletionItemKind.Field,range:a})}}addIdentifierCompletionItems(e,t,i){var n,r;let o=null==e.praefix?"":e.praefix,s=null==e.suffix?"":e.suffix;if(!e.hintTables&&!e.hintColumns)return;let a={},l=t,d={},u=[];for(;null!=l;){for(let t of l.symbolList)if(null!=t.column){let e=t.column.identifier;null==d[e]?(d[e]=[t],u.push(e)):d[e].push(t)}else if(null!=t.table&&e.hintTables&&!a[t.identifier]){let e=o+t.identifier+s;i.push({label:t.identifier,detail:"Tabelle "+t.table.identifier,filterText:t.identifier,insertText:e,insertTextRules:e.indexOf("$")>=0?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:monaco.languages.CompletionItemInsertTextRule.KeepWhitespace,kind:e.indexOf("$")>=0?monaco.languages.CompletionItemKind.Snippet:monaco.languages.CompletionItemKind.Class,range:void 0,sortText:"aa"+t.identifier}),a[t.identifier]=!0}l=l.parent}if(e.hintColumns)for(let t of u){let a=d[t],l=a.length>1&&null==e.hintColumnsOfTable;for(let t of a){let a=t.identifier;if(l&&t.identifier==t.column.identifier.toLowerCase()&&(a=(null==t.tableAlias?t.column.table.identifier:t.tableAlias)+"."+a),null==e.hintColumnsOfTable||(null===(r=null===(n=t.column)||void 0===n?void 0:n.table)||void 0===r?void 0:r.identifier)==e.hintColumnsOfTable){let e=o+a+s;i.push({label:a,detail:"Die Spalte "+t.column.identifier+" der Tabelle "+t.column.table.identifier,filterText:a,insertText:e,insertTextRules:e.indexOf("$")>=0?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:monaco.languages.CompletionItemInsertTextRule.KeepWhitespace,kind:e.indexOf("$")>=0?monaco.languages.CompletionItemKind.Snippet:monaco.languages.CompletionItemKind.Field,range:void 0})}}}}addKeywordCompletionItems(e,t){let i=null==e.praefix?"":e.praefix,n=null==e.suffix?"":e.suffix;for(let r of e.hintKeywords){let e=i+r+n,o=this.keywordToSnippetMap[r],s=this.keywordCompletionItems.get(r);if(null!=s)t.push(s);else if(null!=o){let e=o.replace("$0","").replace("$1","").replace("$2","").replace(/ /g,"").replace(/\n/g,"").replace(/\t/g,"");t.push({label:e,detail:"",filterText:r,insertText:o,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0})}else t.push({label:r,detail:"",filterText:r,insertText:r,insertTextRules:e.indexOf("$")>=0?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:monaco.languages.CompletionItemInsertTextRule.KeepWhitespace,kind:e.indexOf("$")>=0?monaco.languages.CompletionItemKind.Snippet:monaco.languages.CompletionItemKind.Keyword,range:void 0,sortText:"from"==r?"*":void 0})}}isStringLiteral(t,i){let n=t.tokenList;if(null==n||0==n.length)return!1;let r,o=0,s=n.length-1,a=1e3;for(;;){let t=r;if(r=Math.round((s+o)/2),t==r)return!1;if(a--,0==a)return!1;let l=n[r],d=l.position;if(d.line<i.lineNumber||d.line==i.lineNumber&&d.column+d.length<i.column)o=r;else{if(!(d.line>i.lineNumber||d.line==i.lineNumber&&d.column>i.column))return l.tt==e.stringConstant;s=r}}}setupKeywordCompletionItems(){this.keywordCompletionItems.set("delete from",{label:"delete from <Tabelle> where <Bedingung>",detail:"Anweisung zum Löschen von Datensätzen",filterText:"delete from",insertText:"delete from ",command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}),this.keywordCompletionItems.set("drop table",{label:"drop table <Tabelle>",detail:"Anweisung zum Löschen einer Tabelle",filterText:"drop table",insertText:"drop table ",command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}),this.keywordCompletionItems.set("alter",{label:"alter table <Tabelle> <rename to, rename column, add column, drop column>",detail:"Anweisung zum Ändern des Schemas (alter table <Tabelle> <rename to, rename column, add column, drop column>)",filterText:"alter",insertText:"alter table ",command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}),this.keywordCompletionItems.set("select",{label:"select <Spalten> from <Tabellen> where <Bedingung>",detail:"Select-Anweisung",filterText:"select",insertText:"select * from $1\nwhere $0\n",command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}),this.keywordCompletionItems.set("create table",{label:"create table <Tabellenbezeichner> (<Spaltendefinitionen>)",detail:"Create table-Anweisung (Erstellt eine neue Tabelle)",filterText:"create",insertText:"create table $1 (\n\t$0\n);",command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0})}}class De{constructor(e){this.main=e,this.signatureHelpTriggerCharacters=["(",",",";","<",">","="],this.signatureHelpRetriggerCharacters=[]}provideSignatureHelp(e,t,i,n){let r=this;return new Promise(((o,s)=>{setTimeout((()=>{this.main.compileIfDirty(),o(r.provideSignatureHelpLater(e,t,i,n))}),300)}))}provideSignatureHelpLater(e,t,i,n){this.main.getMonacoEditor().getModel();let r=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(null==r)return null;let o=r.methodCallPositions[t.lineNumber];if(null==o)return null;let s=null,a=-1;for(let e=o.length-1;e>=0;e--){let i=o[e];i.identifierPosition.column+i.identifierPosition.length<t.column&&i.identifierPosition.column>a&&(null==i.rightBracketPosition||t.lineNumber<=i.rightBracketPosition.line&&t.column<=i.rightBracketPosition.column||t.lineNumber<i.rightBracketPosition.line)&&(s=i,a=i.identifierPosition.column)}return null==s?null:this.getSignatureHelp(s,t)}getSignatureHelp(e,t){let i=0;for(let n of e.commaPositions)(n.line<t.lineNumber||n.line==t.lineNumber&&n.column<t.column)&&i++;return Promise.resolve({value:{activeParameter:i,activeSignature:0,signatures:[]},dispose:()=>{}})}}class Le{constructor(e){this.editor=e}provideHover(e,t,i){var n;let r=this.editor.editor.getSelection();if(null!=r&&(r.startLineNumber!=r.endLineNumber||r.startColumn!=r.endColumn)&&(r.startLineNumber<t.lineNumber||r.startLineNumber==t.lineNumber&&r.startColumn<=t.column)&&(r.endLineNumber>t.lineNumber||r.endLineNumber==t.lineNumber&&r.endColumn>=t.column))return;let o=null===(n=this.editor.main.getCurrentWorkspace())||void 0===n?void 0:n.getModuleByMonacoModel(e);if(null==o)return null;for(let e of o.errors)for(let i of e)if(i.position.line==t.lineNumber&&i.position.column<=t.column&&i.position.column+i.position.length>=t.column)return null;if(null!=o.getElementAtPosition(t.lineNumber,t.column));else{let i=this.getWordUnderCursor(e,t),n=Le.keywordDescriptions[i];if(null!=n)return{range:null,contents:[{value:n}]}}}getWordUnderCursor(e,t){let i=e.getValueLengthInRange({startColumn:0,startLineNumber:0,endLineNumber:t.lineNumber,endColumn:t.column}),n=e.getValue(),r="",o=i;for(;o<n.length&&this.isInsideIdentifierOrArrayDescriptor(n.charAt(o));)o++;let s=i;for(;s>0&&this.isInsideIdentifierOrArrayDescriptor(n.charAt(s-1));)s--;if(o-s>1)r=n.substring(s,o);else{for(o=i;o<n.length&&this.isInsideOperator(n.charAt(o));)o++;for(s=i;s>0&&this.isInsideOperator(n.charAt(s-1));)s--;o-s>0&&(r=n.substring(s,o))}return r}widenDeclaration(e,t,i){let n=e.getValueLengthInRange({startColumn:0,startLineNumber:0,endLineNumber:t.lineNumber,endColumn:t.column}),r=e.getValue(),o=n;for(;o<r.length&&this.isInsideIdentifierOrArrayDescriptor(r.charAt(o));)o++;let s=n;for(;s>0&&this.isInsideIdentifierChain(r.charAt(s-1));)s--;return null==(null==i?void 0:i.length)||i.length,o-s>length?r.substring(s,o):i}isInsideIdentifierChain(e){return e.toLocaleLowerCase().match(/[a-z0-9äöüß_\[\]\.]/i)}isInsideOperator(e){return e.toLocaleLowerCase().match(/[!%<>=\+\-\*\/]/i)}isInsideIdentifierOrArrayDescriptor(e){return e.toLocaleLowerCase().match(/[a-z0-9äöüß\[\]]/i)}}Le.keywordDescriptions={print:"Die Anweisung ```print``` gibt eine Zeichenkette aus.",new:'Das Schlüsselwort ```new``` bewirkt die Instanzierung ("Erschaffung") eines neuen Objektes einer Klasse.',println:"Die Anweisung ```println``` gibt eine Zeichenkette gefolgt von einem Zeilenumbruch aus.",while:"```\nwhile (Bedingung) {Anweisungen}\n```  \nbewirkt die Wiederholung der Anweisungen solange ```Bedingung == true``` ist.",for:"```\nfor(Startanweisung;Solange-Bedingung;Nach_jeder_Wiederholung){Anweisungen}\n```  \nführt zunächst die Startanweisung aus und wiederholt dann die Anweisungen solange ```Bedingung == true``` ist. Am Ende jeder wiederholung wird Nach_jeder_Wiederholung ausgeführt.",if:"```\nif(Bedingung){Anweisungen_1} else {Anweisungen_2}\n```  \nwertet die Bedingung aus und führt Anweisungen_1 nur dann aus, wenn die Bedingung ```true``` ergibt, Anweisungen_2 nur dann, wenn die Bedingung ```false``` ergibt.  \nDer ```else```-Teil kann auch weggelassen werden.",else:"```\nif(Bedingung){Anweisungen_1} else {Anweisungen_2}\n```  \nwertet die Bedingung aus und führt Anweisungen_1 nur dann aus, wenn die Bedingung ```true``` ergibt, Anweisungen_2 nur dann, wenn die Bedingung ```false``` ergibt.",switch:"```\nswitch(Selektor){ case Wert_1: Anweisungen_1; break; case Wert_2: Anweisungen_2; break; default: Default-Anweisungen } \n```  \nwertet den Selektor-Term aus und führt abhängig vom Termwert Anweisungen_1, Anweisungen_2, ... aus. Entspricht der Termwert keinem der Werte Wert_1, Wert_2, ..., so werden die Default-Anweisungen ausgeführt.","%":"```\na % b\n```  \n (sprich: 'a modulo b') berechnet den **Rest** der ganzzahligen Division a/b.","==":"```\na == b\n```  \nergibt genau dann ```true```, wenn ```a``` und ```b``` gleich sind.  \nSind a und b **Objekte**, so ergibt ```a == b``` nur dann ```true```, wenn ```a``` und ```b``` auf das **identische** Objekt zeigen.  \n```==``` nennt man **Vergleichsoperator**.","<=":"```\na <= b\n```  \nergibt genau dann ```true```, wenn der Wert von ```a``` kleiner oder gleich dem Wert von ```b``` ist.",">=":"```\na <= b\n```  \nergibt genau dann ```true```, wenn der Wert von ```a``` größer oder gleich dem Wert von ```b``` ist.","!=":"```\na != b\n```  \nergibt genau dann ```true```, wenn ```a``` und ```b``` **un**gleich sind.  \nSind ```a``` und ```b``` **Objekte**, so ergibt ```a != b``` dann ```true```, wenn ```a``` und ```b``` **nicht** auf das **identische** Objekt zeigen.  \n```!=``` nennt man **Ungleich-Operator**.","+=":"```\na += b\n(Kurzschreibweise für a = a + b)\n```  \nbewirkt, dass der Wert von ```a``` um den Wert von ```b``` **erhöht** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","-=":"```\na -= b\n(Kurzschreibweise für a = a - b)\n```  \nbewirkt, dass der Wert von ```a``` um den Wert von ```b``` **erniedrigt** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","*=":"```\na *= b\n(Kurzschreibweise für a = a * b)\n```  \nbewirkt, dass der Wert von ```a``` mit dem Wert von ```b``` **multipliziert** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","/=":"```\na /= b\n(Kurzschreibweise für a = a / b)\n```  \nbewirkt, dass der Wert von ```a``` durch den Wert von ```b``` **dividiert** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","++":"```\na++\n(Kurzschreibweise für a = a + 1)\n```  \nbewirkt, dass der Wert von ```a``` um eins erhöht wird.","--":"```\na--\n(Kurzschreibweise für a = a - 1)\n```  \nbewirkt, dass der Wert von ```a``` um eins eniedrigt wird.","=":"```\na = Term\n```  \nberechnet den Wert des Terms und weist ihn der Variablen ```a``` zu.  \n**Vorsicht:**  \nVerwechsle ```=```(**Zuweisungsoperator**) nicht mit ```==```(**Vergleichsoperator**)!","!":"```\n!a\n```  \nergibt genau dann ```true```, wenn ```a``` ```false``` ergibt.  \n```!``` spricht man '**nicht**'.",public:"```\npublic\n```  \nAttribute und Methoden, die als ```public``` deklariert werden, sind überall (auch außerhalb der Klasse) sichtbar.",private:"```\nprivate\n```  \nAttribute und Methoden, die als ```private``` deklariert werden, sind nur innerhalb von Methoden derselben Klasse sichtbar.",protected:"```\nprotected\n```  \nAttribute und Methoden, die als ```protected``` deklariert werden, sind nur innerhalb von Methoden derselben Klasse oder innerhalb von Methoden von Kindklassen sichtbar.",return:"```\nreturn Term\n```  \nbewirkt, dass die Methode verlassen wird und der Wert des Terms an die aufrufende Stelle zurückgegeben wird.",break:"```\nbreak;\n```  \ninnerhalb einer Schleife bewirkt, dass die Schleife sofort verlassen und mit den Anweisungen nach der Schleife fortgefahren wird.  \n```break``` innerhalb einer ```switch```-Anweisung bewirkt, dass der Block der ```switch```-Anweisung verlassen wird.",class:"```\nclass\n```  \nMit dem Schlüsselwort ```class``` werden Klassen definiert.",extends:"```\nextends\n```  \n```class A extends B { ... }``` bedeutet, dass die Klasse A Unterklasse der Klasse B ist.",implements:"```\nimplements\n```  \n```class A implements B { ... }``` bedeutet, dass die Klasse A das Interface B implementiert, d.h., dass sie alle Methoden besitzen muss, die in B definiert sind.",this:"```\nthis\n```  \nInnerhalb einer Methodendefinition bezeichnet das Schlüsselwor ```this``` immer dasjenige Objekt, für das die Methode gerade ausgeführt wird."};class Pe{constructor(e){this.main=e}provideCodeActions(e,t,i,n){return{actions:i.markers.map((t=>{let i=t.relatedInformation;return null==i?null:{title:i.title,diagnostics:[t],kind:"quickfix",edit:{edits:i.editsProvider(e.uri)},isPreferred:!0}})),dispose:()=>{}}}}class Me{constructor(e){this.main=e}provideReferences(e,t,i,n){let r=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(null==r)return null;let o=r.getElementAtPosition(t.lineNumber,t.column);if(null==o)return;let s=o.usagePositions,a=[];return s.forEach(((e,t)=>{if(null!=e)for(let i of e)a.push({uri:t.uri,range:{startColumn:i.column,startLineNumber:i.line,endLineNumber:i.line,endColumn:i.column+i.length}})})),a}}class Ie{static openHelper(e,t,i){let n=jQuery(".jo_arrow_box");n.removeClass(["jo_arrow_box_left","jo_arrow_box_right","jo_arrow_box_top","jo_arrow_box_bottom"]),n.addClass("jo_arrow_box_"+i),n.css({left:"",right:"",top:"",bottom:""});let r=t.offset(),o=jQuery("body"),s=34;switch(i){case"bottom":n.css({left:r.left+t.width()/2-s,bottom:o.height()-r.top+s});break;case"top":n.css({left:r.left+t.width()/2-s,top:r.top+t.height()+26});break;case"left":n.css({left:r.left+t.width()+s,top:r.top+t.height()/2-s});break;case"right":n.css({right:o.width()-r.left,top:r.top+t.height()/2-s})}n.find("span").html(e);let a=n.find(".jo_button");a.on("click",(e=>{e.stopPropagation(),a.off("click"),Ie.close()})),n.fadeIn(800)}static close(){jQuery(".jo_arrow_box").fadeOut(800)}static showHelper(e,t,i){let n;if(!(t instanceof lt))return;n=t;let r=n.user.settings.helperHistory,o=e+"Done";if(null!=r&&(null==r[o]||!r[o])){r[o]=!0,n.networkManager.sendUpdateUserSettings((()=>{}));let t="",s="left";switch(e){case"newDatabaseHelper":t="Es gibt noch keine Datenbank. <br> Nutzen Sie den Button\n                        <span class='img_add-database-dark jo_inline-image'></span> um eine Datenbank anzulegen.\n                        ",s="left";break;case"newSQLFileHelper":t="Es gibt noch keine Datei mit SQL-Anweisungen. <br> Nutzen Sie den Button \n                            <span class='img_add-file-dark jo_inline-image'></span> um eine neue Datei anzulegen.\n                            ",s="left";break;case"homeButtonHelper":t="Mit dem Home-Button <span class='img_home-dark jo_inline-image'></span> können Sie wieder zu Ihren eigenen Workspaces wechseln.",s="top",i=jQuery(".img_home-dark");break;case"playButtonHelper":t="Mit dem \"Start-Button\"\n                        (<span class='img_start-dark jo_inline-image'></span>) \n                        oder der Tastenkombination &lt;Strg&gt;&nbsp;+&nbsp&lt;Enter&gt; \n                        wird die Anweisung ausgeführt, in der der Cursor gerade steht. \n                        <br> Wollen Sie mehrere Anweisungen hintereinander ausführen, so markieren \n                        Sie alle Anweisungen und klicken Sie dann auf <span class='img_start-dark jo_inline-image'></span>\n                        oder drücken Sie  &lt;Strg&gt;&nbsp;+&nbsp&lt;Enter&gt;. ",s="top";break;case"consoleHelper":t="\n                        Hier können Sie Anweisungen oder Terme eingeben, die nach Bestätigung mit der Enter-Taste ausgeführt/ausgewertet werden. Das Ergebnis sehen Sie im Bereich über der Eingabezeile. <br>\n                        Falls das Programm gerade pausiert (z.B. bei Ausführung in Einzelschritten) können Sie auch auf die Variablen des aktuellen Sichtbarkeitsbereiches zugreifen.\n                    ",s="bottom"}""!=t&&null!=i&&i.length>0&&Ie.openHelper(t,i,s)}}}class Oe{constructor(e,t,i){this.main=e,this.showMinimap=t,this.isEmbedded=i,this.cw=null,this.dontPushNextCursorMove=0,this.lastTime=0,this.elementDecoration=[]}initGUI(e){!function(){monaco.languages.register({id:"vscSQL",extensions:[".sql"]});let e={onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:monaco.languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:monaco.languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ \ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:monaco.languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:monaco.languages.IndentAction.None,removeText:1}},{beforeText:/^(\t|(\ \ ))*\ \*[^/]*\*\/\s*$/,action:{indentAction:monaco.languages.IndentAction.None,removeText:1}}],comments:{lineComment:"--",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]};monaco.languages.setLanguageConfiguration("vscSQL",e),monaco.languages.setMonarchTokensProvider("vscSQL",{defaultToken:"",tokenPostfix:".sql",ignoreCase:!0,brackets:[{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"}],escapes:/\\(?:[abfnrtv\\"'])/,keywords:["ABORT","ACTION","ADD","AFTER","ALL","ALTER","ANALYZE","AND","AS","ASC","ATTACH","AUTOINCREMENT","BEFORE","BEGIN","BETWEEN","BY","CASCADE","CASE","CAST","CHECK","COLLATE","COLUMN","COMMIT","CONFLICT","CONSTRAINT","CREATE","CROSS","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","DATABASE","DEFAULT","DEFERRABLE","DEFERRED","DELETE","DESC","DETACH","DISTINCT","DROP","EACH","ELSE","END","ESCAPE","EXCEPT","EXCLUSIVE","EXISTS","EXPLAIN","FAIL","FOR","FOREIGN","FROM","FULL","GLOB","GROUP","HAVING","IF","IGNORE","IMMEDIATE","IN","INDEX","INDEXED","INITIALLY","INNER","INSERT","INSTEAD","INTERSECT","INTO","IS","ISNULL","JOIN","KEY","LEFT","LIKE","LIMIT","MATCH","NATURAL","NO","NOT","NOTNULL","NULL","OF","OFFSET","ON","OR","ORDER","OUTER","PLAN","PRAGMA","PRIMARY","QUERY","RAISE","RECURSIVE","REFERENCES","REGEXP","REINDEX","RELEASE","RENAME","REPLACE","RESTRICT","RIGHT","ROLLBACK","ROW","SAVEPOINT","SELECT","SET","TABLE","TEMP","TEMPORARY","THEN","TO","TRANSACTION","TRIGGER","UNION","UNIQUE","UPDATE","USING","VACUUM","VALUES","VIEW","VIRTUAL","WHEN","WHERE","WITH","WITHOUT","ENGINE","CHARSET"],operators:["AND","BETWEEN","IN","LIKE","NOT","OR","IS","NULL","INTERSECT","UNION","INNER","JOIN","LEFT","OUTER","RIGHT"],builtinFunctions:["abs","changes","char","coalesce","count","glob","hex","ifnull","iif","instr","last_insert_rowid","length","like","likelihood","likely","lower","ltrim","max","min","nullif","quote","random","randomblob","replace","round","rtrim","sign","soundex","sqlite_version","substr","substring","total_changes","trim","typeof","unicode","unlikely","upper","zeroblob"],builtinVariables:[],pseudoColumns:[],tokenizer:{root:[{include:"@comments"},{include:"@whitespace"},{include:"@pseudoColumns"},{include:"@numbers"},{include:"@strings"},{include:"@complexIdentifiers"},{include:"@scopes"},[/[;,.]/,"delimiter"],[/[()]/,"@brackets"],[/[a-z_$äöü][\w$äöüßÄÖÜ]*(?=\()/,{cases:{"@builtinFunctions":"functions","@keywords":"keyword","@default":"identifier"}}],[/[\w@#$]+/,{cases:{"@keywords":"keyword","@operators":"operator","@builtinVariables":"predefined","@default":"identifier"}}],[/[<>=!%&+\-*/|~^]/,"operator"]],whitespace:[[/\s+/,"white"]],comments:[[/--+.*/,"comment"],[/\/\*/,{token:"comment.quote",next:"@comment"}]],comment:[[/[^*/]+/,"comment"],[/\*\//,{token:"comment.quote",next:"@pop"}],[/./,"comment"]],pseudoColumns:[[/[$][A-Za-z_][\w@#$]*/,{cases:{"@pseudoColumns":"predefined","@default":"identifier"}}]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],strings:[[/'/,{token:"string",next:"@string"}]],string:[[/[^\\']+/,"string"],[/\\./,"string.escape.invalid"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],complexIdentifiers:[[/"/,{token:"identifier.quote",next:"@quotedIdentifier"}]],quotedIdentifier:[[/[^"]+/,"identifier"],[/""/,"identifier"],[/"/,{token:"identifier.quote",next:"@pop"}]],scopes:[]}})}(),monaco.editor.defineTheme("myCustomThemeDark",{base:"vs-dark",inherit:!0,rules:[{token:"functions",foreground:"dcdcaa",fontStyle:"italic"},{token:"string.sql",foreground:"3DC9B0"},{token:"number",foreground:"7bef3f"},{token:"type",foreground:"499cd6"},{token:"identifier",foreground:"effefe"},{token:"statement",foreground:"9cdcfe",fontStyle:"bold"},{token:"keyword",foreground:"619ceb",fontStyle:"bold"},{token:"table",foreground:"ff0000",fontStyle:"bold"},{token:"delimiter",foreground:"e8eb38"}],colors:{"editor.background":"#1e1e1e",jo_highlightStatementGreen:"#004000",jo_highlightStatementYellow:"#404000",jo_highlightStatementRed:"#402020"}}),monaco.editor.defineTheme("myCustomThemeLight",{base:"vs",inherit:!0,rules:[{token:"functions",foreground:"694E16",fontStyle:"italic bold"},{token:"string.sql",foreground:"a03030"},{token:"number",foreground:"404040"},{token:"type",foreground:"0000ff",fontStyle:"bold"},{token:"identifier",foreground:"8000e0"},{token:"statement",foreground:"001080",fontStyle:"bold"},{token:"keyword",foreground:"00a000",fontStyle:"bold"},{token:"comment",foreground:"808080",fontStyle:"italic"}],colors:{"editor.background":"#FFFFFF","editor.foreground":"#000000","editor.inactiveSelectionBackground":"#E5EBF1","editorIndentGuide.background":"#D3D3D3","editorIndentGuide.activeBackground":"#939393","editor.selectionHighlightBackground":"#ADD6FF80","editorSuggestWidget.background":"#F3F3F3","activityBarBadge.background":"#007ACC","sideBarTitle.foreground":"#6F6F6F","list.hoverBackground":"#E8E8E8","input.placeholderForeground":"#767676","searchEditor.textInputBorder":"#CECECE","settings.textInputBorder":"#CECECE","settings.numberInputBorder":"#CECECE","statusBarItem.remoteForeground":"#FFF","statusBarItem.remoteBackground":"#16825D",jo_highlightStatementGreen:"#004000",jo_highlightStatementYellow:"#404000",jo_highlightStatementRed:"#400000"}}),this.editor=monaco.editor.create(e[0],{language:"vscSQL",lightbulb:{enabled:!0},lineDecorationsWidth:0,peekWidgetDefaultFocus:"tree",fixedOverflowWidgets:!0,quickSuggestions:!0,quickSuggestionsDelay:10,fontSize:14,fontFamily:"Consolas, Roboto Mono",fontWeight:"500",roundedSelection:!0,selectOnLineNumbers:!1,automaticLayout:!0,scrollBeyondLastLine:!1,occurrencesHighlight:!1,autoIndent:"full",dragAndDrop:!0,formatOnType:!0,formatOnPaste:!0,suggestFontSize:16,suggestLineHeight:22,suggest:{localityBonus:!0,insertMode:"replace"},parameterHints:{enabled:!0,cycle:!0},mouseWheelZoom:this.isEmbedded,minimap:{enabled:this.showMinimap},scrollbar:{vertical:"auto",horizontal:"auto"},theme:"myCustomThemeDark"});let t=this,i=e=>{!0===e.ctrlKey&&(t.changeEditorFontSize(Math.sign(e.deltaY),!0),e.preventDefault())};return this.editor.onDidChangeConfiguration((e=>{e.hasChanged(monaco.editor.EditorOption.fontInfo)&&this.isEmbedded&&this.main.getBottomDiv().errorManager.registerLightbulbOnClickFunctions()})),this.editor.onDidChangeCursorPosition((e=>{t.onDidChangeCursorPosition(e.position)})),this.editor.onDidChangeModel((t=>{let n=e.find(".monaco-editor")[0];if(n.removeEventListener("wheel",i),n.addEventListener("wheel",i,{passive:!1}),null==this.main.getCurrentWorkspace())return;let r=this.main.getCurrentWorkspace().getModuleByMonacoModel(this.editor.getModel());this.main instanceof lt&&null!=r&&this.main.projectExplorer.setActiveAfterExternalModelSet(r)})),monaco.languages.registerHoverProvider("vscSQL",new Le(this)),monaco.languages.registerCompletionItemProvider("vscSQL",new je(this.main)),monaco.languages.registerCodeActionProvider("vscSQL",new Pe(this.main)),monaco.languages.registerReferenceProvider("vscSQL",new Me(this.main)),monaco.languages.registerSignatureHelpProvider("vscSQL",new De(this.main)),this.editor.onMouseDown((e=>{const i=e.target.detail;e.target.type!==monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN&&e.target.type!==monaco.editor.MouseTargetType.GUTTER_LINE_NUMBERS||i.isAfterLines||t.onMarginMouseDown(e.target.position.lineNumber)})),setTimeout((()=>{monaco.editor.remeasureFonts()}),2e3),this.addActions(),this.editor.onDidType((e=>{t.onDidType(e)})),this.editor}onDidType(e){const t=(e,t,i,n)=>{const r=new monaco.Range(e.lineNumber,e.column,e.lineNumber,e.column);this.editor.executeEdits("new-bullets",[{range:r,text:t}]),this.editor.setPosition({lineNumber:i,column:n})};if("\n"===e){const e=this.editor.getModel(),i=this.editor.getPosition(),n=e.getLineContent(i.lineNumber-1);if(0===n.trim().indexOf("/*")&&!n.trimRight().endsWith("*/")&&!(i.lineNumber<e.getLineCount()?e.getLineContent(i.lineNumber+1):"").trim().startsWith("*")){let e=n.substr(0,n.length-n.trimLeft().length);0===n.trim().indexOf("/**")?t(i,"\n"+e+" */",i.lineNumber,i.column+3+e.length):t(i," * \n"+e+" */",i.lineNumber,i.column+3+e.length)}}}setFontSize(e){let t=(new Date).getTime();if(t-this.lastTime<150)return;this.lastTime=t;let i=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize);if(this.main instanceof lt&&this.main.viewModeController.saveFontSize(e),e!=i){this.editor.updateOptions({fontSize:e});let t=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize)/e;this.editor.updateOptions({fontSize:e/t})}jQuery(".jo_editorFontSize").css("font-size",e+"px"),jQuery(".jo_editorFontSize").css("line-height",e+2+"px"),document.documentElement.style.setProperty("--breakpoint-size",e+"px"),document.documentElement.style.setProperty("--breakpoint-radius",e/2+"px"),this.main.getBottomDiv().errorManager.registerLightbulbOnClickFunctions()}changeEditorFontSize(e,t=!0){let i=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize);t&&(e*=i<10?1:i<20?2:4);let n=i+e;n>=6&&n<=80&&this.setFontSize(n)}addActions(){let e=this;this.editor.addAction({id:"Find bracket",label:"Finde korrespondierende Klammer",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_K],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(e){return e.getAction("editor.action.jumpToBracket").run(),null}}),this.editor.addAction({id:"Execute statement",label:"SQL-Anweisung ausführen",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1,run:function(t){return e.main.getActionManager().trigger("execute"),null}})}onMarginMouseDown(e){}onDidChangeCursorPosition(e){null==e&&(e=this.editor.getPosition());let t=this.getCurrentlyEditedModule();if(null==t)return void(this.elementDecoration=this.editor.deltaDecorations(this.elementDecoration,[]));let i=t.getElementAtPosition(e.lineNumber,e.column),n=[];if(null!=i){let e=i.usagePositions.get(t);if(null!=e)for(let t of e)n.push({range:{startColumn:t.column,startLineNumber:t.line,endColumn:t.column+t.length,endLineNumber:t.line},options:{className:"jo_revealSyntaxElement",isWholeLine:!1,overviewRuler:{color:{id:"editorIndentGuide.background"},darkColor:{id:"editorIndentGuide.activeBackground"},position:monaco.editor.OverviewRulerLane.Left}}})}let r=!1;for(let e of t.getSQLSTatementsAtSelection(this.editor.getSelection())){let t="jo_highlightStatementGreen";null!=e&&(e.hasErrors?(t="jo_highlightStatementRed",e.acceptedBySQLite&&(t="jo_highlightStatementYellow",r=!0)):r=!0,n.push({range:{startColumn:e.from.column,startLineNumber:e.from.line,endColumn:e.to.column,endLineNumber:e.to.line},options:{className:t,isWholeLine:!1,overviewRuler:{color:{id:t},darkColor:{id:t},position:monaco.editor.OverviewRulerLane.Left},minimap:{color:{id:t},position:monaco.editor.MinimapPosition.Inline},zIndex:-100}}))}this.main.getActionManager().setActive("execute",r),r&&!this.main.isEmbedded()&&Ie.showHelper("playButtonHelper",this.main,jQuery("div.img_start-dark")),this.elementDecoration=this.editor.deltaDecorations(this.elementDecoration,n)}getCurrentlyEditedModule(){return this.main.getCurrentlyEditedModule()}}class Be{constructor(){this.initsql=initSqlJs({locateFile:(e,t)=>"https://embed.learn-sql.de/include/lib/sql.js/sql-wasm.wasm"})}postMessageToClient(e){this.onmessage({data:e})}postMessage(e){let t=this;null==t.db?t.initsql.then((i=>{t.SQL=i,t.db=createDb(i,void 0),t.worker(e)})).catch((e=>(console.log(e),t.postMessageToClient({id:this.data.id,error:e.message})))):t.worker(e)}terminate(){}worker(e){var t,i,n=e.config?e.config:{};try{switch(e&&e.action){case"open":return t=e.buffer,this.db=createDb(this.SQL,t&&new Uint8Array(t)),this.postMessageToClient({id:e.id,ready:!0});case"exec":if(null===this.db&&(this.db=createDb(this.SQL,void 0)),!e.sql)throw"exec: Missing query string";return this.postMessageToClient({id:e.id,results:this.db.exec(e.sql,e.params,n)});case"each":return null===this.db&&(this.db=createDb(this.SQL,void 0)),this.db.each(e.sql,e.params,(function(t){return this.postMessage({id:e.id,row:t,finished:!1})}),(function(){return this.postMessage({id:e.id,finished:!0})}),n);case"export":t=this.db.export(),i={id:e.id,results:[{buffer:t}]};try{return this.postMessageToClient(i)}catch(e){return this.postMessageToClient(i)}case"close":return this.db&&this.db.close(),this.postMessageToClient({id:e.id});default:throw new Error("Invalid action : "+(e&&e.action))}}catch(t){return this.postMessageToClient({id:e.id,error:t.message})}}}class $e{constructor(e){this.main=e,this.databaseDirectoryEntries=null,this.queryId=0,this.querySuccessCallbacksMap=new Map,this.queryErrorCallbackMap=new Map}initializeWorker(e,t,i,n){this.main.getWaitOverlay().show("Bitte warten, die Datenbank wird initialisiert..."),null!=this.worker&&this.worker.terminate(),performance.now();let r="js/sqljs-worker/sqljsWorker.js";this.main.isEmbedded()&&(r=window.javaOnlineDir+r),window.jo_doc?this.worker=new Be:this.worker=new Worker(r);let o=this,s=[];this.worker.onmessage=()=>{o.worker.onmessage=e=>{let t=e.data.id;if(null==e.data.error){let i=o.querySuccessCallbacksMap.get(t);null!=i&&i(e.data.results)}else{let i=o.queryErrorCallbackMap.get(t);null!=i&&i(e.data.error)}this.queryErrorCallbackMap.delete(t),this.querySuccessCallbacksMap.delete(t)},null==t&&(t=[]),(t=t.slice()).unshift("PRAGMA foreign_keys = OFF;"),t.push("PRAGMA foreign_keys = ON;");let e=t.length,r=()=>{if(t.length>0){this.main.getWaitOverlay().setProgress(Math.round(100*(1-t.length/e))+" %");let i=t.shift();o.executeQuery(i,(e=>{r()}),(e=>{s.push("Error while setting up database: "+e+", query: "+i),console.log({error:"Error while setting up database: "+e,query:i}),console.log(),r()}))}else null!=i&&i(s),o.retrieveDatabaseStructure((()=>{n&&n(),this.main.getWaitOverlay().hide()}))};r()},this.worker.onerror=e=>{s.push("Worker error: "+e.error),console.log("Worker error: "+e.error)},this.worker.postMessage({id:o.queryId++,action:"open",buffer:e})}executeQuery(e,t,i){let n=this.queryId++;this.querySuccessCallbacksMap.set(n,t),this.queryErrorCallbackMap.set(n,i),this.worker.postMessage({id:n,action:"exec",sql:e,params:{}})}export(e,t){let i=this.queryId++;this.querySuccessCallbacksMap.set(i,(t=>{e(t[0].buffer)})),this.queryErrorCallbackMap.set(i,t),this.worker.postMessage({id:i,action:"export",params:{}})}getDirectoryEntries(e){null!=this.databaseDirectoryEntries?e(this.databaseDirectoryEntries):jQuery.getJSON("assets/databases/directory.json",(function(t){e(t)}))}retrieveDatabaseStructure(e){let t=this;this.executeQuery("SELECT name, sql FROM sqlite_master WHERE type='table';",(i=>{var n,r;let o="";null===(r=null===(n=i[0])||void 0===n?void 0:n.values)||void 0===r||r.forEach((e=>o+=`PRAGMA table_info(${e[0]});\nPRAGMA foreign_key_list(${e[0]});\nselect count(*) from ${e[0]};\n\n`)),""!=o?this.executeQuery(o,(n=>{t.databaseStructure=t.parseDatabaseStructure(i,n),e(t.databaseStructure)}),(e=>{console.log(e)})):(t.databaseStructure={tables:[]},e(t.databaseStructure))}),(e=>{console.log(e)}))}parseDatabaseStructure(e,t){this.databaseStructure={tables:[]};let i=new Map,n=0;for(let r=0;r<e[0].values.length;r++){let o=e[0].values[r][0],s=e[0].values[r][1],a={name:o,size:0,completeSQL:s,columns:[]};i.set(o,a),this.databaseStructure.tables.push(a);let l=t[n].values,d=null;t.length>n+1&&"id"==t[n+1].columns[0]&&(d=t[n+1].values,n++),n++;let u=t[n].values[0][0];n++,a.size=u,l.forEach((e=>{e[0];let t=e[1],i=e[2],n=1==e[3],r=e[4],o=0!=e[5],l={name:t,isPrimaryKey:o,isAutoIncrement:o&&s.toLowerCase().indexOf("autoincrement")>=0,completeTypeSQL:i,table:a,typeLengths:[],defaultValue:r,notNull:n};if(null!=d){let e=d.find((e=>e[3].toLocaleLowerCase()==t.toLocaleLowerCase()));null!=e&&(l.referencesRawData=e)}a.columns.push(l)}))}for(let e of this.databaseStructure.tables)for(let t of e.columns)if(null!=t.referencesRawData){let e=i.get(t.referencesRawData[2]);if(null==e)continue;let n=e.columns.find((e=>e.name.toLocaleLowerCase()==t.referencesRawData[4].toLocaleLowerCase()));t.references=n}return this.databaseStructure}static getDumpType(e){let t=[83,81,76,105,116,101],i=!0;for(let n=0;n<t.length;n++)if(t[n]!=e[n]){i=!1;break}return i?"binaryUncompressed":120==e[0]?"binaryCompressed":"other"}}class Ae{constructor(){this.MaxRowsPerInsert=300}clean(t){switch(t.ast.type){case e.keywordCreate:return t.sqlCleaned=this.cleanCreateTableStatement(t.ast),t.sqlCleaned;case e.keywordInsert:return null!=t.ast.select?t.sql:(t.sqlCleaned=this.cleanInsertStatement(t.ast),t.sqlCleaned);default:return t.sql}}cleanInsertStatement(e){let t=`insert into ${e.table.identifier}`;null!=e.columnList&&e.columnList.length>0&&(t+=`(${e.columnList.map((e=>this.escapeIdentifier(e.identifier))).join(", ")})`),t+="\nvalues\n";let i="",n=[];if(null!=e.values&&e.values.length>0)for(let t of e.values)n.push(`\n(${t.map((e=>this.cleanValue(e))).join(", ")})`);for(;n.length>0;)i+=t,i+=n.splice(0,Math.max(this.MaxRowsPerInsert,n.length)).join(",\n"),i+=";\n";return i}cleanValue(t){if(t.constantType==e.stringConstant){let e=t.constant;return e=e.replace(/'/g,"''"),`'${e}'`}return t.constant}cleanCreateTableStatement(e){let t=`create table ${e.ifNotExists?" if not exists":""} ${this.escapeIdentifier(e.identifier)}(\n   `;t+=e.columnList.map((e=>this.cleanColumnDef(e))).join(",\n   "),null!=e.foreignKeyInfoList&&e.foreignKeyInfoList.length>0&&(t+=",\n   "+e.foreignKeyInfoList.map((e=>this.cleanForeignKeyInfo(e))).join(",\n   "));let i=e.combinedPrimaryKeyColumns.slice().map((e=>e.toLocaleLowerCase()));for(let t of e.columnList){let e=t.identifier.toLocaleLowerCase();t.isAutoIncrement&&i.indexOf(e)>=0&&i.splice(i.indexOf(e),1)}return i.length>0&&(t+=`,\n   primary key(${this.escapeIdentifiers(i).join(", ")})`),e.uniqueConstraints.length>0&&(t+=",\n   "+e.uniqueConstraints.map((e=>"unique("+this.escapeIdentifiers(e).join(", ")+")")).join(",\n   ")),t+="\n);",t}cleanForeignKeyInfo(e){let t=`foreign key (${this.escapeIdentifier(e.column)}) references ${this.escapeIdentifier(e.referencesTable)}(${this.escapeIdentifier(e.referencesColumn)})`;return e.onDelete&&(t+=" on delete "+e.onDelete),e.onUpdate&&(t+=" on update "+e.onUpdate),t}cleanColumnDef(e){let t=e.baseType.toString();"int"==t&&e.isAutoIncrement&&(t="integer");let i=`${this.escapeIdentifier(e.identifier)} ${t}`;if(null!=e.parameters&&e.parameters.length>0&&!e.isAutoIncrement&&(i+=`(${e.parameters.join(", ")})`),e.notNull&&(i+=" not null"),null!=e.defaultValue&&(i+=" default "+e.defaultValue),(e.isPrimary||e.isAutoIncrement)&&(i+=" primary key"),e.isAutoIncrement&&(i+=" autoincrement"),null!=e.foreignKeyInfo){let t=e.foreignKeyInfo,n=t.referencesColumn;t.referencesTable&&(n=this.escapeIdentifier(t.referencesTable)+"("+this.escapeIdentifier(n)+")"),i+=" references "+n}if(null!=e.collate){let t=e.collate.toLocaleLowerCase();["binary","nocase","rtrim"].indexOf(t)>=0&&(i+=" collate "+t)}let n=e.parameters?e.parameters:[0,0],r=e.baseType.checkFunction(this.escapeIdentifier(e.identifier),n);return""!=r&&(i+=" "+r),i}escapeIdentifier(e){return'"'+e+'"'}escapeIdentifiers(e){return e.map(this.escapeIdentifier)}}var Ne=function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};class Fe{constructor(e){this.main=e}loadFromUrl(e){return Ne(this,void 0,void 0,(function*(){if(null==e)return;let t=null;return t=e.endsWith(".zip")?yield this.unzipURL(e):yield(yield fetch(e)).text(),this.importFromText(t)}))}loadFromFile(e){return Ne(this,void 0,void 0,(function*(){if(null!=e){if(e.name.endsWith(".zip")){let t=yield this.unzipFile(e);return this.importFromText(t)}return new Promise(((t,i)=>{var n=new FileReader;n.onload=e=>{let i=e.target.result;t(this.importFromText(i))},n.readAsText(e)}))}}))}unzipURL(e){return Ne(this,void 0,void 0,(function*(){const t=new zip.ZipReader(new zip.HttpReader(e));return this.unzipIntern(t)}))}unzipFile(e){return Ne(this,void 0,void 0,(function*(){const t=new zip.ZipReader(new zip.BlobReader(e));return this.unzipIntern(t)}))}unzipIntern(e){return Ne(this,void 0,void 0,(function*(){let t=yield e.getEntries();t=t.filter((e=>e.filename.endsWith(".sql")));let i="";if(t.length)for(let e of t)i+=(yield e.getData(new zip.TextWriter,{onprogress:(e,t)=>{}}));return yield e.close(),i}))}importFromText(t){return Ne(this,void 0,void 0,(function*(){if(null==t)return null;let i=(new a).lex(t),n=new V,r=new le({dirty:!1,name:"",saved:!0,student_edited_after_revision:!1,submitted_date:null,text:t,text_before_revision:null,version:0},this.main);r.tokenList=i.tokens,n.parse(r),this.createTableNodes=r.sqlStatements.filter((t=>t.ast.type==e.keywordCreate)).map((e=>e.ast)),this.insertNodes=r.sqlStatements.filter((t=>t.ast.type==e.keywordInsert)).map((e=>e.ast)),this.tableModifyingNodes=r.sqlStatements.filter((t=>t.ast.type==e.keywordAlter&&"omittedKind"==t.ast.kind)).map((e=>e.ast));for(let t of this.tableModifyingNodes){let i=this.findCreateTableNode(t.tableIdentifier);if(null!=i){if(null!=t.primaryKeys&&(i.combinedPrimaryKeyColumns=t.primaryKeys,i.columnList.forEach((e=>e.isPrimary=!1))),null!=t.autoIncrementColumn){let e=this.findCreateTableColumnNode(i,t.autoIncrementColumn);null!=e&&(e.isPrimary=!0)}if(null!=t.modifyColumnInfo)for(let e of t.modifyColumnInfo){let t=this.findCreateTableColumnNode(i,e.identifier),n=i.columnList.indexOf(t);i.columnList.splice(n,1,e)}if(null!=t.foreignKeys)for(let e of t.foreignKeys)i.foreignKeyInfoList.push(e);if(null!=t.indices)for(let i of t.indices)r.sqlStatements.push({acceptedBySQLite:!0,from:null,to:null,hasErrors:!1,ast:{type:e.keywordIndex,columnIdentifier:i.column,indexIdentifier:i.index_name,tableIdentifier:t.tableIdentifier,unique:i.unique,position:null,endPosition:null,symbolTable:null},sql:`create ${i.unique?"unique ":""} index ${i.index_name} on ${t.tableIdentifier}(${i.column});`})}}return this.makeDatabase(r.sqlStatements)}))}findCreateTableNode(e){return e=e.toLocaleLowerCase(),this.createTableNodes.find((t=>t.identifier.toLocaleLowerCase()==e))}findCreateTableColumnNode(e,t){return t=t.toLocaleLowerCase(),e.columnList.find((e=>e.identifier.toLocaleLowerCase()==t))}makeDatabase(t){return Ne(this,void 0,void 0,(function*(){let i=new Ae,n=t.filter((t=>t.ast.type!=e.omittedeStatement)).map((e=>i.clean(e)));n.unshift("PRAGMA foreign_keys = OFF;"),n.push("PRAGMA foreign_keys = ON;");let r=new $e(this.main);return new Promise(((e,t)=>{r.initializeWorker(null,n,(()=>{r.export((t=>{e({binDump:t})}),(e=>{t(e)}))}))}))}))}}class Qe{loadFromFile(e,t){return i=this,n=void 0,o=function*(){if(null!=e){if(t.getWaitOverlay().show("Lese Datei ein..."),e.name.endsWith(".sql")||e.name.endsWith(".zip")){let i=yield new Fe(t).loadFromFile(e);return t.getWaitOverlay().hide(),i}var i=new FileReader;return new Promise(((n,r)=>{i.onload=e=>{let i=e.target.result,r=new Uint8Array(i);"binaryCompressed"==$e.getDumpType(r)&&(r=pako.inflate(r)),t.getWaitOverlay().hide(),n({binDump:r})},i.readAsArrayBuffer(e)}))}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(s,a)}l((o=o.apply(i,n||[])).next())}));var i,n,r,o}saveToFile(e){e.export((e=>{let t=prompt("Bitte geben Sie den Dateinamen ein","datenbank.sqLite");null!=t?(t.endsWith(".sqLite")||(t+=".sqLite"),function(e,t,i=!1){var n=i?e:new Blob([JSON.stringify(e)],{type:"text/plain"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,t);else{var r=document.createEvent("MouseEvents"),o=document.createElement("a");o.download=t,o.href=window.URL.createObjectURL(n),o.dataset.downloadurl=["text/plain",o.download,o.href].join(":"),r.initEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(r),o.remove()}}(new Blob([e.buffer]),t,!0)):alert("Der Dateiname ist leer, daher wird nichts gespeichert.")}),(()=>{}))}}class Re{constructor(e,t,i){this.main=e,this.owner_id=t,this.path=i,this.init()}init(){this.$dialog=jQuery("#dialog"),jQuery("#main").css("visibility","hidden"),this.$dialog.append(jQuery('<div class="jo_ds_heading">Neue Datenbank anlegen</div>\n\n            <div class="jo_ds_settings">\n               <div class="jo_ds_settings_caption">Name der Datenbank:</div><div><input class="dialog-input jo_databasename" value="Neue Datenbank"></input></div>\n            </div>\n\n             <div class="jo_tabheadings jo_cdtabheading">\n             <div class="jo_tabheading" data-target="jo_createEmptyDatabaseTab">Leere Datenbank</div>\n             <div class="jo_tabheading jo_active" data-target="jo_createDatabaseFromTemplateTab">Von Vorlage kopieren</div>\n             <div class="jo_tabheading" data-target="jo_createDatabaseUseExistingTab">Bestehende Datenbank mitnutzen</div>\n             <div class="jo_tabheading" data-target="jo_createDatabaseUseDumpFile">Import aus Dumpfile (SQLite- oder MySQL-Format)</div>\n             </div>\n             <div class="jo_tabs" style="width: 100%; margin-top: 10px">\n                 <div class="jo_createEmptyDatabaseTab">\n                    <div class="jo_createDatabaseDescription">\n                        Erstellt wird eine leere Datenbank.\n                    </div>\n                 </div>\n                 <div class="jo_createDatabaseFromTemplateTab jo_active">\n                    <div class="jo_ds_settings">\n                       <div class="jo_ds_settings_caption">Vorlage suchen:</div><div><input class="dialog-input jo_templatename"></input></div>\n                    </div>\n                    <div class="jo_scrollable jo_templatelist"></div>\n                 </div>\n                <div class="jo_createDatabaseUseExistingTab">\n                    <div class="jo_createDatabaseDescription">Wenn Du die Datenbank einer anderen Nutzerin/eines anderen Nutzers mitnutzen möchtest, brauchst Du einen Zugriffscode von ihr/ihm. Er ist unter Datenbank->Einstellungen zu finden.            \n                    </div>\n                    <div class="jo_ds_settings">\n                       <div class="jo_ds_settings_caption">Zugriffscode:</div><div><input class="dialog-input jo_databasecodeinput"></input></div>\n                    </div>\n                 </div>\n                <div class="jo_createDatabaseUseDumpFile">\n                    <div class="jo_createDatabaseDescription">Wähle hier die Datei mit dem Datenbank-Dump aus (Endung .sqLite (SQLite-Datenbankdatei) oder .zip (gepackter MySql-Dump) oder .sql (MySql-Dump)):</div>\n                    <input type="file" class="jo_dumpfile" name="dumpfile" style="padding: 10px"/>\n                    <div class="jo_databaseimport_dropzone" style="width: 70vw; margin-left: 10px">Alternativ: Datei in dieses Feld ziehen</div>\n                    <div class="jo_databaseimport_ok"></div>\n                 </div>\n             </div>\n\n             <div class="dialog-buttonRow jo_ds_buttonRow">\n                <button id="jo_ds_cancel_button">Abbrechen</button>\n                <button id="jo_ds_create_database_button">Datenbank anlegen</button>\n             </div>\n            ')),me(this.$dialog);let e=jQuery(".jo_templatelist");this.main.networkManager.fetchTemplateList((t=>{t.forEach((t=>{let i=jQuery('<div class="jo_templateListEntry"></div>');i.append(jQuery(`<div class="jo_tle_firstline">${t.name} <span class="jo_tle_ownername"> (von ${t.ownerName})</span></div>`)),i.append(jQuery(`<div class="jo_tle_secondline">${t.description}</div>`)),i.data("templateId",t.id),i.data("name",t.name),e.append(i),t.$tle=i,i.on("pointerdown",(()=>{e.find(".jo_templateListEntry").removeClass("jo_active"),i.addClass("jo_active")}))}));let i=jQuery(".jo_templatename");i.on("input",(()=>{let n=i.val();e.find(".jo_templateListEntry").hide(),t.forEach((e=>{(e.name+e.ownerName+(e.description?e.description:"")).indexOf(n)>=0&&e.$tle.show()}))}))}));let t=jQuery(".jo_databaseimport_dropzone");t.on("dragover",(e=>{e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"})),t.on("drop",(e=>{e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.files;this.importFile(t)}));let i=jQuery(".jo_dumpfile");i.on("change",(e=>{var t=e.originalEvent.target.files;this.importFile(t).then((()=>{i.val(null)}))})),this.$dialog.css("visibility","visible"),jQuery("#jo_ds_cancel_button").on("click",(()=>{this.showMainWindow()})),jQuery("#jo_ds_create_database_button").on("click",(()=>{let e="emptyDatabase";jQuery(".jo_createDatabaseFromTemplateTab").hasClass("jo_active")&&(e="fromTemplate"),jQuery(".jo_createDatabaseUseExistingTab").hasClass("jo_active")&&(e="useExistingDatabase"),jQuery(".jo_createDatabaseUseDumpFile").hasClass("jo_active")&&(e="useDumpFile");let t={id:null,isFolder:!1,name:jQuery(".dialog-input.jo_databasename").val(),path:this.path.join("/")};switch(e){case"emptyDatabase":this.createWorkspace(t);break;case"fromTemplate":let e=jQuery(".jo_templateListEntry.jo_active");if(1!=e.length)return void alert("Bitte wählen Sie genau eine Vorlage aus.");t.template_database_id=e.data("templateId"),"Neue Datenbank"==t.name&&(t.name=e.data("name")),this.createWorkspace(t);break;case"useExistingDatabase":let i=jQuery(".jo_databasecodeinput").val(),n=i.indexOf("T");if(-1==n)return void alert("Der Zugriffscode muss das Zeichen T enthalten.");t.otherDatabaseId=Number.parseInt(i.substring(0,n)),t.secret=i.substring(n+1),this.createWorkspace(t);break;case"useDumpFile":if(null==this.database)return void alert("Bitte laden Sie zuerst den Binärdump einer Datenbank hoch.");(new xe).uploadCurrentDatabase(-1,this.main,this.database.binDump,"uploadBaseTemplateForWorkspace",(e=>{t.template_id=e.newTemplateId,this.createWorkspace(t)}))}}))}createWorkspace(e){this.main.networkManager.sendCreateWorkspace(e,this.owner_id,(t=>{if(null!=t)return void alert(t);let i=this.main.createNewWorkspace(e.name,this.owner_id);i.path=e.path,i.id=e.id,i.sql_history="";let n=this.main.projectExplorer;this.main.workspaceList.push(i);let r={name:e.name,externalElement:i,iconClass:"workspace",isFolder:!1,path:this.path};n.workspaceListPanel.addElement(r,!0),i.renderSettingsButton(r),n.workspaceListPanel.sortElements(),n.fileListPanel.sortElements(),n.setWorkspaceActive(i),this.showMainWindow()}))}importFile(e){return t=this,i=void 0,r=function*(){let t=new Qe,i=yield t.loadFromFile(e[0],this.main),n=!1;if("binaryCompressed"==$e.getDumpType(i.binDump)){let e=pako.inflate(i.binDump);"binaryUncompressed"==$e.getDumpType(e)&&(n=!0)}else"binaryUncompressed"==$e.getDumpType(i.binDump)&&(i.binDump=pako.deflate(i.binDump),n=!0);n?(this.database=i,jQuery(".jo_databaseimport_ok").html("Die Datenbankdatei wurde erfolgreich von Datei eingelesen. Sie können die Datenbank jetzt durch Klick auf den Button unten erstellen.")):alert("In der Datei befindet sich kein Binärdump einer Datenbank.")},new((n=void 0)||(n=Promise))((function(e,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,a)}l((r=r.apply(t,i||[])).next())}));var t,i,n,r}showMainWindow(){jQuery("#main").css("visibility","visible"),this.$dialog.css("visibility","hidden"),this.$dialog.empty()}}class We{constructor(e){this.main=e,this.currentSubmenu={},this.openSubmenusOnMousemove=!1}initGUI(e){let t=this,i=this.main.getMonacoEditor(),n={items:[{identifier:"Datei",subMenu:{items:[{identifier:"Speichern und Beenden",action:()=>{jQuery("#buttonLogout").trigger("click")}}]}},{identifier:"Bearbeiten",subMenu:{items:[{identifier:"Rückgängig (Strg + z)",action:()=>{i.trigger(".","undo",{})}},{identifier:"Wiederholen (Strg + y)",action:()=>{i.trigger(".","redo",{})}},{identifier:"-"},{identifier:"Kopieren (Strg + c)",action:()=>{i.getAction("editor.action.clipboardCopyAction").run()}},{identifier:"Ausschneiden (Strg + x)",action:()=>{i.getAction("editor.action.clipboardCutAction").run()}},{identifier:"Nach oben kopieren (Alt + Shift + Pfeil rauf)",action:()=>{i.getAction("editor.action.copyLinesUpAction").run()}},{identifier:"Nach unten kopieren (Alt + Shift + Pfeil runter)",action:()=>{i.getAction("editor.action.copyLinesDownAction").run()}},{identifier:"Nach oben verschieben (Alt + Pfeil rauf)",action:()=>{i.getAction("editor.action.moveLinesUpAction").run()}},{identifier:"Nach unten verschieben (Alt + Pfeil runter)",action:()=>{i.getAction("editor.action.moveLinesDownAction").run()}},{identifier:"-"},{identifier:"Suchen... (Strg + f)",action:()=>{i.getAction("actions.find").run()}},{identifier:"Ersetzen... (Strg + h)",action:()=>{i.getAction("editor.action.startFindReplaceAction").run()}},{identifier:"-"},{identifier:"Aus-/Einkommentieren (Strg + #)",action:()=>{i.getAction("editor.action.commentLine").run()}},{identifier:"Dokument formatieren (Alt + Shift + f)",action:()=>{i.getAction("editor.action.formatDocument").run()}},{identifier:"-"},{identifier:"Finde zugehörige Klammer (Strg + k)",action:()=>{i.getAction("editor.action.jumpToBracket").run()}},{identifier:"-"},{identifier:"Alles zusammenfalten",action:()=>{i.getAction("editor.foldAll").run()}},{identifier:"Alles auffalten",action:()=>{i.getAction("editor.unfoldAll").run()}},{identifier:"-"},{identifier:"Vorschlag auslösen (Strg + Leertaste)",action:()=>{i.focus(),setTimeout((()=>{i.getAction("editor.action.triggerSuggest").run()}),200)}},{identifier:"Parameterhilfe (Strg + Shift + Leertaste)",action:()=>{i.getAction("editor.action.triggerParameterHints").run()}},{identifier:"Gehe zur Definition (Strg + Click)",action:()=>{i.focus(),setTimeout((()=>{i.getAction("editor.action.revealDefinition").run()}),200)}}]}},{identifier:"Ansicht",subMenu:{items:[{identifier:"Theme",subMenu:{items:[{identifier:"Dark",action:()=>{t.switchTheme("dark")}},{identifier:"Light",action:()=>{t.switchTheme("light")}}]}},{identifier:"-"},{identifier:"Hoher Kontrast im Editor ein/aus",action:()=>{i.getAction("editor.action.toggleHighContrast").run()}},{identifier:"-"},{identifier:"Zoom out (Strg + Mausrad)",action:()=>{this.main.editor.changeEditorFontSize(-4)}},{identifier:"Zoom normal",action:()=>{this.main.editor.setFontSize(14)}},{identifier:"Zoom in (Strg + Mausrad)",action:()=>{this.main.editor.changeEditorFontSize(4)}}]}},{identifier:"Datenbank",subMenu:{items:[{identifier:"Neue Datenbank anlegen...",action:()=>{let e=t.main.user.id;null!=t.main.workspacesOwnerId&&(e=t.main.workspacesOwnerId),new Re(t.main,e,[])}},{identifier:"Einstellungen...",action:()=>{new Se(this.main,this.main.currentWorkspace)}},{identifier:"Export als Binärdump (.sqLite-File)...",action:()=>{(new Qe).saveToFile(this.main.getDatabaseTool())}}]}}]};null!=e&&e.is_admin&&n.items[0].subMenu.items.push({identifier:"Shutdown server...",action:()=>{confirm("Server wirklich herunterfahren?")&&ke("shutdown",{},(()=>{alert("Server erfolgreich heruntergefahren.")}),(e=>{alert(e)}))}}),jQuery("#mainmenu").empty(),this.initMenu(n,0)}switchTheme(e){this.main.viewModeController.setTheme(e)}initMenu(e,t){e.level=t,0==t?e.$element=jQuery("#mainmenu"):(e.$element=jQuery('<div class="jo_submenu"></div>'),jQuery("body").append(e.$element)),e.$element.data("model",e);for(let i of e.items){if("-"==i.identifier)i.$element=jQuery('<div class="jo_menuitemdivider"></div>');else{if(i.$element=jQuery("<div>"+i.identifier+"</div>"),null!=i.link){let t=jQuery('<a href="'+i.link+'" target="_blank" class="jo_menulink"></a>');t.on("mousedown",(t=>{t.stopPropagation(),setTimeout((()=>{e.$element.hide()}),500)})),t.append(i.$element),i.$element=t}null!=i.subMenu&&this.initMenu(i.subMenu,t+1),this.initMenuitemCallbacks(e,i),0==t&&i.$element.addClass("jo_mainmenuitem")}e.$element.append(i.$element),i.$element.data("model",i)}let i=this;jQuery(document).on("mousedown",(()=>{for(let e=0;e<5;e++)null!=i.currentSubmenu[e]&&(i.currentSubmenu[e].hide(),i.currentSubmenu[e]=null);i.openSubmenusOnMousemove=!1}))}initMenuitemCallbacks(e,t){let i=this;null!=t.action&&t.$element.on("mousedown",(e=>{t.action(t.identifier)})),null!=t.subMenu?(t.$element.on("mousedown",(e=>{i.opensubmenu(t),i.openSubmenusOnMousemove=!0,e.stopPropagation()})),t.$element.on("mousemove.mainmenu",(()=>{i.openSubmenusOnMousemove?i.opensubmenu(t):null!=i.currentSubmenu[e.level+1]&&(i.currentSubmenu[e.level+1].hide(),i.currentSubmenu[e.level+1]=null)}))):t.$element.on("mousemove.mainmenu",(()=>{null!=i.currentSubmenu[e.level+1]&&(i.currentSubmenu[e.level+1].hide(),i.currentSubmenu[e.level+1]=null)}))}opensubmenu(e){let t,i,n=e.subMenu;1==n.level?(t=e.$element.position().left,i=30):(t=e.$element.offset().left+e.$element.width(),i=e.$element.offset().top),n.$element.css({top:i+"px",left:t+"px"}),null!=this.currentSubmenu[n.level]&&this.currentSubmenu[n.level].hide(),n.$element.show(),this.currentSubmenu[n.level]=n.$element}}class ze{constructor(e,t,i,n,r,o,s,a,l,d,u){this.accordion=e,this.caption=t,this.flexWeight=i,this.newButtonClass=n,this.buttonNewTitle=r,this.defaultIconClass=o,this.withDeleteButton=s,this.withFolders=a,this.kind=l,this.enableDrag=d,this.acceptDropKinds=u,this.elements=[],this.dontSortElements=!1,e.addPanel(this);let h=window.PointerEvent?"pointer":"mouse";if(a){let e=this;this.$newFolderAction=jQuery('<div class="img_add-folder-dark jo_button jo_active" style="margin-right: 4px" title="Neuen Ordner auf oberster Ebene anlegen">'),this.$newFolderAction.on(h+"down",(e=>{e.stopPropagation(),e.preventDefault(),this.addFolder("Neuer Ordner",[],(e=>{this.newFolderCallback(e,(()=>{this.sortElements(),e.$htmlFirstLine[0].scrollIntoView(),ge(e.$htmlFirstLine.find(".jo_filename"),"background-color",[0,255,0],2e3)}))}))})),this.addAction(this.$newFolderAction);let t=jQuery('<div class="img_collapse-all-dark jo_button jo_active" style="margin-right: 4px" title="Alle Ordner zusammenfalten">');t.on(h+"down",(t=>{t.stopPropagation(),t.preventDefault(),e.collapseAll()})),this.addAction(t)}}collapseAll(){for(let e of this.elements)e.isFolder&&e.$htmlFirstLine.hasClass("jo_expanded")&&(e.$htmlFirstLine.removeClass("jo_expanded"),e.$htmlFirstLine.addClass("jo_collapsed")),e.path.length>0&&e.$htmlFirstLine.slideUp(200)}remove(){this.$captionElement.remove(),this.$listElement.remove()}setFixed(e){this.fixed=e,this.fixed?(this.grow(),this.$captionElement.addClass("jo_fixed")):this.$captionElement.removeClass("jo_fixed")}enableNewButton(e){null!=this.$buttonNew&&(e?this.$buttonNew.show():this.$buttonNew.hide())}getCurrentlySelectedPath(){let e=[],t=this.getSelectedElement();return null!=t&&(e=t.path.slice(0),t.isFolder&&e.push(t.name)),e}compareWithPath(e,t,i,n,r,o){(t=t.slice()).push(e),e="",(r=r.slice()).push(n),n="";let s=0;for(;s<t.length&&s<r.length;){let e=t[s].localeCompare(r[s]);if(0!=e)return e;s++}return t.length<r.length?-1:t.length>r.length?1:e.localeCompare(n)}getElementIndex(e,t,i){for(let n=0;n<this.elements.length;n++){let r=this.elements[n];if(this.compareWithPath(e,t,i,r.name,r.path,r.isFolder)<0)return n}return this.elements.length}insertElement(e){let t=this.getElementIndex(e.name,e.path,e.isFolder);this.elements.splice(t,0,e);let i=this.$listElement.find(".jo_file");if(0==t)this.$listElement.prepend(e.$htmlFirstLine);else if(t==i.length)this.$listElement.append(e.$htmlFirstLine);else{let n=i.get(t);jQuery(n).before(e.$htmlFirstLine)}}addFolder(e,t,i){let n={name:e,isFolder:!0,path:t},r=this.renderElement(n,!0);this.insertElement(n),r[0].scrollIntoView(),this.renameElement(n,(()=>{i(n)}))}renderOuterHtmlElements(e){let t=this;if(this.$captionElement=jQuery('<div class="jo_leftpanelcaption jo_expanded">\n        <div class="jo_captiontext">'+this.caption+'</div><div class="jo_actions"></div></div>'),null!=this.newButtonClass){this.$buttonNew=jQuery('<div class="jo_button jo_active '+this.newButtonClass+'" title="'+this.buttonNewTitle+'">'),this.$captionElement.find(".jo_actions").append(this.$buttonNew);let e=window.PointerEvent?"pointer":"mouse";this.$buttonNew.on(e+"down",(e=>{Ie.close(),e.stopPropagation();let i=t.getCurrentlySelectedPath(),n={name:"Neu",isFolder:!1,path:i},r=this.getElementIndex("",i,!1);this.elements.splice(r,0,n);let o=this.renderElement(n,!0);if(0==r)this.$listElement.prepend(o);else{let e=this.$listElement.find(".jo_file").get(r-1);jQuery(e).after(o)}o[0].scrollIntoView(),t.renameElement(n,(()=>{t.newFilesElementCallback(n,(e=>{n.externalElement=e,null!=n.$htmlSecondLine&&n.$htmlSecondLine.insertAfter(o),null!=t.selectCallback&&t.select(n.externalElement)}))}))}))}let i=jQuery('<div id="filelistouter" class="jo_projectexplorerdiv jo_scrollable" data-grow="'+this.flexWeight+'" style="flex-grow: '+this.flexWeight+'"></div>');this.$listElement=jQuery('<div class="jo_filelist"></div>'),i.append(this.$listElement),e.append(this.$captionElement),e.append(i);let n=this.$captionElement,r=this.$listElement.parent(),o=window.PointerEvent?"pointer":"mouse";n.on(o+"down",(e=>{if(0==e.button&&!this.fixed){let e=r.data("grow");n.hasClass("jo_expanded")?t.accordion.parts.length>1&&r.animate({"flex-grow":.001},1e3,(()=>{n.toggleClass("jo_expanded")})):(n.toggleClass("jo_expanded"),r.animate({"flex-grow":e},1e3))}})),n.on("dragover",(e=>{ze.currentlyDraggedElementKind==t.kind&&(n.addClass("jo_file_dragover"),e.preventDefault())})),n.on("dragleave",(e=>{n.removeClass("jo_file_dragover")})),n.on("drop",(e=>{if(ze.currentlyDraggedElementKind==t.kind){e.preventDefault(),n.removeClass("jo_file_dragover");let i=ze.currentlyDraggedElement;null!=i&&t.moveElement(i,null)}}))}grow(){let e=this.$listElement.parent(),t=e.data("grow");e.css("flex-grow",t),this.$captionElement.addClass("jo_expanded")}addElement(e,t){e.$htmlFirstLine=this.renderElement(e,t),this.insertElement(e)}sortElements(){this.dontSortElements||(this.elements.sort(((e,t)=>{let i=e.sortName?e.sortName:e.name,n=t.sortName?t.sortName:t.name;return this.compareWithPath(i,e.path,e.isFolder,n,t.path,t.isFolder)})),this.elements.forEach((e=>{this.$listElement.append(e.$htmlFirstLine)})))}setTextAfterFilename(e,t,i){if(null==e)return;let n=e.$htmlFirstLine.find(".jo_textAfterName");n.addClass(i),n.html(t)}addAction(e){this.$captionElement.find(".jo_actions").prepend(e)}renderElement(e,t){let i=window.PointerEvent?"pointer":"mouse",n=this,r="";null==e.iconClass&&(e.iconClass=this.defaultIconClass),e.isFolder&&(e.iconClass="folder",r=t?" jo_expanded":" jo_collapsed");let o="";null==e.path&&(e.path=[]);for(let t=0;t<e.path.length;t++)o+='<div class="jo_folderline"></div>';if(e.$htmlFirstLine=jQuery(`<div class="jo_file jo_${e.iconClass} ${r}">\n        <div class="jo_folderlines">${o}</div>\n           <div class="jo_fileimage"></div>\n           <div class="jo_filename">${te(e.name)}</div>\n           <div class="jo_textAfterName"></div>\n           <div class="jo_additionalButtonSettings"></div>\n           ${this.withDeleteButton?'<div class="jo_delete img_delete jo_button jo_active"></div>':""}\n           ${fe?"":'<div class="jo_settings_button img_ellipsis-dark jo_button jo_active"></div>'}\n           </div>`),!t&&e.path.length>0&&e.$htmlFirstLine.hide(),null!=this.addElementActionCallback){let t=this.addElementActionCallback(e);e.$htmlFirstLine.append(t)}if(this.withFolders&&e.isFolder&&(e.$htmlFirstLine.on("dragover",(t=>{ze.currentlyDraggedElementKind==n.kind&&(e.$htmlFirstLine.addClass("jo_file_dragover"),t.preventDefault())})),e.$htmlFirstLine.on("dragleave",(t=>{e.$htmlFirstLine.removeClass("jo_file_dragover")})),e.$htmlFirstLine.on("drop",(t=>{if(ze.currentlyDraggedElementKind==n.kind){t.preventDefault(),e.$htmlFirstLine.removeClass("jo_file_dragover");let i=ze.currentlyDraggedElement;ze.currentlyDraggedElement=null,null!=i&&n.moveElement(i,e)}}))),this.withFolders||this.enableDrag){let t=e.$htmlFirstLine.find(".jo_filename");t.attr("draggable","true"),t.on("dragstart",(t=>{ze.currentlyDraggedElement=e,ze.currentlyDraggedElementKind=n.kind,t.originalEvent.dataTransfer.effectAllowed=e.isFolder?"move":"copyMove"}))}null!=this.acceptDropKinds&&this.acceptDropKinds.length>0&&(e.isFolder||(e.$htmlFirstLine.on("dragover",(t=>{this.acceptDropKinds.indexOf(ze.currentlyDraggedElementKind)>=0&&(e.$htmlFirstLine.addClass("jo_file_dragover"),t.ctrlKey?t.originalEvent.dataTransfer.dropEffect="copy":t.originalEvent.dataTransfer.dropEffect="move",t.preventDefault())})),e.$htmlFirstLine.on("dragleave",(t=>{e.$htmlFirstLine.removeClass("jo_file_dragover")})),e.$htmlFirstLine.on("drop",(t=>{if(this.acceptDropKinds.indexOf(ze.currentlyDraggedElementKind)>=0){t.preventDefault(),e.$htmlFirstLine.removeClass("jo_file_dragover");let i=ze.currentlyDraggedElement;ze.currentlyDraggedElement=null,null!=i&&null!=n.dropElementCallback&&n.dropElementCallback(e,i,t.ctrlKey?"copy":"move")}})))),e.$htmlFirstLine.on(i+"up",(t=>{if(0==t.button&&null!=n.selectCallback){n.selectCallback(e.externalElement);for(let t of n.elements)t!=e&&t.$htmlFirstLine.hasClass("jo_active")&&t.$htmlFirstLine.removeClass("jo_active");if(e.$htmlFirstLine.addClass("jo_active"),e.isFolder){e.$htmlFirstLine.hasClass("jo_expanded")?(e.$htmlFirstLine.removeClass("jo_expanded"),e.$htmlFirstLine.addClass("jo_collapsed")):(e.$htmlFirstLine.addClass("jo_expanded"),e.$htmlFirstLine.removeClass("jo_collapsed"));let t={};for(let e of this.elements)if(e.isFolder){let i=e.path.join("/");""!=i&&(i+="/"),i+=e.name,t[i]=e.$htmlFirstLine.hasClass("jo_collapsed"),t[e.path.join("/")]&&(t[i]=!0)}t[""]=!1;for(let e of this.elements)t[e.path.join("/")]?e.$htmlFirstLine.slideUp(200):e.$htmlFirstLine.slideDown(200)}}}));let s,a=function(t){let i=[];if(null!=n.renameCallback&&i.push({caption:"Umbenennen",callback:()=>{n.renameElement(e)}}),window.PointerEvent,e.isFolder&&(i=i.concat([{caption:"Neuen Unterordner anlegen (unterhalb '"+e.name+"')...",callback:()=>{n.select(e.externalElement);let t=n.getCurrentlySelectedPath();n.addFolder("Neuer Ordner",t,(e=>{n.newFolderCallback(e,(()=>{n.sortElements(),e.$htmlFirstLine[0].scrollIntoView(),ge(e.$htmlFirstLine.find(".jo_filename"),"background-color",[0,255,0],2e3)}))}))}},{caption:"Neue Datenbank...",callback:()=>{n.select(e.externalElement),n.newDatabaseElementCallback(e.path.concat(e.name))}}])),null!=n.contextMenuProvider&&!e.isFolder)for(let t of n.contextMenuProvider(e))i.push({caption:t.caption,callback:()=>{t.callback(e)},color:t.color,subMenu:null==t.subMenu?null:t.subMenu.map((t=>({caption:t.caption,callback:()=>{t.callback(e)},color:t.color})))});i.length>0&&(t.preventDefault(),t.stopPropagation(),ce(i,t.pageX,t.pageY))};return e.$htmlFirstLine[0].addEventListener("contextmenu",a,!1),fe||e.$htmlFirstLine.on("pointerup",(()=>(clearTimeout(s),!1))).on("pointerdown",(e=>(s=window.setTimeout((()=>{a(e)}),500),!1))),fe||(e.$htmlFirstLine.find(".jo_settings_button").on("pointerdown",(e=>{a(e)})),e.$htmlFirstLine.find(".jo_settings_button").on("mousedown click",(e=>{e.preventDefault(),e.stopPropagation()}))),n.withDeleteButton&&(e.$htmlFirstLine.find(".jo_delete")[0].addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation()}),!1),e.$htmlFirstLine.find(".jo_delete").on(i+"up",(t=>{t.preventDefault(),ce([{caption:"Abbrechen",callback:()=>{}},{caption:"Ich bin mir sicher: löschen!",color:"#ff6060",callback:()=>{e.isFolder&&n.getChildElements(e).length>0?alert("Dieser Ordner kann nicht gelöscht werden, da er nicht leer ist."):n.deleteCallback(e.externalElement,(()=>{e.$htmlFirstLine.remove(),null!=e.$htmlSecondLine&&e.$htmlSecondLine.remove(),n.elements.splice(n.elements.indexOf(e),1),null!=n.selectCallback&&(n.elements.length>0?n.select(n.elements[0].externalElement):n.select(null))}))}}],t.pageX+2,t.pageY+2),t.stopPropagation()}))),e.$htmlFirstLine}moveElement(e,t){let i=null==t?[]:t.path.slice(0).concat([t.name]);if(e.isFolder){let t=[e],n=e.path.concat([e.name]).join("/");if(0==i.join("/").indexOf(n))return;let r=e.path.length;e.path=i.slice(0);for(let e of this.elements)e.path.join("/").startsWith(n)&&(e.path.splice(0,r),e.path=i.concat(e.path),t.push(e));for(let e of t)e.$htmlFirstLine.remove(),this.elements.splice(this.elements.indexOf(e),1);for(let e of t)this.renderElement(e,!0),this.insertElement(e);this.moveCallback(t)}else e.path=i,e.$htmlFirstLine.remove(),this.elements.splice(this.elements.indexOf(e),1),this.renderElement(e,!0),this.insertElement(e),this.select(e.externalElement),e.$htmlFirstLine[0].scrollIntoView(),this.moveCallback(e)}getChildElements(e){let t=e.path.slice(0).concat(e.name).join("/");return this.elements.filter((e=>e.path.join("/").startsWith(t)))}renameElement(e,t){let i=this,n=e.$htmlFirstLine.find(".jo_filename"),r=e.name.indexOf("."),o=null==r?null:{start:0,end:r};this.dontSortElements=!0,he(n,n,(r=>{null!=e.externalElement&&(r=i.renameCallback(e.externalElement,r)),e.name=r,n.html(e.name),null!=t&&t(),i.sortElements(),n[0].scrollIntoView(),this.dontSortElements=!1}),o)}select(e,t=!0,i=!1){if(null==e)for(let e of this.elements)e.$htmlFirstLine.hasClass("jo_active")&&e.$htmlFirstLine.removeClass("jo_active");else{let t=this.findElement(e);if(null!=t){for(let e of this.elements)e.$htmlFirstLine.hasClass("jo_active")&&e.$htmlFirstLine.removeClass("jo_active");if(t.$htmlFirstLine.addClass("jo_active"),i){let e=t.path.join("/");for(let t of this.elements){let i=t.path.slice(0);e.startsWith(i.join("/"))&&(t.isFolder&&(i.push(t.name),e.startsWith(i.join("/"))&&(t.$htmlFirstLine.removeClass("jo_collapsed"),t.$htmlFirstLine.addClass("jo_expanded"))),t.$htmlFirstLine.show())}t.$htmlFirstLine[0].scrollIntoView()}}}t&&null!=this.selectCallback&&this.selectCallback(e)}getPathString(e){let t=e.path.join("/");return e.isFolder&&(""!=t&&(t+="/"),t+=e.name),t}setElementClass(e,t){var i;null!=e&&(null===(i=e.$htmlFirstLine)||void 0===i||i.removeClass("jo_"+e.iconClass).addClass("jo_"+t),e.iconClass=t)}findElement(e){for(let t of this.elements)if(t.externalElement==e)return t;return null}removeElement(e){for(let t of this.elements)if(t.externalElement==e)return t.$htmlFirstLine.remove(),null!=t.$htmlSecondLine&&t.$htmlSecondLine.remove(),this.elements.splice(this.elements.indexOf(t),1),void(null!=this.selectCallback&&(this.elements.length>0?this.select(this.elements[0].externalElement):this.select(null)))}clear(){this.$listElement.empty(),this.elements=[]}setCaption(e){this.$captionElement.find(".jo_captiontext").html(e)}getSelectedElement(){for(let e of this.elements)if(e.$htmlFirstLine.hasClass("jo_active"))return e;return null}}class qe{constructor(e,t){this.main=e,this.parts=[],this.$html=t,t.addClass("jo_leftpanelinner")}addPanel(e){e.renderOuterHtmlElements(this.$html),this.parts.push(e)}}class He{constructor(e,t,i){this.classes=e,this.workspace=t,this.main=i,this.studentCount=0,this.init()}init(){this.$dialog=jQuery("#dialog"),jQuery("#main").css("visibility","hidden"),this.$dialog.append(jQuery(`<div class="jo_ds_heading">Austeilen eines Workspace an einzelne Schüler/innen</div>\n             <div class="jo_ds_settings">\n                <div class="jo_ds_settings_caption">Workspace:</div><div class="jo_ds_workspacename">${this.workspace.name}</div>\n                <div class="jo_ds_settings_caption">Liste filtern:</div><div class="jo_ds_filterdiv"><input class="dialog-input"></input></div>\n             </div>\n             <div class="jo_ds_student_list jo_scrollable">\n             </div>\n             <div class="jo_ds_selected_message"></div>\n             <div class="dialog-buttonRow jo_ds_buttonRow">\n                <button id="jo_ds_cancel_button">Abbrechen</button>\n                <button id="jo_ds_distribute_button">Austeilen</button>\n             </div>\n            `));let e=jQuery(".jo_ds_student_list"),t=this;for(let i of this.classes)for(let n of i.students){let r=jQuery('<div class="jo_ds_student_line">'),o=jQuery(`<div class="jo_ds_student_class">${i.name}</div>`),s=jQuery(`<div class="jo_ds_student_name">${n.rufname} ${n.familienname}</div>`);r.append(o,s),e.append(r),r.on("mousedown",(()=>{r.toggleClass("jo_active"),t.studentCount+=r.hasClass("jo_active")?1:-1,jQuery(".jo_ds_selected_message").text(`${t.studentCount} Schüler/inn/en selektiert`)})),r.data("student",n),r.data("klass",i)}jQuery(".jo_ds_filterdiv>input").on("input",(()=>{let e=jQuery(".jo_ds_filterdiv>input").val();null==e||""==e?$(".jo_ds_student_line").show():$(".jo_ds_student_line").each(((t,i)=>{let n=jQuery(i),r=n.data("klass"),o=n.data("student");(r.name+" "+o.rufname+" "+o.familienname).indexOf(e)>=0?n.show():n.hide()}))})),this.$dialogMain=this.$dialog.find(".dialog-main"),this.$dialog.css("visibility","visible"),jQuery("#jo_ds_cancel_button").on("click",(()=>{t.close()})),jQuery("#jo_ds_distribute_button").on("click",(()=>{t.distributeWorkspace()}))}distributeWorkspace(){let e=[];$(".jo_ds_student_line").each(((t,i)=>{let n=jQuery(i);if(n.hasClass("jo_active")){let t=n.data("student");e.push(t.id)}})),this.close(),this.main.networkManager.sendDistributeWorkspace(this.workspace,null,e,(t=>{if(null==t){let t=this.main.networkManager,i=t.updateFrequencyInSeconds*t.forcedUpdateEvery;alert(`Der Workspace ${this.workspace.name} wurde an ${e.length} Schüler/innen ausgeteilt. Er wird in maximal ${i} s bei jedem Schüler ankommen.`)}else alert(t)}))}close(){this.$dialog.css("visibility","hidden"),this.$dialog.empty(),jQuery("#main").css("visibility","visible")}}class Ue{constructor(e,t){this.main=e,this.$projectexplorerDiv=t,this.programPointerModule=null,this.programPointerDecoration=[],this.lastOpenModule=null}initGUI(){this.accordion=new qe(this.main,this.$projectexplorerDiv),this.initFilelistPanel(),this.initWorkspacelistPanel()}initFilelistPanel(){let e=this;this.fileListPanel=new ze(this.accordion,"Kein Workspace gewählt","1","img_add-file-dark","Neue Datei...","java",!0,!1,"file",!0,[]),this.fileListPanel.newFilesElementCallback=(t,i)=>{if(null==e.main.currentWorkspace)return alert("Bitte wählen Sie zuerst einen Workspace aus."),null;let n={name:t.name,dirty:!1,saved:!0,text:"",text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:1,panelElement:t},r=new le(n,e.main);e.main.currentWorkspace.moduleStore.putModule(r),e.setModuleActive(r),e.main.networkManager.sendCreateFile(r,e.main.currentWorkspace,e.main.workspacesOwnerId,(e=>{null==e?i(r):alert("Der Server ist nicht erreichbar!")}))},this.fileListPanel.renameCallback=(t,i)=>{i=i.substr(0,80);let n=t.file;return n.name=i,n.saved=!1,e.main.networkManager.sendUpdates(),i},this.fileListPanel.deleteCallback=(t,i)=>{e.main.networkManager.sendDeleteWorkspaceOrFile("file",t.file.id,(n=>{null==n?(e.main.currentWorkspace.moduleStore.removeModule(t),i()):alert("Der Server ist nicht erreichbar!")}))},this.fileListPanel.contextMenuProvider=t=>(e.main.user.is_teacher||e.main.user.is_admin||e.main.user.is_schooladmin||t.externalElement.file,[]),this.fileListPanel.selectCallback=t=>{e.setModuleActive(t)}}renderHomeworkButton(e){var t,i;let n=null===(i=null===(t=null==e?void 0:e.panelElement)||void 0===t?void 0:t.$htmlFirstLine)||void 0===i?void 0:i.find(".jo_additionalButtonHomework");if(null==n)return;n.find(".jo_homeworkButton").remove();let r=null,o="";if(null!=e.submitted_date&&(r="img_homework",o="Wurde als Hausaufgabe abgegeben: "+e.submitted_date,e.text_before_revision&&(r="img_homework-corrected",o="Korrektur liegt vor.")),null!=r){let e=jQuery(`<div class="jo_homeworkButton ${r}" title="${o}"></div>`);n.prepend(e),r.indexOf("jo_active")>=0&&(e.on("mousedown",(e=>e.stopPropagation())),e.on("click",(e=>{e.stopPropagation()})))}}initWorkspacelistPanel(){let e=this;this.workspaceListPanel=new ze(this.accordion,"Datenbanken","3",null,"Neue Datenbank...","workspace",!0,!0,"workspace",!1,["file"]);let t=jQuery('<div class="img_add-database-dark jo_button jo_active" style="margin-right: 4px" title="Neue Datenbank auf oberster Ordnerebene anlegen">'),i=window.PointerEvent?"pointer":"mouse";t.on(i+"down",(t=>{t.stopPropagation();let i=e.main.user.id;null!=e.main.workspacesOwnerId&&(i=e.main.workspacesOwnerId),new Re(e.main,i,this.workspaceListPanel.getCurrentlySelectedPath())})),this.workspaceListPanel.addAction(t),null!=this.workspaceListPanel.$buttonNew&&this.workspaceListPanel.$buttonNew.hide(),this.workspaceListPanel.newDatabaseElementCallback=t=>{let i=e.main.user.id;null!=e.main.workspacesOwnerId&&(i=e.main.workspacesOwnerId),new Re(e.main,i,t)},this.workspaceListPanel.renameCallback=(t,i)=>(i=i.substr(0,80),t.name=i,t.saved=!1,e.main.networkManager.sendUpdates(),i),this.workspaceListPanel.deleteCallback=(t,i)=>{e.main.networkManager.sendDeleteWorkspaceOrFile("workspace",t.id,(n=>{null==n?(e.main.removeWorkspace(t),t.isFolder||(e.fileListPanel.clear(),e.main.databaseExplorer.clear(),e.main.getResultsetPresenter().clear(),e.fileListPanel.enableNewButton(!1),e.main.getMonacoEditor().setModel(null)),i()):alert("Fehler: "+n)}))},this.workspaceListPanel.selectCallback=t=>{t.isFolder||t!=this.main.currentWorkspace&&e.main.networkManager.sendUpdates((()=>{e.setWorkspaceActive(t)}))},this.workspaceListPanel.newFolderCallback=(t,i)=>{let n=e.main.user.id;null!=e.main.workspacesOwnerId&&(n=e.main.workspacesOwnerId);let r=new _e(t.name,e.main,n);r.isFolder=!0,r.path=t.path.join("/"),r.panelElement=t,t.externalElement=r,e.main.workspaceList.push(r);let o={id:-1,isFolder:!0,name:r.name,path:r.path};e.main.networkManager.sendCreateWorkspace(o,e.main.workspacesOwnerId,(n=>{null==n?(r.id=o.id,i(r)):(alert("Fehler: "+n),e.workspaceListPanel.removeElement(t))}))},this.workspaceListPanel.moveCallback=e=>{Array.isArray(e)||(e=[e]);for(let t of e){let e=t.externalElement;e.path=t.path.join("/"),e.saved=!1}this.main.networkManager.sendUpdates()},this.workspaceListPanel.dropElementCallback=(t,i,n)=>{let r=t.externalElement,o=i.externalElement;if(r.moduleStore.getModules(!1).indexOf(o)>=0)return;let s={name:o.file.name,dirty:!0,saved:!1,text:o.file.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:o.file.version,panelElement:null};"move"==n&&(e.main.currentWorkspace.moduleStore.removeModule(o),e.fileListPanel.removeElement(o),e.main.networkManager.sendDeleteWorkspaceOrFile("file",o.file.id,(()=>{})));let a=new le(s,e.main);r.moduleStore.putModule(a),e.main.networkManager.sendCreateFile(a,r,e.main.workspacesOwnerId,(e=>{null==e||alert("Der Server ist nicht erreichbar!")}))},this.$homeAction=jQuery('<div class="img_home-dark jo_button jo_active" style="margin-right: 4px" title="Meine eigenen Workspaces anzeigen">'),this.$homeAction.on(i+"down",(t=>{t.stopPropagation(),e.main.networkManager.sendUpdates((()=>{e.onHomeButtonClicked()})),e.main.bottomDiv.hideHomeworkTab()})),this.workspaceListPanel.addAction(this.$homeAction),this.$homeAction.hide(),this.workspaceListPanel.contextMenuProvider=e=>{let t=[];return this.main.user.is_teacher&&this.main.teacherExplorer.classPanel.elements.length>0&&t.push({caption:"An Klasse austeilen...",callback:e=>{},subMenu:this.main.teacherExplorer.classPanel.elements.map((e=>({caption:e.name,callback:t=>{let i=e.externalElement,n=t.externalElement;this.main.networkManager.sendDistributeWorkspace(n,i,null,(e=>{if(null==e){let e=this.main.networkManager,t=e.updateFrequencyInSeconds*e.forcedUpdateEvery;alert("Der Workspace "+n.name+" wurde an die Klasse "+i.name+" ausgeteilt. Er wird in maximal "+t+" s bei jedem Schüler ankommen.")}else alert(e)}))}})))},{caption:"An einzelne Schüler/innen austeilen...",callback:e=>{let t=this.main.teacherExplorer.classPanel.elements.map((e=>e.externalElement)),i=e.externalElement;new He(t,i,this.main)}}),t}}onHomeButtonClicked(){this.main.teacherExplorer.restoreOwnWorkspaces(),this.main.networkManager.updateFrequencyInSeconds=this.main.networkManager.ownUpdateFrequencyInSeconds,this.$homeAction.hide(),this.fileListPanel.enableNewButton(this.main.workspaceList.length>0)}renderFiles(e){let t=null==e?"Kein Workspace vorhanden":e.name;if(this.fileListPanel.setCaption(t),this.fileListPanel.clear(),null!=this.main.getCurrentWorkspace())for(let e of this.main.getCurrentWorkspace().moduleStore.getModules(!1))e.file.panelElement=null;if(null!=e){let t=[];for(let i of e.moduleStore.getModules(!1))t.push(i);t.sort(((e,t)=>e.file.name>t.file.name?1:e.file.name<t.file.name?-1:0));for(let e of t)e.file.panelElement={name:e.file.name,externalElement:e,isFolder:!1,path:[]},this.fileListPanel.addElement(e.file.panelElement,!0),this.renderHomeworkButton(e.file);this.fileListPanel.sortElements()}}renderWorkspaces(e){this.fileListPanel.clear(),this.workspaceListPanel.clear();for(let t of e){let e=t.path.split("/");1==e.length&&""==e[0]&&(e=[]),t.panelElement={name:t.name,externalElement:t,iconClass:"workspace",isFolder:t.isFolder,path:e},this.workspaceListPanel.addElement(t.panelElement,!1),t.renderSettingsButton(t.panelElement)}this.workspaceListPanel.sortElements(),this.fileListPanel.enableNewButton(e.length>0)}renderErrorCount(e,t){if(null!=t)for(let i of e.moduleStore.getModules(!1)){let e=t.get(i),n=null==e||0==e?"":"("+e+")";this.fileListPanel.setTextAfterFilename(i.file.panelElement,n,"jo_errorcount")}}setWorkspaceActive(e,t,i=!1){if(e==this.main.getCurrentWorkspace())return void(null!=t&&t());null!=e&&this.fileListPanel.$buttonNew.show(),this.workspaceListPanel.select(e,!1,i);let n=i=>{this.initializeDatabaseTool(i,e,t)};null==e.database?(this.main.waitOverlay.show("Bitte warten, hole Datenbank vom Server ..."),this.main.networkManager.fetchDatabase(e,n)):n(null)}initializeDatabaseTool(e,t,i){if(null!=e)return void alert(e);let n=this.main.getDatabaseTool(),r=t.database.statements;null==r&&(r=[]),n.initializeWorker(t.database.templateDump,r,(()=>{if(this.main.currentWorkspace=t,this.main.user.id==t.owner_id&&(this.main.user.currentWorkspace_id=t.id),this.renderFiles(t),null!=t){let e=t.moduleStore.getModules(!1);null!=t.currentlyOpenModule?this.setModuleActive(t.currentlyOpenModule):e.length>0?this.setModuleActive(e[0]):this.setModuleActive(null);for(let t of e)t.file.dirty=!0;0==e.length&&Ie.showHelper("newSQLFileHelper",this.main,this.fileListPanel.$captionElement),this.main.notifier.connect(t)}else this.setModuleActive(null)}),(()=>{this.main.databaseExplorer.refreshAfterRetrievingDBStructure(),this.main.getHistoryViewer().clearAndShowStatements(t.database.statements),null!=i&&i()}))}writeEditorTextToFile(){let e=this.getCurrentlyEditedModule();null!=e&&(e.file.text=e.getProgramTextFromMonacoModel())}setModuleActive(e){this.main.bottomDiv.homeworkManager.hideRevision(),null!=this.lastOpenModule&&(this.lastOpenModule.file.text=this.lastOpenModule.getProgramTextFromMonacoModel(),this.lastOpenModule.editorState=this.main.getMonacoEditor().saveViewState()),null==e?(this.main.getMonacoEditor().setModel(monaco.editor.createModel("Keine Datei vorhanden.","text")),this.main.getMonacoEditor().updateOptions({readOnly:!0})):(this.main.getMonacoEditor().updateOptions({readOnly:!1}),this.main.getMonacoEditor().setModel(e.model),null!=this.main.getBottomDiv()&&this.main.getBottomDiv().errorManager.showParenthesisWarning(e.bracketError),null!=e.file.text_before_revision?this.main.bottomDiv.homeworkManager.showHomeWorkRevisionButton():this.main.bottomDiv.homeworkManager.hideHomeworkRevisionButton())}setActiveAfterExternalModelSet(e){this.fileListPanel.select(e,!1),this.lastOpenModule=e,null!=e.editorState&&(this.main.editor.dontPushNextCursorMove++,this.main.getMonacoEditor().restoreViewState(e.editorState),this.main.editor.dontPushNextCursorMove--),this.setCurrentlyEditedModule(e),this.showProgramPointer(),setTimeout((()=>{this.main.getMonacoEditor().getOptions().get(monaco.editor.EditorOption.readOnly)||this.main.getMonacoEditor().focus()}),300)}showProgramPointer(){if(this.programPointerModule==this.getCurrentlyEditedModule()&&null!=this.getCurrentlyEditedModule()){let e=this.programPointerPosition,t={startColumn:e.column,startLineNumber:e.line,endColumn:e.column+e.length,endLineNumber:e.line};this.main.getMonacoEditor().revealRangeInCenterIfOutsideViewport(t),this.programPointerDecoration=this.main.getMonacoEditor().deltaDecorations(this.programPointerDecoration,[{range:t,options:{className:"jo_revealProgramPointer",isWholeLine:!0,overviewRuler:{color:"#6fd61b",position:monaco.editor.OverviewRulerLane.Center},minimap:{color:"#6fd61b",position:monaco.editor.MinimapPosition.Inline}}},{range:t,options:{beforeContentClassName:"jo_revealProgramPointerBefore"}}])}}showProgramPointerPosition(e,t){if(null==e)return;let i=this.main.currentWorkspace.moduleStore.findModuleByFile(e);null!=i&&(this.programPointerModule=i,this.programPointerPosition=t,i!=this.getCurrentlyEditedModule()?this.setModuleActive(i):this.showProgramPointer())}hideProgramPointerPosition(){this.getCurrentlyEditedModule()==this.programPointerModule&&this.main.getMonacoEditor().deltaDecorations(this.programPointerDecoration,[]),this.programPointerModule=null,this.programPointerDecoration=[]}getCurrentlyEditedModule(){let e=this.main.currentWorkspace;return null==e?null:e.currentlyOpenModule}setCurrentlyEditedModule(e){if(null==e)return;let t=this.main.currentWorkspace;t.currentlyOpenModule!=e&&(t.currentlyOpenModule=e,t.saved=!1,e.file.dirty=!0)}setExplorerColor(e){let t;null==e?(e="transparent",t="Meine Datenbanken"):t="Schüler-DB",this.fileListPanel.$listElement.parent().css("background-color",e),this.workspaceListPanel.$listElement.parent().css("background-color",e),this.workspaceListPanel.setCaption(t)}getNewModule(e){return new le(e,this.main)}}class Ke{constructor(e,t){this.main=e,this.$rightDiv=t,this.isWholePage=!1,this.$tabs=t.find(".jo_tabs"),this.$headings=t.find(".jo_tabheadings"),this.$headings.find(".jo_classDiagramTabHeading").length,this.$headings.find(".jo_objectDiagramTabHeading").length;let i=this,n="100%";t.find(".jo_whole-window").on("click",(()=>{i.isWholePage=!i.isWholePage;let e=jQuery(".jo_whole-window");i.isWholePage?(jQuery("#code").css("display","none"),n=jQuery("#rightdiv").css("width"),jQuery("#rightdiv").css("width","100%"),e.removeClass("img_whole-window"),e.addClass("img_whole-window-back"),jQuery(".jo_control-container").append(jQuery("#controls")),e.attr("title","Auf normale Größe zurückführen"),jQuery(".jo_graphics").trigger("sizeChanged")):(jQuery("#code").css("display","flex"),jQuery("#rightdiv").css("width",n),e.removeClass("img_whole-window-back"),e.addClass("img_whole-window"),jQuery("#controls").insertAfter(jQuery("#view-mode")),e.attr("title","Auf Fenstergröße vergrößern"),jQuery(".jo_graphics").trigger("sizeChanged"))}))}initGUI(){me(this.$rightDiv)}}class Ve{constructor(e){this.main=e}initSliders(){let e=this,t=window.PointerEvent?"pointer":"mouse";jQuery("#slider1").on(t+"down",(i=>{let n=i.clientX;jQuery(document).on(t+"move.slider1",(t=>{let i=t.clientX-n;e.moveLeftPanel(i),n=t.clientX})),jQuery(document).on(t+"up.slider1",(()=>{jQuery(document).off(t+"move.slider1"),jQuery(document).off(t+"up.slider1")}))})),jQuery("#slider2").on(t+"down",(i=>{let n=i.clientY;jQuery(document).on(t+"move.slider2",(t=>{let i=t.clientY-n;e.moveBottomDiv(i),n=t.clientY})),jQuery(document).on(t+"up.slider2",(()=>{jQuery(document).off(t+"move.slider2"),jQuery(document).off(t+"up.slider2")}))})),jQuery("#slider3").on(t+"down",(i=>{let n=i.clientX;jQuery(document).on(t+"move.slider3",(t=>{let i=t.clientX-n;e.moveRightDiv(i),n=t.clientX,t.stopPropagation()})),jQuery(document).on(t+"up.slider3",(()=>{jQuery(document).off(t+"move.slider3"),jQuery(document).off(t+"up.slider3")}))}));let i=jQuery('<div class="jo_sliderknob img_knob jo_button jo_active" style="left: -8px" draggable="false"></div>');jQuery("#slider2").append(i),i.on(t+"down",(i=>{let n=i.clientY,r=i.clientX;i.stopImmediatePropagation(),jQuery(document).on(t+"move.knobleft",(t=>{let i=t.clientY-n,o=t.clientX-r;t.stopImmediatePropagation(),e.moveLeftPanel(o),e.moveBottomDiv(i),r+=o,n+=i})),jQuery(document).on(t+"up.knobleft",(()=>{jQuery(document).off(t+"move.knobleft"),jQuery(document).off(t+"up.knobleft")}))}));let n=jQuery('<div class="jo_sliderknob img_knob jo_button jo_active" style="right: -8px" draggable="false"></div>');jQuery("#slider2").append(n),n.on(t+"down",(i=>{let n=i.clientY,r=i.clientX;i.stopImmediatePropagation(),jQuery(document).on(t+"move.knobright",(t=>{let i=t.clientY-n,o=t.clientX-r;t.stopImmediatePropagation(),e.moveRightDiv(o),e.moveBottomDiv(i),r+=o,n+=i})),jQuery(document).on(t+"up.knobright",(()=>{jQuery(document).off(t+"move.knobright"),jQuery(document).off(t+"up.knobright")}))}))}moveRightDiv(e){let t=jQuery("#editor>.monaco-editor"),i=jQuery("#rightdiv"),n=Number.parseInt(i.css("width").replace("px",""));i.css("width",n-e+"px");let r=Number.parseInt(t.css("width").replace("px",""));t.css("width",r+e+"px"),this.main.getMonacoEditor().layout(),null!=this.main.bottomDiv.homeworkManager.diffEditor&&this.main.bottomDiv.homeworkManager.diffEditor.layout(),jQuery(".jo_graphics").trigger("sizeChanged"),n+=e}moveBottomDiv(e){let t=jQuery("#editor>.monaco-editor"),i=jQuery("#bottomdiv-outer"),n=Number.parseInt(i.css("height").replace("px",""));i.css("height",n-e+"px");let r=Number.parseInt(t.css("height").replace("px",""));t.css("height",r+e+"px"),this.main.getMonacoEditor().layout(),null!=this.main.bottomDiv.homeworkManager.diffEditor&&this.main.bottomDiv.homeworkManager.diffEditor.layout()}moveLeftPanel(e){let t=jQuery("#leftpanel"),i=jQuery("#editor>.monaco-editor"),n=Number.parseInt(t.css("width").replace("px",""));t.css("width",n+e+"px");let r=Number.parseInt(i.css("width").replace("px",""));i.css("width",r-e+"px"),this.main.getMonacoEditor().layout(),null!=this.main.bottomDiv.homeworkManager.diffEditor&&this.main.bottomDiv.homeworkManager.diffEditor.layout()}}class Ge{constructor(e,t){this.main=e,this.classData=t}removePanels(){this.classPanel.remove(),this.studentPanel.remove()}initGUI(){this.initStudentPanel(),this.initClassPanel(),this.renderClasses(this.classData)}initStudentPanel(){let e=this;this.studentPanel=new ze(this.main.projectExplorer.accordion,"Schüler/innen","2",null,"","student",!1,!1,"student",!1,[]),this.studentPanel.selectCallback=t=>{e.main.networkManager.sendUpdates((()=>{ke("getWorkspaces",{ws_userId:t.id,userId:this.main.user.id,language:1},(i=>{1==i.success&&(e.main.workspacesOwnerId==e.main.user.id&&(e.ownWorkspaces=e.main.workspaceList.slice(),e.currentOwnWorkspace=e.main.currentWorkspace),e.main.restoreWorkspaces(i.workspaces),e.main.workspacesOwnerId=t.id,e.main.projectExplorer.setExplorerColor("rgba(255, 0, 0, 0.2"),e.main.projectExplorer.$homeAction.show(),Ie.showHelper("homeButtonHelper",this.main),e.main.bottomDiv.showHomeworkTab(),e.main.bottomDiv.homeworkManager.attachToWorkspaces(e.main.workspaceList)),this.main.networkManager.updateFrequencyInSeconds=this.main.networkManager.teacherUpdateFrequencyInSeconds,this.main.networkManager.secondsTillNextUpdate=this.main.networkManager.teacherUpdateFrequencyInSeconds}))}))}}restoreOwnWorkspaces(){let e=this.main;e.getMonacoEditor().updateOptions({readOnly:!0}),e.workspaceList=this.ownWorkspaces,e.currentWorkspace=this.currentOwnWorkspace,e.workspacesOwnerId=e.user.id,e.projectExplorer.setExplorerColor(null),e.projectExplorer.renderWorkspaces(e.workspaceList),null==e.currentWorkspace&&e.workspaceList.length>0&&(e.currentWorkspace=e.workspaceList[0]),null!=e.currentWorkspace&&e.projectExplorer.setWorkspaceActive(e.currentWorkspace),this.studentPanel.select(null,!1)}initClassPanel(){let e=this;this.classPanel=new ze(this.main.projectExplorer.accordion,"Klassen","1",null,"","class",!1,!1,"class",!1,[]),this.classPanel.selectCallback=t=>{e.main.networkManager.sendUpdates((()=>{let e=t;null!=e&&this.renderStudents(e.students)}))}}renderStudents(e){this.studentPanel.clear(),e.sort(((e,t)=>e.familienname>t.familienname?1:t.familienname>e.familienname?-1:e.rufname>t.rufname?1:t.rufname>e.rufname?-1:0));for(let t of e){let e={name:t.familienname+", "+t.rufname,sortName:t.familienname+" "+t.rufname,externalElement:t,isFolder:!1,path:[]};this.studentPanel.addElement(e,!0)}}renderClasses(e){this.studentPanel.clear(),e.sort(((e,t)=>e.name>t.name?1:t.name>e.name?-1:0));for(let t of e){let e={name:t.name,externalElement:t,isFolder:!1,path:[]};this.classPanel.addElement(e,!0)}}}class Je{init(){this.$dialog=jQuery("#dialog"),jQuery("#main").css("visibility","hidden"),this.$dialog.append(jQuery('<div style="flex: 1"></div><div class="dialog-main"></div><div style="flex: 4"></div>')),this.$dialogMain=this.$dialog.find(".dialog-main"),this.$dialog.css("visibility","visible")}heading(e){let t=jQuery('<div class="dialog-heading">'+e+"</div>");return this.$dialogMain.append(t),t}description(e,t){let i=jQuery(`<div class="dialog-description" ${null==t?"":`style="color: ${t}"`}>${e}</div>`);return this.$dialogMain.append(i),i}input(e,t){let i=jQuery(`<input class="dialog-input" type="${e}" placeholder="${t}"></input>`);return this.$dialogMain.append(i),i}buttons(e){let t=jQuery('<div class="dialog-buttonRow"></div>');this.$dialogMain.append(t);for(let i of e){let e=jQuery(`<button style="background-color: ${i.color};margin-left: 20px">${i.caption}</button>`);e.on("click",(()=>{i.callback()})),t.append(e)}}waitMessage(e){let t=jQuery(`<div class="dialog-wait">${e}<img src="assets/projectexplorer/svg-loaders/ball-triangle.svg"></div>`);return this.$dialogMain.append(t),e=>{let i=e?"visible":"hidden";t.css("visibility",i)}}close(){this.$dialog.css("visibility","hidden"),this.$dialog.empty(),jQuery("#main").css("visibility","visible")}}class Ye{constructor(e){this.main=e}init(){let e=jQuery("#buttonUserSettings"),t=this;e.on("click",(i=>{ce([{caption:"Passwort ändern...",callback:()=>{new Ze(t.main).show()}}],e.offset().left,e.offset().top+e.height())}))}}class Ze{constructor(e){this.main=e,this.dialog=new Je}show(){this.dialog.init(),this.dialog.heading("Passwort ändern"),this.dialog.description("Bitte geben Sie Ihr bisheriges Passwort und darunter zweimal Ihr neues Passwort ein. <br>Das Passwort muss mindestens 8 Zeichen lang sein und sowohl Buchstaben als auch Zahlen oder Sonderzeichen enthalten.");let e=this.dialog.input("password","Altes Passwort"),t=this.dialog.input("password","Neues Passwort"),i=this.dialog.input("password","Neues Passwort wiederholen"),n=this.dialog.description("","red"),r=this.dialog.waitMessage("Bitte warten...");this.dialog.buttons([{caption:"Abbrechen",color:"#a00000",callback:()=>{this.dialog.close()}},{caption:"OK",color:"green",callback:()=>{t.val()!=i.val()?n.text("Die zwei eingegebenen neuen Passwörter stimmen nicht überein."):(r(!0),ke("changePassword",{oldPassword:e.val(),newPassword:t.val()},(()=>{r(!1),alert("Das Passwort wurde erfolgreich geändert."),this.dialog.close()}),(e=>{r(!1),n.text(e)})))}}])}}class Xe{constructor(e){this.main=e}initGUI(){let e=this,t=jQuery("#login-spinner>img");jQuery("#login-username").focus(),jQuery("#login-username").on("keydown",(e=>{"Enter"==e.key&&jQuery("#login-password").focus()})),jQuery("#login-password").on("keydown",(e=>{"Enter"==e.key&&jQuery("#login-button").trigger("click")})),jQuery("#login-password").on("keydown",(e=>{"Tab"==e.key&&(e.preventDefault(),jQuery("#login-button").focus(),jQuery("#login-button").addClass("jo_active")),"Enter"==e.key&&jQuery("#login-button").trigger("click")})),jQuery("#login-button").on("keydown",(e=>{"Tab"==e.key?(e.preventDefault(),jQuery("#login-username").focus(),jQuery("#login-button").removeClass("jo_active")):jQuery("#login-button").trigger("click")}));let i=!1;jQuery("#login-button").on("click",(()=>{t.show(),i||(i=!0,setTimeout((()=>{i=!1}),1e3),ke("login",{username:jQuery("#login-username").val(),password:jQuery("#login-password").val(),language:1},(i=>{if(i.success){jQuery("#login").hide(),this.main.waitOverlay.show("Bitte warten...");let n=i.user;null!=n.settings&&null!=n.settings.helperHistory||(n.settings={helperHistory:{},viewModes:null,classDiagram:null}),this.main.waitForGUICallback=()=>{e.main.mainMenu.initGUI(n),e.main.waitOverlay.hide(),t.hide(),jQuery("#menupanel-username").html(te(n.rufname)+" "+te(n.familienname)),new Ye(e.main).init(),n.is_teacher&&e.main.initTeacherExplorer(i.classdata),e.main.user=n,e.main.restoreWorkspaces(i.workspaces),e.main.workspacesOwnerId=n.id,e.main.networkManager.initializeTimer(),e.main.projectExplorer.fileListPanel.setFixed(!n.is_teacher),e.main.projectExplorer.workspaceListPanel.setFixed(!n.is_teacher),e.main.viewModeController.initViewMode(),e.main.bottomDiv.hideHomeworkTab(),e.main.networkManager.initializeNotifierClient()},0==this.main.startupComplete&&(this.main.waitForGUICallback(),this.main.waitForGUICallback=null)}else jQuery("#login-message").html("Fehler: Benutzername und/oder Passwort ist falsch.")}),(e=>{jQuery("#login-message").html("Login gescheitert: "+e),jQuery("#login-spinner>img").hide()})))})),jQuery("#buttonLogout").on("click",(()=>{this.main.waitOverlay.show("Bitte warten, der letzte Bearbeitungsstand wird noch gespeichert ..."),this.main.workspacesOwnerId!=this.main.user.id&&this.main.projectExplorer.onHomeButtonClicked(),this.main.networkManager.sendUpdates((()=>{var e;ke("logout",{currentWorkspaceId:null===(e=this.main.currentWorkspace)||void 0===e?void 0:e.id},(()=>{this.main.networkManager.sendUpdateUserSettings((()=>{})),jQuery("#login").show(),this.main.waitOverlay.hide(),jQuery("#login-message").empty(),this.main.getMonacoEditor().setModel(monaco.editor.createModel("","myJava")),this.main.projectExplorer.fileListPanel.clear(),this.main.projectExplorer.workspaceListPanel.clear(),this.main.databaseExplorer.clear(),this.main.resultsetPresenter.clear(),this.main.user.is_teacher&&(this.main.teacherExplorer.removePanels(),this.main.teacherExplorer=null),this.main.currentWorkspace=null,this.main.user=null}))}),!0)}))}}class et{constructor(e,t){this.$buttonsContainer=e,this.main=t,this.$buttonMap={},this.highContrast=!1,this.editorHasFullWidth=!1,this.$buttonEditorFullscreen=jQuery('<div title="Editor in voller Breite" class="img_whole-window jo_button jo_active" style="padding: 1px; margin-right: 20px"></div>'),this.$buttonPresentationMode=jQuery('<div title="Präsentation (Beamer)" class="img_presentation-mode jo_button jo_active" syle="padding: 1px"></div>'),this.$buttonMonitorMode=jQuery('<div title="Monitor" class="img_monitor-mode jo_button jo_active" style="margin-left: 5px; padding: 1px"></div>'),e.append(this.$buttonEditorFullscreen,this.$buttonPresentationMode,this.$buttonMonitorMode),this.$buttonMap={presentation:this.$buttonPresentationMode,monitor:this.$buttonMonitorMode};let i=this.main.actionManager;i.registerAction("editor.fullwidth",[],(()=>{this.toggleEditorFullwidth()}),"Editor auf die volle Breite erweitern",this.$buttonEditorFullscreen),i.registerAction("viewmode.presentation",[],(()=>{this.setMode("presentation")}),"Präsentationsansicht",this.$buttonPresentationMode),i.registerAction("viewmode.monitor",[],(()=>{this.setMode("monitor")}),"Monitoransicht",this.$buttonMonitorMode)}toggleEditorFullwidth(){this.editorHasFullWidth?(this.$buttonEditorFullscreen.removeClass("img_whole-window-back"),this.$buttonEditorFullscreen.addClass("img_whole-window"),this.$buttonEditorFullscreen.attr("title","Editor in voller Breite"),jQuery("#rightdiv").show(600),jQuery("#leftpanel").show(600),jQuery("#controls").show()):(this.$buttonEditorFullscreen.removeClass("img_whole-window"),this.$buttonEditorFullscreen.addClass("img_whole-window-back"),this.$buttonEditorFullscreen.attr("title","Editor in normaler Breite"),jQuery("#rightdiv").hide(600),jQuery("#leftpanel").hide(600),jQuery("#controls").hide()),setTimeout((()=>{this.main.getMonacoEditor().layout()}),800),this.editorHasFullWidth=!this.editorHasFullWidth}setMode(e,t=!0){let i="presentation"==e?"monitor":"presentation";this.$buttonMap[e].addClass("jo_pressed"),this.$buttonMap[i].removeClass("jo_pressed");let n=this.main.user.settings.viewModes,r=n[e];n.viewModeChosen=e,this.main.themeManager.switchTheme(r.theme),this.main.editor.setFontSize(r.fontSize),this.highContrast!=r.highContrast&&(this.main.getMonacoEditor().getAction("editor.action.toggleHighContrast").run(),this.highContrast=!this.highContrast),t&&this.saveSettings()}saveFontSize(e){this.getChosenViewMode().fontSize=e,this.saveSettings()}setTheme(e){let t=this.getChosenViewMode();t.theme=e,this.main.themeManager.switchTheme(t.theme),this.saveSettings()}toggleHighContrast(){let e=this.getChosenViewMode();e.highContrast=!e.highContrast,this.main.getMonacoEditor().getAction("editor.action.toggleHighContrast").run(),this.saveSettings()}getChosenViewMode(){let e=this.main.user.settings.viewModes;return e[e.viewModeChosen]}saveSettings(){this.main.userDataDirty=!0}initViewMode(){let e=this.main.user.settings;null==e.viewModes&&(e.viewModes={monitor:null,presentation:null,viewModeChosen:"monitor"}),null==e.viewModes.monitor&&(e.viewModes.monitor={fontSize:14,highContrast:!1,theme:"dark"},e.viewModes.presentation={fontSize:18,highContrast:!1,theme:"light"},this.saveSettings()),this.setMode(e.viewModes.viewModeChosen,!1)}}class tt{constructor(e){this.main=e,this.semicolonPositions=[]}startRegistering(){this.semicolonPositions.forEach((e=>e.isThereAgain=!1)),this.time=(new Date).getTime()}register(e,t){let i=this.semicolonPositions.find((t=>t.position.line==e.line&&t.position.column==e.column));i?i.isThereAgain=!0:this.semicolonPositions.push({position:e,firstSeenMs:this.time,isThereAgain:!0,module:t})}healSemicolons(){let e=(new Date).getTime();this.semicolonPositions=this.semicolonPositions.filter((e=>e.isThereAgain));let t=this.main.getCurrentlyEditedModule(),i=this.main.getMonacoEditor().getPosition().lineNumber;this.semicolonPositions.filter((t=>e-t.firstSeenMs>2e3)).forEach((e=>{let n=null!=e.module.file.id&&e.module.file.id==t.file.id,r=[{range:new monaco.Range(e.position.line,e.position.column,e.position.line,e.position.column),text:";",forceMoveMarkers:!0}];if(n&&Math.abs(i-e.position.line)>1){let t=this.main.getMonacoEditor();const i=t.getSelection();t.executeEdits("Semicolon-Angel",r),t.setSelection(i),this.semicolonPositions.splice(this.semicolonPositions.indexOf(e),1)}}))}}class it{constructor(e,t){this.main=e,this.$mainDiv=t,this.collapsedTables=new Map}refresh(){this.main.getDatabaseTool().retrieveDatabaseStructure((e=>{this.refreshAfterRetrievingDBStructure()}))}clear(){this.$mainDiv.empty()}refreshAfterRetrievingDBStructure(){let e=this.main.getDatabaseTool(),t=this.main.getCurrentWorkspace();if(null!=t)for(let e of t.moduleStore.getModules(!1))e.file.dirty=!0;let i=J.fromTableStructureList(e.databaseStructure.tables);this.$mainDiv.empty();for(let e of i)if("sqlite_sequence"!=e.identifier){let t=this.renderTable(e);this.$mainDiv.append(t)}}renderTable(e){let t=null!=this.collapsedTables.get(e.identifier),i=jQuery(`<div class="jo_table">\n           <div class="jo_tableheader">\n              <div class="${t?"img_tree-collapsed-dark":"img_tree-expanded-dark"} jo_treeswitch jo_button jo_active"></div>\n              <div class="jo_tableheaderlink">\n                <div class="img_table"></div>\n                <div>${e.identifier}</div></div><div class="jo_tablesize">(${e.size}&nbsp;Datensätze)</div>\n              </div>\n            </div>\n        </div>`);i.find(".jo_tableheader").on("pointerup",(()=>{this.main.getResultsetPresenter().showTable(e.identifier)}));let n=jQuery('<div class="jo_columnlist"></div>');for(let t of e.columns){let e=t.isPrimaryKey?"img_key":"img_column",i="";null!=t.references&&(i=`<div class="img_foreign_key" style="margin-left: 5px"></div><div class="jo_references">${t.references.table.identifier}.${t.references.identifier}</div>`);let r=null==t.type?"":t.type.toString(),o=t.notNull?'<div class="jo_dbnotnull">not null</div>':"",s=t.defaultValue?`<div class="jo_dbdefault">default ${t.defaultValue}</div>`:"",a=t.isAutoIncrement?'<div class="jo_dbautoincrement">autoincrement</div>':"",l=jQuery(`\n            <div class="jo_column">\n                <div class="${e}"></div>\n                <div>${t.identifier}</div>\n                <div class="jo_dbtype">${r}</div>\n                ${a}\n                ${i}\n                ${o}\n                ${s}\n            </div>\n            `);n.append(l)}i.append(n);let r=i.find(".jo_treeswitch"),o=this;return r.on("pointerup",(t=>{t.stopPropagation();let i=r.parents(".jo_table").find(".jo_columnlist");r.hasClass("img_tree-collapsed-dark")?(r.removeClass("img_tree-collapsed-dark"),r.addClass("img_tree-expanded-dark"),i.slideDown(300),o.collapsedTables.delete(e.identifier)):(r.removeClass("img_tree-expanded-dark"),r.addClass("img_tree-collapsed-dark"),i.slideUp(300),o.collapsedTables.set(e.identifier,!0))})),i}}class nt{constructor(e,t){this.main=e,this.$buttonsContainer=t,this.$buttonStart=jQuery('<div title="Start" class="img_start-dark jo_button"></div>'),this.$buttonRollback=jQuery('<div title="Rollback" class="img_undo jo_button"></div>');let i=this.main.getActionManager();i.registerAction("execute",["Strg + Enter"],(()=>{i.isActive("execute")&&this.main.getResultsetPresenter().executeSelectedStatements()}),"SQL-Statement ausführen",this.$buttonStart),i.setActive("execute",!1),i.registerAction("rollback",["Strg + LeftArrow"],(()=>{i.isActive("rollback")&&this.main.getHistoryViewer().rollback()}),"Letztes schreibendes SQL-Statement rückgängig machen",this.$buttonRollback),i.setActive("rollback",!1),t.append(this.$buttonStart,this.$buttonRollback)}}class rt{constructor(e,t){this.main=e,this.$bottomDiv=t,this.paginationSize=1e3,this.writeQueryListeners=[],this.oldErrorDecorations=[],this.showResultsBusy=!1,this.showResultPending=!1,this.$paginationDiv=t.find(".jo_pagination"),this.$arrowLeft=jQuery('<div class="jo_button img_arrow-left-dark jo_active"></div>'),this.$infoDiv=jQuery('<div class="jo_pagination_info"><span class="jo_pagination_fromto">0001-1000</span>/<span class="jo_pagination_all">5000</span></div>'),this.$arrowRight=jQuery('<div class="jo_button img_arrow-right-dark jo_active"></div>'),this.$paginationDiv.empty(),this.$paginationDiv.append(this.$arrowLeft,this.$infoDiv,this.$arrowRight),this.$paginationDiv.hide();let i=(window.PointerEvent?"pointer":"mouse")+"up",n=this;this.$arrowLeft.on(i,(e=>{n.paginationFrom>1&&(n.paginationFrom=Math.max(n.paginationFrom-n.paginationSize,1),n.paginationFrom%1e3!=1&&(n.paginationFrom=(Math.floor(n.paginationFrom/n.paginationSize)+1)*n.paginationSize+1),n.showResults(),n.activateButtons())})),this.$arrowRight.on(i,(e=>{n.paginationFrom<this.paginationAll-n.paginationSize+1&&(n.paginationFrom=Math.min(n.paginationFrom+n.paginationSize,n.paginationAll-n.paginationSize+1),n.showResults(),n.activateButtons())}))}addWriteQueryListener(e){this.writeQueryListeners.push(e)}activateButtons(){this.$arrowLeft.toggleClass("jo_active",this.paginationFrom>1),this.$arrowRight.toggleClass("jo_active",this.paginationFrom<this.paginationAll-this.paginationSize+1)}executeSelectedStatements(){let t=this.fetchSelectedStatements().filter((t=>t.ast.type!=e.omittedeStatement));if(0==t.length)return;let i=t.some((e=>this.isDDLStatement(e))),n=t.some((e=>this.isWriteStatement(e))),r=this.main.getCurrentWorkspace(),o=r.database;i&&r.permissions<=1?alert("Der Benutzer hat keine Berechtigung zum Ändern der Tabellenstruktur."):n&&0==r.permissions?alert("Der Benutzer hat keine Berechtigung zum Einfügen/Löschen/Ändern von Datensätzen."):i||n?this.main.isEmbedded()?this.executeDDLWriteStatementsEmbedded(r,t,o):this.executeDDLWriteStatementsInOnlineIDE(r,t,o):this.executeStatements(t,0,[],(()=>{}))}executeDDLWriteStatementsEmbedded(e,t,i){let n=[];this.executeStatements(t,0,n,(()=>{0!=n.length&&(this.main.getDatabaseExplorer().refresh(),this.writeQueryListeners.forEach((e=>e.notify(n))))}))}executeDDLWriteStatementsInOnlineIDE(e,t,i){let n=this.main;n.networkManager.getNewStatements(e,((r,o)=>{n.notifier.executeNewStatements(r,o,(()=>{}),(()=>{let r=[];this.executeStatements(t,0,r,(()=>{0!=r.length&&n.networkManager.AddDatabaseStatements(e,r.map((e=>null==e.sqlCleaned?e.sql:e.sqlCleaned)),((e,t)=>{e.forEach((e=>i.statements.push(e))),this.main.getHistoryViewer().appendStatements(e);let o=r.map((e=>null==e.sqlCleaned?e.sql:e.sqlCleaned));i.statements=i.statements.concat(o),this.main.getHistoryViewer().appendStatements(o),i.version=t,e.length>0?this.resetDatabase(i):n.getDatabaseExplorer().refresh()}))}))}),!1)}))}resetDatabase(e){this.main.getDatabaseTool().initializeWorker(e.templateDump,e.statements,(()=>{this.main.getDatabaseExplorer().refresh()}))}executeStatementsString(e,t,i){0!=e.length&&t<e.length?this.main.getDatabaseTool().executeQuery(e[t],(n=>{this.executeStatementsString(e,t+1,i)}),(n=>{console.log("Error when executing statement "+e[t]+"\nError : "+n),this.executeStatementsString(e,t+1,i)})):i()}executeStatements(t,i,n,r,o=[]){if(i>=t.length)return this.showErrors(o),void r();let s=t[i],a=()=>{this.executeStatements(t,i+1,n,r,o)};if(null!=s.ast)if(s.ast.type==e.keywordSelect){let e=!1;for(let n=i+1;n<t.length;n++)e=e||this.isSelectStatement(t[n]);if(e)a();else{if(null==s.ast.limitNode){for(s.sql.trimRight();s.sql.endsWith(";")||s.sql.endsWith("\n")||s.sql.endsWith("\r");)s.sql=s.sql.substring(0,s.sql.length-1),s.sql.trimRight();s.sql+=" limit 100000"}this.main.getDatabaseTool().executeQuery(s.sql,(e=>{this.presentResultsIntern(s.sql,e),a()}),(e=>{o.push({statement:s,message:e}),a()}))}}else{let e=(new Ae).clean(s);console.log(e),this.main.getDatabaseTool().executeQuery(e,(e=>{n.push(s),a()}),(e=>{o.push({statement:s,message:e}),a()}))}else a()}showErrorDecorations(e){let t={error:"#bc1616",warning:"#cca700",info:"#75beff"},i=(this.main.getMonacoEditor(),[]),n=[];for(let r of e){let e,o,s,a="error",l=t[a];switch(a){case"error":e="jo_revealErrorLine",o="jo_borderLeftError";break;case"warning":e="jo_revealWarningLine",o="jo_borderLeftWarning";break;case"info":e="jo_revealInfoLine",o="jo_borderLeftInfo"}switch(a){case"error":s=monaco.MarkerSeverity.Error;break;case"warning":s=monaco.MarkerSeverity.Warning;break;case"info":s=monaco.MarkerSeverity.Info}i.push({startLineNumber:r.statement.from.line,startColumn:r.statement.from.column,endLineNumber:r.statement.to.line,endColumn:r.statement.to.column,message:r.message,severity:s}),n.push({range:{startLineNumber:r.statement.from.line,startColumn:r.statement.from.column,endLineNumber:r.statement.to.line,endColumn:r.statement.to.column},options:{linesDecorationsClassName:e,minimap:{position:monaco.editor.MinimapPosition.Inline,color:l}}})}let r=this.main.getCurrentlyEditedModule().model;monaco.editor.setModelMarkers(r,"test",i),this.oldErrorDecorations=r.deltaDecorations(this.oldErrorDecorations,n)}showTable(e){let t="select * from "+e+";";this.main.getDatabaseTool().executeQuery(t,(e=>{this.presentResultsIntern(t,e)}),(e=>{}))}showErrors(e){let t=this.$bottomDiv.find(".jo_errorsTab"),i=this.$bottomDiv.find(".jo_errorsTabheading");if(t.empty(),this.showErrorDecorations(e),0==e.length)return;let n=window.PointerEvent?"pointer":"mouse";i.trigger(n+"down");let r=jQuery('<div class="jo_errorlist"></div>');t.append(r);for(let t of e){let e=t.statement.sql;e=e.replace(/\n/g," "),e=e.replace(/\s\s+/g," ");let i=jQuery('<div class="jo_error-line" style="flex-direction:column; width: fit-content"></div>');r.append(i),i.on(n+"down",(()=>{let e={startColumn:t.statement.from.column,startLineNumber:t.statement.from.line,endColumn:t.statement.to.column,endLineNumber:t.statement.to.line};this.main.getMonacoEditor().revealRangeInCenter(e),r.find(".jo_error-line").removeClass("jo_active"),i.addClass("jo_active")}));let o=jQuery('<div class="jo_sqlErrorStatement"></div>');i.append(o),monaco.editor.colorize(e,"vscSQL",{}).then((e=>{o.html(e)}));let s=jQuery('<div class="jo_sqlErrorMessage">'+t.message+"</div>");i.append(s)}this.$bottomDiv.find(".jo_tabheading").removeClass("jo_active"),i.addClass("jo_active"),t.addClass("jo_active")}isSelectStatement(t){return null!=t.ast&&t.ast.type==e.keywordSelect}isDDLStatement(t){return null!=t.ast&&[e.keywordCreate,e.keywordDrop,e.keywordAlter].indexOf(t.ast.type)>=0}isWriteStatement(t){return null!=t.ast&&[e.keywordInsert,e.keywordDelete,e.keywordUpdate].indexOf(t.ast.type)>=0}presentResultsIntern(e,t){let i=this.$bottomDiv.find(".jo_resultTabheading"),n=this.$bottomDiv.find(".jo_result-header"),r=window.PointerEvent?"pointer":"mouse";i.trigger(r+"down"),this.result=t.pop();let o=n;e=(e=(e=e.replace(/\n/g," ")).replace(/\s\s+/g," ")).replace(/limit 100000/g,""),monaco.editor.colorize(e,"vscSQL",{}).then((e=>{o.html(e)})),this.paginationAll=this.result?this.result.values.length:0,this.$infoDiv.find(".jo_pagination_all").html(`${this.paginationAll}`),this.paginationFrom=1,this.$paginationDiv.show(),this.activateButtons(),this.showResults()}clear(){this.$bottomDiv.find(".jo_result-body").empty(),this.$paginationDiv.hide()}showResults(){let e=this.$bottomDiv.find(".jo_result-body");if(null==this.result)return this.$infoDiv.find(".jo_pagination_fromto").html("---"),void e.html("Die Datenbank lieferte eine leere Ergebnistabelle.");let t=this,i=0==this.paginationAll?0:this.paginationFrom,n=0==this.paginationAll?0:Math.min(this.paginationFrom+this.paginationSize-1,this.paginationAll);if(this.$infoDiv.find(".jo_pagination_fromto").html(`${i}-${n}`),this.showResultsBusy){if(this.showResultPending)return;this.showResultPending=!0;let e=()=>{t.showResultsBusy?setTimeout((()=>{e()}),200):(t.showResultPending=!1,t.showResults())};return void setTimeout(e,200)}this.showResultsBusy=!0;let r=jQuery("<table></table>"),o=jQuery("<tr></tr>");r.append(o),this.result.columns.forEach((e=>{o.append(jQuery(`<th><div>${e}</div></th>`))}));let s=this.result.values.slice(this.paginationFrom-1,this.paginationFrom+this.paginationSize-1),a=0,l=()=>{if(a<s.length){for(let e=a;e<Math.min(a+200,s.length);e++){let t=s[e],i=jQuery("<tr></tr>");r.append(i),t.forEach((e=>{i.append(jQuery(`<td>${e}</td>`))}))}a=Math.min(a+200,s.length),a<s.length?setTimeout(l,30):(e.empty().append(r),this.showResultsBusy=!1)}};l()}fetchSelectedStatements(){let e=this.main.getCurrentlyEditedModule();if(null==e)return null;let t=this.main.getMonacoEditor(),i=e.getSQLSTatementsAtSelection(t.getSelection());for(let e of i)e.sql=t.getModel().getValueInRange({startColumn:e.from.column,startLineNumber:e.from.line,endColumn:e.to.column,endLineNumber:e.to.line});return i}}rt.StatementDelimiter=";\n\n";class ot{constructor(e){this.main=e,this.isOpen=!1,this.unsentMessages=[],this.isPolling=!1,this.counter=0,this.isLongPolling=!1,this.longPollCounter=0}connect(e){let t=this;this.workspace=e,this.database=e.database,this.isOpen&&this.connection.close(),ke("getWebSocketToken",{},(i=>{let n=(window.location.protocol.startsWith("https")?"wss://":"ws://")+window.location.host+"/servlet/websocket";this.connection=new WebSocket(n),this.connection.onerror=e=>{this.onError(e)},this.connection.onclose=e=>{this.onClose(e)},this.connection.onmessage=e=>{this.onMessage(e)},this.connection.onopen=t=>{let n={command:1,token:i.token,workspaceId:e.id,databaseId:e.database.id,databaseVersion:e.database.version};this.isOpen=!0,this.sendIntern(JSON.stringify(n)),this.onOpen()},setTimeout((()=>{t.startLongPolling()}),2e3)}))}sendIntern(e){if(this.isOpen)try{this.connection.send(e)}catch(e){console.log(e)}else this.unsentMessages.push(e)}onClose(e){this.isOpen=!1}disconnect(){this.sendIntern(JSON.stringify({command:4})),this.connection.close(),this.workspace=null}onMessage(e){let t=this,i=JSON.parse(e.data);if(null!=i.command)switch(i.command){case 2:t.executeNewStatements(i.newStatements,i.firstNewStatementIndex,(()=>{let e={command:2,databaseVersion:t.database.version};t.sendIntern(JSON.stringify(e))}));break;case 3:this.isOpen=!1,this.database=null,this.workspace=null;break;case 4:break;case 5:this.database.version>i.new_version&&this.main.getHistoryViewer().rollbackLocal(i.new_version)}}executeNewStatements(e,t,i,n=(()=>{}),r=!0){if(null==this.database)return;let o=this,s=t-(this.database.version+1);if(s>0)return i(),void n();{s<0&&(e.splice(0,-s),t-=s);let i=e;i.length>0?this.main.resultsetPresenter.executeStatementsString(i,0,(()=>{o.main.getHistoryViewer().appendStatements(i),o.database.statements=o.database.statements.concat(i),o.database.version=t+e.length-1,r&&o.main.databaseExplorer.refresh(),n()})):n()}}onError(e){}onOpen(){this.isOpen=!0,this.unsentMessages.length>0&&(this.unsentMessages.forEach((e=>this.sendIntern(e))),this.unsentMessages=[])}startPolling(){this.isPolling||(this.isPolling=!0,this.poll())}poll(){let e=this;setTimeout((()=>{e.poll()}),6e3),e.isOpen||null==e.workspace||(this.getNewStatementsHttp(),e.counter++,10==e.counter&&(e.counter=0,e.connect(e.workspace)))}getNewStatementsHttp(){let e=this;null!=this.workspace&&null!=this.database&&ke("getNewStatements",{workspaceId:this.workspace.id,version_before:this.workspace.database.version},(t=>{null!=t.rollbackToVersion?e.main.getHistoryViewer().rollbackLocal(t.rollbackToVersion):e.executeNewStatements(t.newStatements,t.firstNewStatementIndex,(()=>{e.getNewStatementsHttp()}))}))}startLongPolling(){this.isLongPolling||(this.isLongPolling=!0,this.longPoll())}longPoll(){let e=this;if(e.isOpen||null==e.workspace)setTimeout((()=>{e.longPoll()}),5e3);else{let t={workspaceId:e.workspace.id};$.ajax({type:"POST",async:!0,data:JSON.stringify(t),contentType:"application/json",url:"servlet/registerLongPollingListener",success:function(i){var n;console.log(i);let r="string"==typeof i?JSON.parse(i):i;if(null!=i&&!e.isOpen&&(null===(n=e.workspace)||void 0===n?void 0:n.id)==t.workspaceId&&r.success){e.executeNewStatements(r.newStatements,r.firstNewStatementIndex,(()=>{e.getNewStatementsHttp()}));let t=1e3;e.longPollCounter++,10==e.longPollCounter&&(e.longPollCounter=0,e.connect(e.workspace),t=2e3),setTimeout((()=>{e.longPoll()}),2e3)}},error:function(i,n){var r;e.isOpen||(null===(r=e.workspace)||void 0===r?void 0:r.id)!=t.workspaceId||setTimeout((()=>{e.longPoll()}),2e3)}})}}}class st{constructor(e){this.$waitDiv=e,this.visible=!1,this.fadeOutPending=!1,e.css("display","none"),this.$bitteWartenText=e.find(".bitteWartenText"),this.$bitteWartenProgress=e.find(".bitteWartenProgress")}show(e){this.fadeOutPending=!1,this.$bitteWartenText.html(e),this.$bitteWartenProgress.html(""),this.visible||(this.visible=!0,this.$waitDiv.css("display","flex"),this.$waitDiv.hide(),this.$waitDiv.fadeIn(400))}setProgress(e){this.$bitteWartenProgress.html(e)}hide(){this.visible&&(this.fadeOutPending=!0,setTimeout((()=>{this.fadeOutPending&&(this.fadeOutPending=!1,this.$waitDiv.fadeOut(200,(()=>{this.$waitDiv.css("display","none")})),this.visible=!1)}),50))}}class at{constructor(e,t){this.main=e,this.$historyPanel=t,this.panelEntries=[]}clear(){this.$historyPanel.empty(),this.main.getActionManager().setActive("rollback",!1),this.panelEntries=[]}clearAndShowStatements(e){this.clear(),this.appendStatements(e),this.main.getActionManager().setActive("rollback",e.length>0)}appendStatements(e){e.forEach((e=>{let t=this.makePanelEntry(e,this.panelEntries.length+1);this.$historyPanel.prepend(t.$div),this.panelEntries.unshift(t)})),e.length>0&&this.main.getActionManager().setActive("rollback",!0),this.makeLastButtonActive()}makeLastButtonActive(){this.panelEntries.forEach((e=>e.$rollbackButton.removeClass("jo_active"))),this.panelEntries.length>0&&this.panelEntries[0].$rollbackButton.addClass("jo_active")}makePanelEntry(e,t){let i=jQuery('<div class="jo_panelEntry"></div>'),n=jQuery(`<div class="jo_panelEntryIndex">${t}.</div>`),r=jQuery('<div class="jo_panelEntryText"></div>'),o=e.substring(0,Math.min(400,e.length));e.length>400&&(o+="..."),r.text(o);let s=jQuery('<div class="img_copy jo_panelEntryCopyButton jo_active jo_button" title="In die Zwischenablage kopieren"></div>'),a=jQuery('<div class="img_undo jo_panelEntryRollbackButton jo_button" title="Rollback"></div>');s.on("click",(()=>{be(e)}));let l=window.PointerEvent?"pointer":"mouse";return a.on(l+"up",(e=>{e.preventDefault(),ce([{caption:"Abbrechen",callback:()=>{}},{caption:"Ich bin mir sicher: rollback!",color:"#ff6060",callback:()=>{this.rollback()}}],e.pageX+2,e.pageY+2),e.stopPropagation()})),i.append(n,r,s,a),{$div:i,statement:e,$rollbackButton:a}}rollback(){0!=this.panelEntries.length&&(this.main.isEmbedded()?(this.rollbackEmbedded(),this.main.getActionManager().setActive("rollback",this.panelEntries.length>0)):this.main.networkManager.rollback(((e,t)=>{null==e&&t&&this.rollbackLocal()})))}rollbackLocal(e){let t=this.main.getCurrentWorkspace().database;for(null==e&&(e=t.version-1);t.version>e;)t.statements.pop(),t.version--;this.main.getDatabaseTool().initializeWorker(t.templateDump,t.statements,(()=>{}),(()=>{this.main.getDatabaseExplorer().refreshAfterRetrievingDBStructure(),this.panelEntries.shift().$div.remove(),this.makeLastButtonActive(),this.main.getActionManager().setActive("rollback",this.panelEntries.length>0)}))}rollbackEmbedded(){let e=this.main;e.writeQueryManager.rollback(),this.main.getDatabaseTool().initializeWorker(e.initialTemplateDump,e.initialStatements.concat(e.writeQueryManager.writtenStatements),(()=>{}),(()=>{this.main.getDatabaseExplorer().refreshAfterRetrievingDBStructure(),this.panelEntries.shift().$div.remove(),this.makeLastButtonActive()}))}}class lt{constructor(){this.workspaceList=[],this.startupComplete=2,this.version=0,this.userDataDirty=!1,this.waitOverlay=new st(jQuery(".bitteWarten")),this.historyViewer=new at(this,jQuery(".jo_historyTab"))}isEmbedded(){return!1}getCurrentWorkspace(){return this.currentWorkspace}getMonacoEditor(){return this.editor.editor}getRightDiv(){return this.rightDiv}getBottomDiv(){return this.bottomDiv}getCurrentlyEditedModule(){return this.projectExplorer.getCurrentlyEditedModule()}getActionManager(){return this.actionManager}getCompiler(){return this.compiler}setModuleActive(e){this.projectExplorer.setModuleActive(e)}getSemicolonAngel(){return this.semicolonAngel}getDatabaseTool(){return this.databaseTool}getDatabaseExplorer(){return this.databaseExplorer}getResultsetPresenter(){return this.resultsetPresenter}getWaitOverlay(){return this.waitOverlay}getHistoryViewer(){return this.historyViewer}initGUI(){matchMedia("(pointer:fine)").matches&&(fe=!0),this.login=new Xe(this),this.login.initGUI(),this.databaseTool=new $e(this),this.databaseExplorer=new it(this,jQuery(".jo_db_tree")),this.actionManager=new ue(null,this),this.actionManager.init(),this.networkManager=new Ee(this,jQuery("#bottomdiv-outer .jo_updateTimerDiv")),new Ve(this).initSliders(),this.mainMenu=new We(this),this.projectExplorer=new Ue(this,jQuery("#leftpanel>.jo_projectexplorer")),this.projectExplorer.initGUI(),this.bottomDiv=new ht(this,jQuery("#bottomdiv-outer>.jo_bottomdiv-inner"),jQuery("body")),this.rightDiv=new Ke(this,jQuery("#rightdiv-inner")),this.rightDiv.initGUI(),this.checkStartupComplete(),this.themeManager=new d,this.viewModeController=new et(jQuery("#view-mode"),this),this.semicolonAngel=new tt(this),new nt(this,jQuery("#controls")),this.resultsetPresenter=new rt(this,jQuery(".jo_bottomdiv-inner")),this.notifier=new ot(this)}initEditor(){this.editor=new Oe(this,!0,!1),(new l).init(),this.editor.initGUI(jQuery("#editor"));let e=this;jQuery(window).on("resize",(t=>{jQuery("#bottomdiv-outer").css("height","450px"),jQuery("#editor").css("height",window.innerHeight-450-30-2+"px"),e.editor.editor.layout(),jQuery("#editor").css("height","")})),jQuery(window).trigger("resize"),this.checkStartupComplete()}initTeacherExplorer(e){this.teacherExplorer=new Ge(this,e),this.teacherExplorer.initGUI()}checkStartupComplete(){this.startupComplete--,0==this.startupComplete&&this.start()}start(){null!=this.waitForGUICallback&&this.waitForGUICallback();let e=this;setTimeout((()=>{e.getMonacoEditor().layout()}),200),this.compiler=new ae(this),this.startTimer(),$(window).on("unload",(function(){navigator.sendBeacon&&null!=e.user&&(e.networkManager.sendUpdates(null,!1),e.networkManager.sendUpdateUserSettings((()=>{})))}))}startTimer(){null!=this.timerHandle&&clearInterval(this.timerHandle);let e=this;this.timerHandle=setInterval((()=>{e.compileIfDirty()}),500)}compileIfDirty(){var e,t;if(null!=this.currentWorkspace&&this.currentWorkspace.moduleStore.isDirty()&&this.compiler.compilerStatus!=se.compiling)try{this.compiler.compile(this.currentWorkspace.moduleStore);let i=null===(t=null===(e=this.bottomDiv)||void 0===e?void 0:e.errorManager)||void 0===t?void 0:t.showErrors(this.currentWorkspace);this.projectExplorer.renderErrorCount(this.currentWorkspace,i),this.editor.onDidChangeCursorPosition(null),this.projectExplorer&&this.version++}catch(e){console.error(e),this.compiler.compilerStatus=se.error}}removeWorkspace(e){this.workspaceList.splice(this.workspaceList.indexOf(e),1)}restoreWorkspaces(e){this.workspaceList=[],this.currentWorkspace=null,this.getMonacoEditor().updateOptions({readOnly:!0});let t=null;for(let i of e.workspaces){let e=_e.restoreFromData(i,this);this.workspaceList.push(e),i.id!=this.user.currentWorkspace_id||i.isFolder||(t=e)}if(this.projectExplorer.renderWorkspaces(this.workspaceList),null==t&&this.workspaceList.length>0)for(let e of this.workspaceList)if(!e.isFolder){t=this.workspaceList[0];break}null!=t&&this.projectExplorer.setWorkspaceActive(t,null,!0),0==this.workspaceList.length&&Ie.showHelper("newDatabaseHelper",this,this.projectExplorer.workspaceListPanel.$captionElement)}createNewWorkspace(e,t){return new _e(e,this,t)}}class dt{constructor(e,t,i){this.main=e,this.$bottomDiv=t,this.$mainDiv=i,this.oldDecorations=[],this.oldErrorDecorations=[],this.minimapColor={},this.lightBulbOnClickFunctionList=[],this.minimapColor.error="#bc1616",this.minimapColor.warning="#cca700",this.minimapColor.info="#75beff",this.$bracket_warning=i.find(".jo_parenthesis_warning"),this.$bracket_warning.attr("title","Klammeralarm!"),this.$bracket_warning.children().attr("title","Klammeralarm!");let n=this;i.find(".jo_pw_undo").on("click",(()=>{n.main.getMonacoEditor().trigger(".","undo",{})})).attr("title","Undo")}showParenthesisWarning(e){null!=e?(this.$bracket_warning.css("visibility","visible"),this.$bracket_warning.find(".jo_pw_heading").text(e)):this.$bracket_warning.css("visibility","hidden")}showErrors(e){this.lightBulbOnClickFunctionList=[];let t=new Map;this.$errorDiv=this.$bottomDiv.find(".jo_tabs>.jo_errorsTab"),this.$errorDiv.empty();let i=!1,n=e.moduleStore,r=this.main.getMonacoEditor();for(let e of n.getModules(!1)){let n=[],o=[],s=[],a=e.getSortedAndFilteredErrors();t.set(e,e.getErrorCount());for(let t of a){let i,a,l,d=this.minimapColor[t.level];switch(t.level){case"error":i="jo_revealErrorLine",a="jo_borderLeftError";break;case"warning":i="jo_revealWarningLine",a="jo_borderLeftWarning";break;case"info":i="jo_revealInfoLine",a="jo_borderLeftInfo"}if(null!=t.quickFix){let n=t.quickFix,o="lb_"+Math.trunc(1e6*Math.random());i="jo_yellowLightBulb "+a+" "+o,this.lightBulbOnClickFunctionList.push({class:"."+o,onClickFunction:()=>{let t=n.editsProvider(e.model.uri);r.executeEdits("",t.map((e=>{let t=e.edit.range;return{range:new monaco.Range(t.startLineNumber,t.startColumn,t.endLineNumber,t.endColumn),text:e.edit.text,forceMoveMarkers:!0}})))},title:n.title})}switch(this.processError(t,e,s),t.level){case"error":l=monaco.MarkerSeverity.Error;break;case"warning":l=monaco.MarkerSeverity.Warning;break;case"info":l=monaco.MarkerSeverity.Info}n.push({startLineNumber:t.position.line,startColumn:t.position.column,endLineNumber:t.position.line,endColumn:t.position.column+t.position.length,message:t.text,severity:l,relatedInformation:t.quickFix}),o.push({range:{startLineNumber:t.position.line,startColumn:t.position.column,endLineNumber:t.position.line,endColumn:t.position.column+t.position.length},options:{linesDecorationsClassName:i,minimap:{position:monaco.editor.MinimapPosition.Inline,color:d}}})}if(monaco.editor.setModelMarkers(e.model,"test",n),e.oldErrorDecorations=e.model.deltaDecorations(e.oldErrorDecorations,o),this.oldDecorations=this.main.getMonacoEditor().deltaDecorations(this.oldDecorations,[]),s.length>0&&this.$errorDiv.length>0){i=!0;let t=jQuery('<div class="jo_error-filename">'+e.file.name+"&nbsp;</div>");this.$errorDiv.append(t);for(let e of s)this.$errorDiv.append(e)}}return!i&&this.$errorDiv.length>0&&this.$errorDiv.append(jQuery('<div class="jo_noErrorMessage">Keine Fehler gefunden :-)</div>')),this.registerLightbulbOnClickFunctions(),t}registerLightbulbOnClickFunctions(){let e=this;setTimeout((()=>{for(let t of e.lightBulbOnClickFunctionList)jQuery(t.class).off("click",t.onClickFunction),jQuery(t.class).on("click",t.onClickFunction).attr("title",t.title)}),500)}processError(e,t,i){let n=jQuery('<div class="jo_error-line"></div>'),r=jQuery('<span class="jo_error-position">[Z&nbsp;<span class="jo_linecolumn">'+e.position.line+'</span> Sp&nbsp;<span class="jo_linecolumn">'+e.position.column+"</span>]</span>:&nbsp;"),o="";switch(e.level){case"error":break;case"warning":o='<span class="jo_warning_category">Warnung: </span>';break;case"info":o='<span class="jo_info_category">Info: </span>'}let s=jQuery('<div class="jo_error-text">'+o+e.text+"</div>");n.append(r).append(s);let a=this;n.on("mousedown",(i=>{this.$errorDiv.find(".jo_error-line").removeClass("jo_active"),n.addClass("jo_active"),a.showError(t,e)})),i.push(n)}showError(e,t){this.main instanceof lt&&e!=this.main.projectExplorer.getCurrentlyEditedModule()&&this.main.projectExplorer.setModuleActive(e);let i=t.position,n={startColumn:i.column,startLineNumber:i.line,endColumn:i.column+i.length,endLineNumber:i.line};this.main.getMonacoEditor().revealRangeInCenter(n);let r="";switch(t.level){case"error":r="jo_revealError";break;case"warning":r="jo_revealWarning";break;case"info":r="jo_revealInfo"}this.oldDecorations=this.main.getMonacoEditor().deltaDecorations(this.oldDecorations,[{range:n,options:{className:r}}])}}class ut{constructor(e,t){this.main=e,this.$bottomDiv=t,this.showRevisionActive=!1,this.$homeworkTab=t.find(".jo_tabs>.jo_homeworkTab")}initGUI(){let e=this;this.$homeworkTab.append(this.$homeworkTabLeft=pe("","jo_homeworkTabLeft jo_scrollable")),this.$homeworkTab.append(this.$homeworkTabRight=pe("","jo_homeworkTabRight jo_scrollable")),jQuery("#view-mode").prepend(this.$showRevisionButton=pe("","jo_button jo_active jo_homeworkRevisionButton","")),this.$showRevisionButton.on("click",(()=>{this.showRevisionActive?this.hideRevision():this.showRevision(e.main.getCurrentlyEditedModule())})),this.$showRevisionButton.hide(),jQuery("#diffEditor").hide()}showHomeWorkRevisionButton(){this.$showRevisionButton.text(this.showRevisionActive?"Normalansicht":"Korrekturen zeigen"),this.$showRevisionButton.show()}hideHomeworkRevisionButton(){this.$showRevisionButton.hide()}showRevision(e){e.file.text=e.getProgramTextFromMonacoModel();let t=e.file;jQuery("#editor").hide(),jQuery("#diffEditor").show();var i=monaco.editor.createModel(t.text_before_revision,"myJava"),n=monaco.editor.createModel(t.text,"myJava");this.diffEditor=monaco.editor.createDiffEditor(document.getElementById("diffEditor"),{enableSplitViewResizing:!0,originalEditable:!1,readOnly:!0,renderSideBySide:!0}),this.diffEditor.setModel({original:i,modified:n}),this.showRevisionActive=!0,this.showHomeWorkRevisionButton()}hideRevision(){this.showRevisionActive&&(jQuery("#diffEditor").hide(),this.diffEditor.dispose(),this.diffEditor=null,jQuery("#editor").show(),this.showRevisionActive=!1,this.showHomeWorkRevisionButton())}attachToWorkspaces(e){let t=[],i={};e.forEach((e=>{e.moduleStore.getModules(!1).forEach((n=>{let r=n.file.submitted_date;if(null!=r){let o=function(e){let t=e.match(/^(\d{2})\.(\d{2})\.(\d{4}), (\d{2}):(\d{2})$/);return new Date(Number.parseInt(t[3]),Number.parseInt(t[2]),Number.parseInt(t[1]),Number.parseInt(t[4]),Number.parseInt(t[5]))}(r),s=function(e){return`${ie(e.getDate())}.${ie(e.getMonth())}.${e.getFullYear()}`}(o),a=i[s];null==a&&(a={date:o,day:s,modules:[]},i[s]=a,t.push(a)),a.modules.push({module:n,workspace:e})}}))})),this.$homeworkTabLeft.empty(),this.$homeworkTabRight.empty();let n=this;this.$homeworkTabLeft.append(pe("","jo_homeworkHeading","Abgabetage:")),t.sort(((e,t)=>e.date.getFullYear()!=t.date.getFullYear()?-Math.sign(e.date.getFullYear()-t.date.getFullYear()):e.date.getMonth()!=t.date.getMonth()?-Math.sign(e.date.getMonth()-t.date.getMonth()):e.date.getDate()!=t.date.getDate()?-Math.sign(e.date.getDate()-t.date.getDate()):0));let r=!0;t.forEach((e=>{e.modules.sort(((e,t)=>e.module.file.name.localeCompare(t.module.file.name)));let t=pe("","jo_homeworkDate",e.day);this.$homeworkTabLeft.append(t),t.on("click",(i=>{this.$homeworkTabLeft.find(".jo_homeworkDate").removeClass("active"),t.addClass("jo_active"),n.select(e)})),r&&(r=!1,t.addClass("jo_active"),n.select(e))}))}select(e){this.$homeworkTabRight.empty(),this.$homeworkTabRight.append(pe("","jo_homeworkHeading","Abgegebene Dateien:"));let t=this;e.modules.forEach((e=>{let i=jQuery(`<div class="jo_homeworkEntry">Workspace <span class="jo_homework-workspace">\n                    ${e.workspace.name}</span>, Datei <span class="jo_homework-file">\n                    ${e.module.file.name}</span> (Abgabe: ${e.module.file.submitted_date} )</div>`);t.$homeworkTabRight.append(i),i.on("click",(()=>{t.main.projectExplorer.setWorkspaceActive(e.workspace),t.main.projectExplorer.setModuleActive(e.module),t.main.projectExplorer.fileListPanel.select(e.module,!1)}))}))}}class ht{constructor(e,t,i){this.main=e,this.$bottomDiv=t,this.$mainDiv=i,this.$bottomDiv.find(".jo_tabheadings>.jo_homeworkTabheading").length>0&&(this.homeworkManager=new ut(e,t)),this.errorManager=new dt(e,t,i)}initGUI(){me(this.$bottomDiv),null!=this.homeworkManager&&this.homeworkManager.initGUI(),this.$bottomDiv.find(".jo_tabs").children().first().trigger("click")}showHomeworkTab(){jQuery(".jo_homeworkTabheading").css("visibility","visible"),jQuery(".jo_homeworkTabheading").trigger("mousedown")}hideHomeworkTab(){jQuery(".jo_homeworkTabheading").css("visibility","hidden"),jQuery(".jo_tabheadings").children().first().trigger("mousedown")}}class ct{constructor(e,t,i,n,r){this.$container=e,this.firstLast=t,this.horVert=i,this.callback=n,this.$otherDiv=r,this.initSlider()}initSlider(){let e=this;null==this.$otherDiv&&this.$container.parent().children().each(((t,i)=>{i!=this.$container[0]&&(e.$otherDiv=jQuery(i))})),this.$sliderDiv=jQuery('<div class="joe_slider"></div>'),this.$sliderDiv.css({width:this.horVert?"100%":"4px",height:this.horVert?"4px":"100%",cursor:this.horVert?"row-resize":"col-resize"}),this.firstLast?this.$sliderDiv.css({top:"0px",left:"0px"}):this.horVert?this.$sliderDiv.css({bottom:"0px",left:"0px"}):this.$sliderDiv.css({top:"0px",right:"0px"}),this.$container.append(this.$sliderDiv),this.$sliderDiv.on("mousedown",(t=>{let i=t.clientX,n=t.clientY;jQuery(document).on("mousemove.slider",(t=>{let r=t.clientX-i,o=t.clientY-n;e.slide(r,o),i=t.clientX,n=t.clientY})),jQuery(document).on("mouseup.slider",(()=>{jQuery(document).off("mousemove.slider"),jQuery(document).off("mouseup.slider")}))})),setTimeout((()=>{e.slide(1,1)}),600)}setColor(e){this.$sliderDiv.css("background-color",e)}slide(e,t){if(this.horVert){let e=Number.parseInt(this.$container.css("height").replace("px","")),i=Number.parseInt(this.$otherDiv.css("height").replace("px","")),n=this.firstLast?e-=t:e+=t,r=this.firstLast?i+=t:i-=t;this.$container.css("height",n+"px"),this.$otherDiv.css("height",r+"px"),this.callback(n)}else{let t=Number.parseInt(this.$container.css("width").replace("px","")),i=Number.parseInt(this.$otherDiv.css("width").replace("px","")),n=this.firstLast?t-=e:t+=e,r=this.firstLast?i+=e:i-=e;this.$container.css("width",n+"px"),this.$otherDiv.css("width",r+"px"),this.callback(n)}this.$container.css("flex","0 1 auto")}}class mt{constructor(e,t,i){this.moduleStore=e,this.$fileListDiv=t,this.main=i,this.files=[];let n=this;for(let t of e.getModules(!1))this.addModule(t);let r=t.parent(),o=jQuery('<div class="joe_addFileButton jo_button img_add-dark jo_active" title="Datei hinzufügen"></div>');r.append(o),o.on("click",(()=>{let e=this.main.addModule({text:"",title:"Neue Datei.java",type:"sql"}),t=this.addModule(e);this.renameElement(t,(()=>{n.currentFile!=t&&n.selectFile(t)}))}))}removeAllFiles(){this.files.forEach((e=>this.removeFile(e)))}addHint(e){let t=this,i=jQuery('<div class="jo_file jo_hint" ><div class="jo_fileimage"></div><div class="jo_filename" style="line-height: 22px">'+e.title+'</div><div class="jo_additionalButtons"></div></div></div>');this.$fileListDiv.append(i);let n={module:null,$fileDiv:i,type:"hint",hint:e.text};this.files.push(n),i.on("click",(e=>{t.selectFile(n)}))}addModule(e){let t=this,i=jQuery(`<div class="jo_file jo_java" >\n        <div class="jo_fileimage"></div>\n        <div class="jo_filename" style="line-height: 22px">${e.file.name}</div>\n        <div class="jo_additionalButtonStart"></div>\n        <div class="jo_delete img_delete jo_button jo_active" title="Datei löschen"></div></div></div>`);this.$fileListDiv.append(i);let n={module:e,$fileDiv:i,type:"sql"};return this.files.push(n),e.file.panelElement={name:e.file.name,$htmlFirstLine:i,isFolder:!1,path:[]},i.find(".jo_delete").on("mousedown",(e=>{t.onDelete(n,e)})),i.find(".jo_delete").on("click",(e=>{e.preventDefault(),e.stopPropagation()})),i.on("click",(e=>{t.selectFile(n)})),i[0].addEventListener("contextmenu",(function(e){e.preventDefault(),ce([{caption:"Umbenennen",callback:()=>{t.renameElement(n,(()=>{}))}}],e.pageX,e.pageY)}),!1),n}onDelete(e,t){t.preventDefault(),t.stopPropagation();let i=this;ce([{caption:"Abbrechen",callback:()=>{}},{caption:"Ich bin mir sicher: löschen!",color:"#ff6060",callback:()=>{i.removeFile(e)}}],t.pageX+2,t.pageY+2)}removeFile(e){e.$fileDiv.remove(),this.main.removeModule(e.module),this.files=this.files.filter((t=>t!=e)),this.currentFile==e&&(this.files.length>0?this.selectFile(this.files[0]):(this.main.getMonacoEditor().setValue("Keine Datei vorhanden."),this.main.getMonacoEditor().updateOptions({readOnly:!0}))),this.files.forEach((e=>{null!=e.module&&(e.module.file.saved=!1)}))}removeModule(e){for(let t of this.files)t.module==e&&this.removeFile(t)}renameElement(e,t){let i=e.$fileDiv.find(".jo_filename"),n=e.module.file.name.indexOf(".");he(i,i,(n=>{e.module.file.name=n,i.html(n),null!=t&&t()}),null==n?null:{start:0,end:n})}setFirstFileActive(){this.files.length>0&&this.selectFile(this.files[0])}selectFile(e){if(null!=e)switch(e.type){case"sql":this.main.$hintDiv.hide(),this.main.$monacoDiv.show(),this.main.setModuleActive(e.module),this.main.getMonacoEditor().focus();break;case"hint":this.main.$monacoDiv.hide(),this.main.$hintDiv.show();let t={},i=[],n=window.markdownit({highlight:function(e,t){return i.push(e),""}});n.renderer.rules.code_inline=function(e,t,n,r,o){var s=e[t];return i.push(s.content),""},n.render(e.hint),this.colorize(i,t,(()=>{let i=window.markdownit({highlight:function(e,i){return t[e]}});i.renderer.rules.code_inline=function(e,i,n,r,o){var s=e[i];return t[s.content].replace("<br/>","")};let n=i.render(e.hint);this.main.$hintDiv.html(n)})),this.$fileListDiv.find(".jo_file").removeClass("jo_active"),e.$fileDiv.addClass("jo_active")}}colorize(e,t,i){let n=this;if(e.length>0){let r=e.pop();monaco.editor.colorize(r,"myJava",{tabSize:3}).then((o=>{t[r]=o,n.colorize(e,t,i)}))}else i()}markFile(e){this.$fileListDiv.find(".jo_file").removeClass("jo_active"),this.currentFile=this.files.find((t=>t.module==e)),null!=this.currentFile&&this.currentFile.$fileDiv.addClass("jo_active")}}class pt{constructor(e){this.databaseIdentifier=e}open(e){if(window.indexedDB){let t=window.indexedDB.open(this.databaseIdentifier,1),i=this;t.onerror=function(e){console.log("Couldn't open IndexedDB: "+e.type)},t.onsuccess=function(n){i.db=t.result,i.db.onerror=function(e){console.log("Datenbankfehler: "+e.target.error.message)},e()},t.onupgradeneeded=function(e){i.db=e.target.result;let t=i.db.createObjectStore("scripts",{keyPath:"scriptId",autoIncrement:!1});t.transaction.oncomplete=function(e){},i.db.createObjectStore("databases",{keyPath:"databaseId",autoIncrement:!1}),t.transaction.oncomplete=function(e){}}}else console.log("IndexedDB not available.")}writeScript(e,t){this.db.transaction("scripts","readwrite").objectStore("scripts").put({scriptId:e,script:t})}removeScript(e){this.db.transaction("scripts","readwrite").objectStore("scripts").delete(e)}getScript(e,t){let i=this.db.transaction("scripts","readwrite").objectStore("scripts").get(e);i.onerror=e=>{t(null)},i.onsuccess=e=>{null==i.result?t(null):t(i.result.script)}}writeDatabase(e,t){this.db.transaction("databases","readwrite").objectStore("databases").put({databaseId:e,database:t})}removeDatabase(e){this.db.transaction("databases","readwrite").objectStore("databases").delete(e)}getDatabase(e,t){let i=this.db.transaction("databases","readwrite").objectStore("databases").get(e);i.onerror=e=>{t(null)},i.onsuccess=e=>{null==i.result?t(null):t(i.result.database)}}}class ft{constructor(e,t){this.main=e,this.databaseIdentifier=t,this.statementsToExecute=[],this.writtenStatements=[],this.statementsToWrite=[],this.atLeastOneExecuted=!1}indexedDBReady(e){this.indexedDB=e,this.indexedDB.getDatabase(this.databaseIdentifier,(e=>{null!=e&&(this.writtenStatements=JSON.parse(e),this.statementsToExecute=this.writtenStatements.slice(),this.main.historyViewer.clear(),this.main.historyViewer.appendStatements(this.statementsToExecute),this.executeStatements(),this.writeStatementsIfNecessary())}))}reset(){this.statementsToWrite=[],this.writtenStatements=[],this.statementsToExecute=[],this.main.historyViewer.clear(),this.forceWriteStatements()}writeStatementsIfNecessary(){null!=this.indexedDB&&this.statementsToWrite.length>0&&this.forceWriteStatements()}forceWriteStatements(){this.writtenStatements=this.writtenStatements.concat(this.statementsToWrite),this.statementsToWrite=[],this.indexedDB.writeDatabase(this.databaseIdentifier,JSON.stringify(this.writtenStatements))}executeStatements(){if(null!=this.databaseTool&&this.statementsToExecute.length>0){this.atLeastOneExecuted||(this.main.$databaseResetButton.fadeIn(200),this.count=this.statementsToExecute.length,this.main.waitOverlay.show("Schreibe lokale Datenbankänderungen ...")),this.main.waitOverlay.setProgress(Math.round(100*(1-this.statementsToExecute.length/this.count))+" %");let e=this.statementsToExecute.shift();this.atLeastOneExecuted=!0,this.databaseTool.executeQuery(e,(()=>{this.executeStatements()}),(()=>{this.executeStatements()}))}else this.atLeastOneExecuted&&(this.main.databaseExplorer.refresh(),this.atLeastOneExecuted=!1,this.main.waitOverlay.hide())}notify(e){this.main.$databaseResetButton.fadeIn(200);let t=e.map((e=>null==e.sqlCleaned?e.sql:e.sqlCleaned));this.statementsToWrite=this.statementsToWrite.concat(t),this.main.historyViewer.appendStatements(t),this.writeStatementsIfNecessary()}databaseReady(e){this.databaseTool=e,this.executeStatements()}rollback(){this.writeStatementsIfNecessary(),this.writtenStatements.pop(),this.forceWriteStatements()}}var gt=function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};class bt{constructor(e){this.main=e}load(e){return gt(this,void 0,void 0,(function*(){let t,i=e.replace("https://","").replace("http://","").toLocaleLowerCase(),n=i.toLocaleLowerCase(),r=yield this.fetchTemplateFromCache(i);return null!=r?("binaryCompressed"==$e.getDumpType(r)&&(r=pako.inflate(r)),{binDump:r}):(n.endsWith(".sqlite")?t=yield this.loadSqLiteDump(e,i):(n.endsWith(".zip")||n.endsWith(".sql"))&&(t=yield this.loadMySql(e,i)),this.saveDatabaseToCache(i,t.binDump),t)}))}loadMySql(e,t){return new Fe(this.main).loadFromUrl(e)}loadSqLiteDump(e,t){return gt(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{jQuery.ajax({type:"GET",async:!0,url:e,xhrFields:{responseType:"arraybuffer"},success:function(e){let i=new Uint8Array(e);"binaryCompressed"==$e.getDumpType(i)&&(i=pako.inflate(i)),t({binDump:i})},error:function(e,t){i(t)}})}))}))}cutSqlToStatements(e){let t=[];return t=(e=e.replace(/\r\n/g,"\n")).indexOf("~@~")>=0?e.split("~@~"):e.split(";\n"),t}fetchTemplateFromCache(e){return gt(this,void 0,void 0,(function*(){if(null==e)return null;if(!this.cacheAvailable())return null;let t=yield caches.open("my-cache"),i=yield t.match(e);if(null==i)return null;let n=yield i.arrayBuffer();return new Uint8Array(n)}))}saveDatabaseToCache(e,t){return gt(this,void 0,void 0,(function*(){this.cacheAvailable()&&(yield caches.open("my-cache")).put(e,new Response(t))}))}cacheAvailable(){return"caches"in self}}class wt{isEmbedded(){return!0}getCompiler(){return this.compiler}getCurrentWorkspace(){return this.currentWorkspace}getMonacoEditor(){return this.editor.editor}getRightDiv(){return this.rightDiv}getBottomDiv(){return this.bottomDiv}getActionManager(){return this.actionManager}getCurrentlyEditedModule(){var e;return this.config.withFileList?null===(e=this.fileExplorer.currentFile)||void 0===e?void 0:e.module:this.currentWorkspace.moduleStore.getFirstModule()}getDatabaseTool(){return this.databaseTool}getDatabaseExplorer(){return this.databaseExplorer}getResultsetPresenter(){return this.resultsetPresenter}getWaitOverlay(){return this.waitOverlay}getHistoryViewer(){return this.historyViewer}constructor(e,t){this.scriptList=t,this.programPointerDecoration=[],this.programIsExecutable=!1,this.version=0,this.compileRunsAfterCodeReset=0,this.readConfig(e),this.writeQueryManager=new ft(this,(null==this.config.databaseURL?"Empty database":this.config.databaseURL)+this.config.id),this.initGUI(e),this.databaseExplorer=new it(this,this.$dbTreeDiv),this.databaseTool=new $e(this),null!=this.config.databaseURL?new bt(this).load(this.config.databaseURL).then((e=>{this.initialTemplateDump=e.binDump,this.initialStatements=null==e.statements?[]:e.statements,this.initDatabase()})).catch((e=>{alert("Fehler beim Landen der Datenbank: "+e)})):this.initDatabase(),this.semicolonAngel=new tt(this)}initDatabase(){this.resetDatabase((()=>{this.initScripts(),this.indexedDB=new pt("SQL-IDE"),this.indexedDB.open((()=>{null!=this.config.id&&(this.writeQueryManager.indexedDBReady(this.indexedDB),this.readScripts())}))}))}resetDatabase(e){this.databaseTool.initializeWorker(this.initialTemplateDump,this.initialStatements,(()=>{}),(()=>{this.writeQueryManager.databaseReady(this.databaseTool),this.databaseExplorer.refreshAfterRetrievingDBStructure(),e()}))}initScripts(){var e;null===(e=this.fileExplorer)||void 0===e||e.removeAllFiles(),this.initWorkspace(this.scriptList),this.config.withFileList?(this.fileExplorer=new mt(this.currentWorkspace.moduleStore,this.$filesListDiv,this),this.fileExplorer.setFirstFileActive(),this.scriptList.filter((e=>"hint"==e.type)).forEach((e=>this.fileExplorer.addHint(e)))):this.setModuleActive(this.currentWorkspace.moduleStore.getFirstModule())}readConfig(e){let t=e.data("sql-online");this.config=null!=t&&"string"==typeof t?JSON.parse(t.split("'").join('"')):{},null==this.config.withFileList&&(this.config.withFileList=!1),null==this.config.withOutput&&(this.config.withOutput=!0),null==this.config.withErrorList&&(this.config.withErrorList=!0),null==this.config.withBottomPanel&&(this.config.withBottomPanel=!0),this.config.withOutput||this.config.withFileList||this.config.withErrorList||(this.config.withBottomPanel=!1),this.config.withBottomPanel||(this.config.withFileList=!1,this.config.withOutput=!1,this.config.withErrorList=!1),null!=this.config.databaseURL&&["http:","https:"].forEach((e=>{this.config.databaseURL.startsWith(e)&&!this.config.databaseURL.startsWith(e+"://")&&(this.config.databaseURL=this.config.databaseURL.replace(e,e+"//"))}))}setModuleActive(e){this.config.withFileList&&null!=this.fileExplorer.currentFile&&(this.fileExplorer.currentFile.module.editorState=this.getMonacoEditor().saveViewState()),this.config.withFileList&&this.fileExplorer.markFile(e),this.getMonacoEditor().updateOptions({readOnly:!1,lineNumbersMinChars:4}),this.editor.editor.setModel(e.model),null!=e.editorState&&this.getMonacoEditor().restoreViewState(e.editorState)}readScripts(){let e=this.currentWorkspace.moduleStore.getModules(!1),t=this;this.indexedDB.getScript(this.config.id,(i=>{var n;if(null==i)setInterval((()=>{t.saveScripts()}),1e3);else{let r=JSON.parse(i),o=r.length;for(let i of e)null===(n=t.fileExplorer)||void 0===n||n.removeModule(i),t.removeModule(i);for(let e of r){let i=this.config.id+e;this.indexedDB.getScript(i,(i=>{var n,r;if(null!=i){let r=t.addModule({title:e,text:i,type:"sql"});null===(n=t.fileExplorer)||void 0===n||n.addModule(r),t.$codeResetButton.fadeIn(1e3)}if(o--,0==o&&(setInterval((()=>{t.saveScripts()}),1e3),null===(r=t.fileExplorer)||void 0===r||r.setFirstFileActive(),null==t.fileExplorer)){let e=t.currentWorkspace.moduleStore.getModules(!1);e.length>0&&t.setModuleActive(e[0])}}))}}}))}saveScripts(){let e=this.currentWorkspace.moduleStore.getModules(!1),t=[],i=!1;if(e.forEach((e=>i=i||!e.file.saved)),i){for(let i of e){t.push(i.file.name);let e=this.config.id+i.file.name;this.indexedDB.writeScript(e,i.getProgramTextFromMonacoModel()),i.file.saved=!0}this.indexedDB.writeScript(this.config.id,JSON.stringify(t))}}deleteScriptsInDB(){this.indexedDB.getScript(this.config.id,(e=>{if(null!=e){let t=JSON.parse(e);for(let e of t){let t=this.config.id+e;this.indexedDB.removeScript(t)}this.indexedDB.removeScript(this.config.id)}}))}initWorkspace(e){this.currentWorkspace=new _e("Embedded-Workspace",this,0);for(let t of e)"sql"==t.type&&this.addModule(t)}addModule(e){let t=le.restoreFromData({id:this.currentWorkspace.moduleStore.getModules(!0).length,name:e.title,text:e.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:1,workspace_id:0,forceUpdate:!1,file_type:11},this);this.currentWorkspace.moduleStore.putModule(t);let i=this;return t.model.onDidChangeContent((()=>{i.considerShowingCodeResetButton()})),t}removeModule(e){this.currentWorkspace.moduleStore.removeModule(e)}initGUI(e){e.css({"background-image":"none","background-size":"100%"});let t=jQuery('<div class="joe_centerDiv"></div>');e.append(t);let i=this.makeWaitDiv();e.append(i),this.waitOverlay=new st(i);let n=this.makeCodeResetModalWindow(e),r=this.makeDatabaseResetModalWindow(e),o=this.makeRightDiv(),s=jQuery('<div class="joe_editorDiv"></div>');this.$monacoDiv=jQuery('<div class="joe_monacoDiv"></div>'),this.$hintDiv=jQuery('<div class="joe_hintDiv jo_scrollable"></div>'),this.$codeResetButton=jQuery('<div class="joe_codeResetButton jo_button jo_active" title="Code auf Ausgangszustand zurücksetzen">Code Reset</div>'),this.$databaseResetButton=jQuery('<div class="joe_databaseResetButton jo_button jo_active" title="Datenbank auf Ausgangszustand zurücksetzen">Datenbank Reset</div>'),s.append(this.$monacoDiv,this.$hintDiv,this.$databaseResetButton),this.$monacoDiv.append(this.$codeResetButton);let a=this.makeBracketErrorDiv();s.append(a),this.$codeResetButton.hide(),this.$codeResetButton.on("click",(()=>{n.show()})),this.$databaseResetButton.hide(),this.$databaseResetButton.on("click",(()=>{r.show()})),this.$hintDiv.hide();let l=jQuery('<div class="joe_controlsDiv"></div>'),d=jQuery('<div class="joe_bottomDivInner"></div>'),u=jQuery('<div class="joe_bottomDiv"></div>');if(this.makeBottomDiv(d,l),u.append(d),this.config.withFileList){let e=this.makeFilesDiv();u.prepend(e),new ct(e,!1,!1,(()=>{}))}me(d),e.append(u),e.addClass("joe_javaOnlineDiv"),this.editor=new Oe(this,!1,!0),this.editor.initGUI(this.$monacoDiv),this.$monacoDiv.find(".monaco-editor").css("z-index","10"),null==e.attr("tabindex")&&e.attr("tabindex","0"),this.actionManager=new ue(e,this),this.actionManager.init(),this.bottomDiv=new ht(this,d,e),this.bottomDiv.initGUI(),this.rightDiv=new Ke(this,this.$rightDivInner),this.rightDiv.initGUI(),t.append(s,u),e.append(o);let h=jQuery('<div class="jo_rightdiv-rightside-container"></div>'),c=jQuery('<div class="jo_button jo_active img_ellipsis-dark" style="margin-right: 10px"></div>');l.append(c),this.$rightDivInner.append(h),new ct(o,!0,!1,(()=>{this.editor.editor.layout()}),t),new ct(u,!0,!0,(()=>{this.editor.editor.layout()})),c.on("mouseup",(e=>{e.preventDefault(),e.stopPropagation(),ce([{caption:"Über die Online-IDE ...",link:"https://learnj.de",callback:()=>{}}],e.pageX+2,e.pageY+2)}));let m=jQuery('<label type="file" class="img_open-file jo_button jo_active"style="margin-right: 8px;" title="Datenbank-Dump aus Datei laden"><input type="file" style="display:none"></label>'),p=this,f=m.find("input");f.on("change",(e=>{var t=e.originalEvent.target.files;p.loadDatabaseFromFile(t[0]).then((()=>{f.val(null)}))}));let g=jQuery('<div class="img_save-dark jo_button jo_active"style="margin-right: 8px;" title="Datenbank-Dump in Datei speichern"></div>');g.on("click",(()=>{p.saveDatabaseToFile()})),l.append(m,g),this.resultsetPresenter=new rt(this,d),this.resultsetPresenter.addWriteQueryListener(this.writeQueryManager),new nt(this,l),this.historyViewer=new at(this,e.find(".jo_historyTab")),setTimeout((()=>{this.editor.editor.layout(),this.compiler=new ae(this),this.startTimer()}),200)}saveDatabaseToFile(){(new Qe).saveToFile(this.databaseTool)}loadDatabaseFromFile(e){return t=this,i=void 0,r=function*(){let t=new Qe,i=yield t.loadFromFile(e,this);null!=i?this.databaseTool.initializeWorker(i.binDump,[],(e=>{e.length>0&&(alert("Es sind Fehler beim Import aufgetreten. Ausführliche Fehlermeldungen sehen Sie in der Konsole (F12)."),console.log(e))}),(()=>{this.databaseExplorer.refreshAfterRetrievingDBStructure()})):alert("Es ist ein Fehler beim Import aufgetreten.")},new((n=void 0)||(n=Promise))((function(e,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,a)}l((r=r.apply(t,i||[])).next())}));var t,i,n,r}makeWaitDiv(){let e=(null==window.javaOnlineDir?"":window.javaOnlineDir)+"assets/projectexplorer/svg-loaders/grid.svg";return jQuery(`\n        <div class="bitteWarten">\n        <div style="margin-bottom: 30px">\n            <div class="bitteWartenText" style="font-size: 20px"></div>\n        </div>\n        <div>\n            <img src="${e}" alt="" style="height: 40px">\n        </div>\n        <div class="bitteWartenProgress" style="font-size: 20px"></div>\n        </div>\n        `)}makeBracketErrorDiv(){return jQuery('\n        <div class="jo_parenthesis_warning" title="Klammerwarnung!" style="bottom: 55px">\n        <div class="jo_warning_light"></div>\n        <div class="jo_pw_heading">{ }</div>\n        <div title="Letzten Schritt rückgängig" \n            class="jo_pw_undo img_undo jo_button jo_active"></div>\n        </div>\n        ')}makeCodeResetModalWindow(e){let t=jQuery('\n            <div class="joe_codeResetModal">\n            <div style="flex: 1"></div>\n            <div style="display: flex">\n                <div style="flex: 1"></div>\n                <div style="padding-left: 30px;">\n                <div style="color: red; margin-bottom: 10px; font-weight: bold">Warnung:</div>\n                <div>Soll der Code wirklich auf den Ausgangszustand zurückgesetzt werden?</div>\n                <div>Alle von Dir gemachten Änderungen werden damit verworfen.</div>\n                </div>\n                <div style="flex: 1"></div>\n            </div>\n            <div class="joe_codeResetModalButtons">\n            <div class="joe_codeResetModalCancel jo_button jo_active">Abbrechen</div>\n            <div class="joe_codeResetModalOK jo_button jo_active">OK</div>\n            </div>\n            <div style="flex: 2"></div>\n            </div>\n        ');return t.hide(),e.append(t),e.find(".joe_codeResetModalCancel").on("click",(()=>{t.hide()})),e.find(".joe_codeResetModalOK").on("click",(()=>{this.initScripts(),this.deleteScriptsInDB(),t.hide(),this.$codeResetButton.hide(),this.compileRunsAfterCodeReset=1})),t}makeDatabaseResetModalWindow(e){let t=jQuery('\n            <div class="joe_databaseResetModal">\n            <div style="flex: 1"></div>\n            <div style="display: flex">\n                <div style="flex: 1"></div>\n                <div style="padding-left: 30px;">\n                <div style="color: red; margin-bottom: 10px; font-weight: bold">Warnung:</div>\n                <div>Soll die Datenbank wirklich auf den Ausgangszustand zurückgesetzt werden?</div>\n                <div>Alle bisher ausgeführten Anweisungen (siehe Tab Write History) werden dann rückgängig gemacht.</div>\n                </div>\n                <div style="flex: 1"></div>\n            </div>\n            <div class="joe_databaseResetModalButtons">\n            <div class="joe_databaseResetModalCancel jo_button jo_active">Abbrechen</div>\n            <div class="joe_databaseResetModalOK jo_button jo_active">OK</div>\n            </div>\n            <div style="flex: 2"></div>\n            </div>\n        ');return t.hide(),e.append(t),e.find(".joe_databaseResetModalCancel").on("click",(()=>{t.hide()})),e.find(".joe_databaseResetModalOK").on("click",(()=>{t.hide(),this.resetDatabase((()=>{this.writeQueryManager.reset()})),this.$databaseResetButton.hide(),this.compileRunsAfterCodeReset=1})),t}makeFilesDiv(){let e=jQuery('<div class="joe_bottomDivFiles jo_scrollable"></div>'),t=jQuery('<div class="joe_filesHeader jo_tabheading jo_active"  style="line-height: 24px">Dateien</div>');return this.$filesListDiv=jQuery('<div class="joe_filesList jo_scrollable"></div>'),e.append(t,this.$filesListDiv),e}startTimer(){null!=this.timerHandle&&clearInterval(this.timerHandle);let e=this;this.timerHandle=setInterval((()=>{e.compileIfDirty()}),500)}compileIfDirty(){var e,t;if(null!=this.currentWorkspace&&this.currentWorkspace.moduleStore.isDirty()&&this.compiler.compilerStatus!=se.compiling&&null!=this.getDatabaseTool().databaseStructure)try{this.compiler.compile(this.currentWorkspace.moduleStore),null===(t=null===(e=this.bottomDiv)||void 0===e?void 0:e.errorManager)||void 0===t||t.showErrors(this.currentWorkspace),this.editor.onDidChangeCursorPosition(null),this.version++}catch(e){console.error(e),this.compiler.compilerStatus=se.error}}considerShowingCodeResetButton(){this.compileRunsAfterCodeReset++,3==this.compileRunsAfterCodeReset&&this.$codeResetButton.fadeIn(1e3)}makeBottomDiv(e,t){let i=jQuery('<div class="jo_tabheadings"></div>');i.css("position","relative");let n=jQuery('<div class="joe_tabheading-right jo_noHeading joe_controlsTabheading"></div>');if(n.append(t),i.append(n),this.config.withErrorList){let e=jQuery('<div class="jo_tabheading jo_active" data-target="jo_errorsTab" style="line-height: 24px">Fehler</div>');i.append(e)}if(this.config.withOutput){let e=jQuery('<div class="jo_tabheading jo_resultTabheading" data-target="jo_resultTab" style="line-height: 24px">Ausgabe</div>');i.append(e)}let r=jQuery('<div class="jo_tabheading jo_historyTabheading" data-target="jo_historyTab" style="line-height: 24px">History</div>');i.append(r);let o=jQuery('<div class="joe_tabheading-right jo_noHeading joe_paginationHeading"><div class="jo_pagination"></div></div>');i.append(o),e.append(i);let s=jQuery('<div class="jo_tabs jo_scrollable"></div>');if(this.config.withErrorList){let e=jQuery('<div class="jo_active jo_scrollable jo_errorsTab"></div>');s.append(e)}if(this.config.withOutput){let e=jQuery('<div class="jo_editorFontSize jo_resultTab">\n            <div class="jo_result-inner">\n                <div class="jo_result-header"></div>\n                <div class="jo_scrollable jo_result-body"></div>\n            </div>\n            </div>\n    ');s.append(e)}let a=jQuery('<div class="jo_scrollable jo_historyTab"></div>');s.append(a),e.append(s)}makeRightDiv(){let e=jQuery('<div class="joe_rightDiv"></div>');this.$rightDivInner=jQuery('<div class="joe_rightDivInner"></div>'),e.append(this.$rightDivInner);let t=jQuery('<div class="jo_tabheadings"></div>');t.css("position","relative");let i=jQuery('<div class="jo_tabheading jo_active" data-target="jo_db_tree" style="line-height: 24px">DB (Baum)</div>');t.append(i),this.$rightDivInner.append(t);let n=jQuery('<div class="jo_tabs jo_scrollable"></div>');return this.$dbTreeDiv=jQuery('<div class="jo_tab jo_scrollable jo_editorFontSize jo_active jo_db_tree">DB-Baum</div>'),n.append(this.$dbTreeDiv),this.$rightDivInner.append(n),me(e),e}getSemicolonAngel(){return this.semicolonAngel}}class kt{constructor(){this.startupComplete=2,this.mainEmbeddedList=[]}initGUI(){this.checkStartupComplete(),this.themeManager=new d}initEditor(){(new l).init(),this.checkStartupComplete()}checkStartupComplete(){this.startupComplete--,0==this.startupComplete&&this.start()}start(){this.initJavaOnlineDivs()}initJavaOnlineDivs(){jQuery(".sql-online").each(((e,t)=>{let i=jQuery(t),n=[];i.find("script").each(((e,t)=>{let i=jQuery(t),r="sql";null!=i.data("type")&&(r=i.data("type"));let o={type:r,title:i.attr("title"),text:i.text().trim()};n.push(o)})),this.initDiv(i,n)}))}initDiv(e,t){new wt(e,t)}}jQuery((function(){let e=new kt,t="",i="lib/monaco-editor/dev/vs";null!=window.javaOnlineDir&&(t=window.javaOnlineDir),null!=window.monacoEditorPath&&(i=window.monacoEditorPath),window.require.config({paths:{vs:t+i}}),window.require.config({"vs/nls":{availableLanguages:{"*":"de"}},ignoreDuplicateModules:["vs/editor/editor.main"]}),window.require(["vs/editor/editor.main"],(function(){e.initEditor(),e.initGUI()}))}))}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}i(248),i(511),i(581),i(912),i(373),i(576),i(522),i(172),i(554)})();
//# sourceMappingURL=sql-ide-embedded.js.map